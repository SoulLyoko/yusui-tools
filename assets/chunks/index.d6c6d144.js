import{bQ as Z,dB as ut,dC as Pt,dD as ne,dE as Ut,d4 as Et,d6 as At,cv as Kt,a5 as Mt,dF as X,bc as ye,dG as Bt,by as jt,bR as Ve}from"../composables_use-crud_index.md.cf5a186d.js";import{s as Ht,M as se,N as zt,O as Wt}from"../app.dff086b1.js";import{X as Me,B as De,r as O,s as ge,d as U,e as G,w as de,i as ee,u as k,n as me,Y as Yt,h as A,H as D,j as T,k as E,R as J,F as W,D as S,E as _,J as g,p as P,q as j,a3 as tt,C as Q,_ as Te,G as B,K as qt,l as Qt,O as ot,b as it,L as Gt,at as Ue,aw as Jt,M as Xt,ax as oe,ay as le,m as Zt,aM as ct,a5 as dt,I as eo}from"./framework.1d4a02f2.js";import{d as to,b as oo}from"../flow-design_demo.md.4915dea1.js";import{_ as lo}from"./index.vue_vue_type_script_setup_true_lang.61f6bbe7.js";import{a7 as pt,a8 as ao,a9 as no,a5 as ft,_ as so,a4 as ro,A as uo}from"./index.vue_vue_type_script_setup_true_lang.3e3a4ad4.js";import{u as pe,w as xe,c as io,d as co}from"./theme.5674d883.js";import{d as mt}from"./differenceBy.52fda6e9.js";import"../components_icon-select_index.md.3fe2eb67.js";import"../components_index.md.37c40369.js";import"../components_v-text_index.md.9eaeaf90.js";import"../composables_index.md.68e8d93c.js";import"../flow-design_index.md.b1a263fd.js";import"../flow-pages_index.md.c0e32d6b.js";import"../flow-pages_pages_flow-button_index.md.0263913a.js";import"../flow-pages_pages_flow-manage_index.md.af1f5d97.js";import"../flow-pages_pages_flow-ops_index.md.0adebbef.js";import"../flow-pages_pages_flow-param_index.md.3dffe446.js";import"../flow-pages_pages_flow-template_index.md.91dd92fd.js";import"../flow-pages_pages_flow-workbench_index.md.955f07a6.js";import"../flow-pages_pages_form-template_index.md.467345dc.js";import"../flow-pages_pages_table-template_index.md.36953b4a.js";import"../form-design_demo.md.66329777.js";import"../form-design_index.md.a8cece31.js";import"../guide_changelog.md.0aedbfdc.js";import"../guide_start.md.85b38af6.js";import"../index.md.818f4560.js";import"../plugins_avue-patch_index.md.2999d49c.js";import"../plugins_compatible-tips_index.md.22695c3c.js";import"../plugins_env-dts_index.md.df491860.js";import"../plugins_index.md.2506a63f.js";import"../plugins_load-proxy_index.md.b49d23df.js";import"../plugins_setup-extend_index.md.db3cc67f.js";import"../plugins_uni-ui-patch_index.md.a5d29425.js";import"../plugins_uview-patch_index.md.c34df568.js";import"../types_avue_index.md.8b3fb759.js";import"../types_index.md.029d9108.js";import"../utils_date_dateFormat.md.49351242.js";import"../utils_date_durationFormat.md.8c26c1f1.js";import"../utils_emitter_mittAsync.md.8d6a6730.js";import"../utils_index.md.a4c7cf47.js";import"../utils_math_index.md.fbb6f6e6.js";import"../utils_object_filterObj.md.56a519da.js";import"../utils_object_filterObjDeep.md.e1e7a4df.js";import"../utils_object_getDataType.md.6c8f45c4.js";import"../utils_string_deserialize.md.4d8b4fb1.js";import"../utils_string_serialize.md.9557324d.js";import"../utils_string_uuid.md.6e30edd6.js";import"../utils_tool_awaitTo.md.a934e82e.js";import"../utils_tool_enumToDic.md.5c777c00.js";import"../utils_tool_sleep.md.9dfa65aa.js";import"../utils_tree_buildTree.md.adfa5a1a.js";import"../utils_tree_filterTree.md.8c10d2fc.js";import"../utils_tree_findTree.md.4edc870e.js";import"../utils_tree_flatTree.md.b78a38d9.js";import"../utils_tree_treeMap.md.38af81eb.js";import"./uniqueId.9cc6e2b2.js";import"./vue.runtime.esm-bundler.f8653aa6.js";const po={},fo=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),mo=()=>po,ae=e=>e,Ee=e=>Array.isArray(e),Be=e=>e!==null&&typeof e=="object",je=e=>e instanceof Function,ve=e=>e==null,He=typeof window>"u",vt=()=>{var e;return He||ve((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},vo=()=>{var e,t;return(e=!He&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},Se=()=>new Promise(()=>{}),te=e=>ee(e)?e.value:e,_o=e=>Be(e)?Object.assign(Ee(e)?[]:{},e):e,he=new Map,bo=e=>ve(e)?void 0:he.get(e),wo=(e,t,o)=>{const d=he.get(e);d!=null&&d.timer&&clearTimeout(d.timer);const n=setTimeout(()=>he.delete(e),t);he.set(e,{...o,timer:n})};function _t(e,t,o){let d,n,a,p,l,r,i=0,m=!1,s=!1,f=!0;const c=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,Be(o)&&(m=!!o.leading,s="maxWait"in o,a=s?Math.max(+o.maxWait||0,t):a,f="trailing"in o?!!o.trailing:f);function b(C){const x=d,L=n;return d=n=void 0,i=C,p=e.apply(L,x),p}function y(C,x){return c?(window.cancelAnimationFrame(l),window.requestAnimationFrame(C)):setTimeout(C,x)}function u(C){if(c)return window.cancelAnimationFrame(C);clearTimeout(C)}function w(C){return i=C,l=y(V,t),m?b(C):p}function v(C){const x=C-r,L=C-i,K=t-x;return s?Math.min(K,a-L):K}function h(C){const x=C-r,L=C-i;return r===void 0||x>=t||x<0||s&&L>=a}function V(){const C=Date.now();if(h(C))return I(C);l=y(V,v(C))}function I(C){return l=void 0,f&&d?b(C):(d=n=void 0,p)}function F(){l!==void 0&&u(l),i=0,d=r=n=l=void 0}function N(){return l===void 0?p:I(Date.now())}function R(){return l!==void 0}function $(){const C=Date.now(),x=h(C);for(var L=arguments.length,K=new Array(L),H=0;H<L;H++)K[H]=arguments[H];if(d=K,n=this,r=C,x){if(l===void 0)return w(r);if(s)return l=y(V,t),b(r)}return l===void 0&&(l=y(V,t)),p}return $.cancel=F,$.flush=N,$.pending=R,$}function yo(e,t,o){let d=!0,n=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Be(o)&&(d="leading"in o?!!o.leading:d,n="trailing"in o?!!o.trailing:n),_t(e,t,{leading:d,trailing:n,maxWait:t})}var go=ae((e,t)=>{let{debounceInterval:o,debounceOptions:d,manual:n}=t;const a=O(!1),p=O(),l=U(()=>d),r=U(()=>te(o)),i=O(e.context.runAsync);return n||(a.value=!0),G(m=>{ve(r.value)||(p.value=_t(s=>s(),r.value,l.value),e.context.runAsync=function(){for(var s=arguments.length,f=new Array(s),c=0;c<s;c++)f[c]=arguments[c];return new Promise((b,y)=>{a.value?(a.value=!1,i.value(...f).then(b).catch(y)):p.value(()=>{i.value(...f).then(b).catch(y)})})},m(()=>{var s;(s=p.value)===null||s===void 0||s.cancel(),e.context.runAsync=i.value}))}),{onCancel(){var m;(m=p.value)===null||m===void 0||m.cancel()}}}),ho=ae((e,t)=>{let{errorRetryCount:o=0,errorRetryInterval:d=0}=t;const n=O(),a=O(0),p=U(()=>te(o)),l=U(()=>te(d));let r=!1;const i=()=>{a.value=0},m=U(()=>{if(l.value)return l.value;const c=1e3,b=1,y=9,u=Math.floor(Math.random()*2**Math.min(a.value,y)+b);return c*u}),s=()=>{let c;const b=p.value===-1,y=a.value<p.value;return(b||y)&&(b||(a.value+=1),c=setTimeout(()=>{r=!0,e.context.refresh()},m.value)),()=>c&&clearTimeout(c)},f=()=>{n.value&&n.value()};return{onBefore(){r||i(),r=!1,f()},onSuccess(){i()},onError(){n.value=s()},onCancel(){i(),f()}}}),ko=ae((e,t)=>{let{ready:o=O(!0),manual:d,defaultParams:n=[]}=t;return de(o,a=>{!d&&a&&e.context.run(...n)},{flush:"sync"}),{onBefore(){if(!(je(o)?o():o.value))return e.loading.value=!1,{isBreak:!0}}}}),Co=ae((e,t)=>{let{refreshDeps:o,refreshDepsAction:d,manual:n}=t;if(o===void 0||Ee(o)&&o.length===0)return{};const a=Ee(o)?o:[o];return de(a,()=>{d?d():!n&&e.context.refresh()}),{}}),Vo=ae((e,t)=>{let{throttleInterval:o,throttleOptions:d}=t;const n=O(),a=U(()=>te(o)),p=U(()=>d),l=O(e.context.runAsync);return G(r=>{if(ve(o))return{};n.value=yo(i=>i(),a.value,p.value),e.context.runAsync=function(){for(var i=arguments.length,m=new Array(i),s=0;s<i;s++)m[s]=arguments[s];return new Promise((f,c)=>{n.value(()=>{l.value(...m).then(f).catch(c)})})},r(()=>{var i;(i=n.value)===null||i===void 0||i.cancel(),e.context.runAsync=l.value})}),{onCancel(){var r;(r=n.value)===null||r===void 0||r.cancel()}}});const Do=(e,t)=>o=>{Object.keys(o).forEach(d=>{e[d].value=o[d]}),t.forEach(d=>d(e))},To=(e,t)=>()=>{let o=t;for(let d=e.length;d-- >0;)o=e[d](o);return o()},xo=(e,t,o)=>{var d,n;const{initialData:a,onSuccess:p,onError:l,onBefore:r,onAfter:i}=t,m=O((d=o==null?void 0:o.loading)!==null&&d!==void 0?d:!1),s=ge((n=o==null?void 0:o.data)!==null&&n!==void 0?n:a),f=ge(o==null?void 0:o.error),c=O(o==null?void 0:o.params),b=O([]),y=ge("pending"),u={},w=Do({status:y,loading:m,data:s,error:f,params:c},[]),v=function(V){for(var I=arguments.length,F=new Array(I>1?I-1:0),N=1;N<I;N++)F[N-1]=arguments[N];if(V==="onQuery"){const R=b.value.map($=>$.onQuery).filter(Boolean);return{servicePromise:To(R,F[0])()}}else{const R=b.value.map($=>{var C;return(C=$[V])===null||C===void 0?void 0:C.call($,...F)});return Object.assign({},...R)}},h=O(0);return u.runAsync=async function(){for(var V=arguments.length,I=new Array(V),F=0;F<V;F++)I[F]=arguments[F];w({loading:!0,params:I,status:"pending"}),h.value+=1;const N=h.value,{isBreak:R,breakResult:$=Se()}=v("onBefore",I);if(R)return w({status:"settled"}),$;r==null||r(I);try{const C=()=>new Promise(K=>K(e(...c.value)));let{servicePromise:x}=v("onQuery",C);x||(x=C());const L=await x;return N!==h.value?Se():(w({data:L,loading:!1,error:void 0,status:"settled"}),v("onSuccess",L,I),p==null||p(L,I),N===h.value&&v("onAfter",I,L,void 0),i==null||i(I),L)}catch(C){if(N!==h.value)return Se();throw w({loading:!1,error:C,status:"settled"}),v("onError",C,I),l==null||l(C,I),N===h.value&&v("onAfter",I,void 0,C),i==null||i(I),C}},u.run=function(){u.runAsync(...arguments).catch(V=>{l||console.error(V)})},u.cancel=()=>{h.value+=1,w({loading:!1}),v("onCancel")},u.refresh=()=>{u.run(...c.value||[])},u.refreshAsync=()=>u.runAsync(...c.value||[]),u.mutate=V=>{const I=je(V)?V(s.value):V,F=_o(I);w({data:F}),v("onMutate",F)},{status:y,loading:m,data:s,error:f,params:c,plugins:b,context:u}};function Lo(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const d=Me(fo,{}),n={...mo(),...d,...t},{manual:a=!1,defaultParams:p=[]}=n,l=xo(e,n);if(l.plugins.value=o.map(r=>r(l,n)),!a){const r=l.params.value||p;l.context.run(...r)}return De(()=>{l.context.cancel()}),{loading:l.loading,data:l.data,error:l.error,params:l.params,cancel:l.context.cancel,refresh:l.context.refresh,refreshAsync:l.context.refreshAsync,mutate:l.context.mutate,run:l.context.run,runAsync:l.context.runAsync}}const ke=new Map,No=(e,t)=>{ke.set(e,t),t.then(o=>(ke.delete(e),o)).catch(()=>{ke.delete(e)})},Oo=e=>ke.get(e),ue=new Map,Io=(e,t)=>{ue.has(e)&&ue.get(e).forEach(o=>o(t))},$o=(e,t)=>(ue.has(e)?ue.get(e).push(t):ue.set(e,[t]),()=>{const o=ue.get(e).indexOf(t);ue.get(e).splice(o,1)});var So=ae((e,t)=>{let{cacheKey:o,cacheTime:d=6e5,staleTime:n=0,getCache:a,setCache:p}=t;if(!o)return{};const l=je(o)?o:()=>o,r=O(()=>{});let i;const m=w=>a?a(w):bo(w),s=(w,v,h)=>{p?p(w,h):wo(w,v,h),Io(w,h.data)},f=w=>n===-1||w+n>new Date().getTime(),c=(w,v)=>Object.prototype.hasOwnProperty.call(w,v),b=w=>{const v=l(w);return $o(v,h=>{e.data.value=h})},y=l(),u=m(y);return u&&c(u,"data")&&(e.data.value=u.data,e.params.value=u.params),y&&(r.value=b()),De(()=>{r.value()}),{onBefore(w){const v=l(w),h=m(v);if(!h||!c(h,"data"))return{};if(f(h.time))return e.data.value=h.data,e.loading.value=!1,{isBreak:!0,breakResult:h.data};e.data.value=h.data},onQuery(w){const v=e.params.value,h=l(v);let V=Oo(h);return V&&V!==i?()=>V:(V=w(),i=V,No(h,V),()=>V)},onSuccess(w,v){const h=l(v);h&&(r.value(),s(h,d,{data:w,params:v,time:new Date().getTime()}),r.value=b(v))},onMutate(w){const v=l(e.params.value);v&&(r.value(),s(v,d,{data:w,params:e.params.value,time:new Date().getTime()}),r.value=b(e.params.value))}}});function Ro(e){let t,o;class d extends Promise{constructor(a){super(a),this.cancel=()=>{o(),clearTimeout(t)}}}return new d(n=>{o=n,t=setTimeout(o,e)})}function Re(){return new Date().getTime()}var Fo=ae((e,t)=>{let{loadingDelay:o=0,loadingKeep:d=0}=t;const n=O(()=>{}),a=U(()=>te(o)),p=U(()=>te(d));let l=0,r={};const i=()=>{let m;return a.value&&(m=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},a.value)),()=>m&&clearTimeout(m)};return{onBefore(){e.loading.value=!a.value,n.value(),n.value=i(),l=Re()},onQuery(m){if(!p.value)return()=>m();r=Ro(p.value+a.value);const s=async()=>{try{const c=await m();return Re()-l<=a.value&&r.cancel(),Promise.resolve(c)}catch(c){return Re()-l<=a.value&&r.cancel(),Promise.reject(c)}},f=Promise.allSettled([s(),r]).then(c=>{const b=c[0];return b.status==="fulfilled"?b.value:Promise.reject(b.reason)});return()=>f},onCancel(){n.value()},onAfter(){n.value()}}}),Fe;const bt=new Set,wt=new Set,yt=new Set,Ce=(e,t)=>{let o;switch(e){case"FOCUS_LISTENER":o=bt;break;case"RECONNECT_LISTENER":o=yt;break;case"VISIBLE_LISTENER":o=wt;break}if(!o.has(t))return o.add(t),()=>{o.delete(t)}},Pe=e=>{e.forEach(t=>{t()})};!He&&(Fe=window)!==null&&Fe!==void 0&&Fe.addEventListener&&(window.addEventListener("visibilitychange",()=>{vt()&&Pe(wt)},!1),window.addEventListener("focus",()=>Pe(bt),!1),window.addEventListener("online",()=>Pe(yt),!1));var Po=ae((e,t)=>{let{pollingInterval:o,pollingWhenHidden:d=!1,pollingWhenOffline:n=!1,errorRetryCount:a=0}=t;const p=O(),l=O(!1),r=U(()=>te(o)),i=U(()=>te(a)),m=[],s=y=>{y&&m.push(y)},f=()=>(d||vt())&&(n||vo()),c=y=>{if(e.error.value&&i.value!==0)return;let u;if(!ve(r.value)&&r.value>=0)if(f())u=setTimeout(y,r.value);else{l.value=!0;return}return()=>u&&clearTimeout(u)},b=()=>{l.value&&f()&&(e.context.refresh(),l.value=!1)};return de(r,()=>{p.value&&(p.value(),p.value=c(()=>e.context.refresh()))}),d||s(Ce("VISIBLE_LISTENER",b)),n||s(Ce("RECONNECT_LISTENER",b)),De(()=>{m.forEach(y=>y())}),{onBefore(){var y;(y=p.value)===null||y===void 0||y.call(p)},onCancel(){var y;(y=p.value)===null||y===void 0||y.call(p)},onAfter(){p.value=c(()=>e.context.refresh())}}});const Uo=(e,t)=>{let o=!1;return function(){o||(o=!0,e(...arguments),setTimeout(()=>{o=!1},t))}};var Eo=ae((e,t)=>{let{refreshOnWindowFocus:o=!1,refocusTimespan:d=5e3}=t;const n=U(()=>te(o)),a=U(()=>te(d)),p=[],l=i=>{i&&p.push(i)},r=()=>{p.forEach(i=>i())};return G(()=>{if(r(),n.value){const i=Uo(e.context.refresh,a.value);l(Ce("VISIBLE_LISTENER",i)),l(Ce("FOCUS_LISTENER",i))}}),De(()=>{r()}),{}});function ie(e,t){return Lo(e,t,[Fo,ho,go,Po,Vo,Eo,Co,ko,So])}var gt=(e=>(e[e.å·²åŠ=1]="å·²åŠ",e[e.å¾…åŠ=2]="å¾…åŠ",e[e.å¤±è´¥=3]="å¤±è´¥",e[e.æ’¤é”€=4]="æ’¤é”€",e[e.ç»ˆæ­¢=5]="ç»ˆæ­¢",e))(gt||{});function Le(){const{request:e}=z(),t={publishList:"/sapier-flow/flow-run/queryPublishFlowList",taskList:"/sapier-flow/flow-run/userTaskList",detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",reject:"/sapier-flow/flow-run/rollbackTask",green:"/sapier-flow/flow-run/greenTask",circulate:"/sapier-flow/flow-circulate/commitTask"};return{url:t,getPublishList:()=>e.get(t.publishList),getTaskList:u=>e.get(t.taskList,{params:u}),getFlowDetail:u=>e.get(t.detail,{params:u}),getApprovalNode:u=>e.post(t.approvalNode,u),startTask:u=>e.post(t.start,u),commitTask:u=>e.post(t.commit,u),saveDraft:u=>e.post(t.draft,u),revokeTask:u=>e.post(t.revoke,u),terminateTask:u=>e.post(t.terminate,u),withdrawTask:u=>e.post(t.withdraw,u),transferTask:u=>e.post(t.transfer,u),rejectTask:u=>e.post(t.reject,u),greenChannel:u=>e.post(t.green,u),circulateTask:u=>e.post(t.circulate,u)}}function Ao(e){const{commitTask:t,revokeTask:o,saveDraft:d,startTask:n,terminateTask:a,transferTask:p,withdrawTask:l,rejectTask:r,greenChannel:i,circulateTask:m}=Le(),s=U(()=>{const{flowDetail:c,formVariables:b,approvalFormData:y,debug:u,fileIds:w}=e,{flowDeployId:v}=c.value.process??{},{taskId:h,flowInstanceId:V}=c.value.task??{};return{flowDeployId:v,taskId:h,flowInstanceId:V,variables:b.value,debug:u.value,fileIds:w.value,...y.value}}),f=()=>s.value.taskId&&s.value.flowInstanceId;return{flow_draft(){if(f())return d(s.value)},flow_pass(){return f()?t(s.value):n(s.value)},flow_revoke(){if(f())return o(s.value)},flow_withdraw(){if(f())return l(s.value)},flow_terminate(){if(f())return a(s.value)},flow_transfer(){if(f())return p(s.value)},flow_reject(){if(f())return r(s.value)},flow_green(){if(f())return i(s.value)},flow_circulate(){if(f()){const{approvalFormData:c,circulateId:b}=e;return m({id:b==null?void 0:b.value,comment:c==null?void 0:c.value.comment})}}}}function Ko(e){const t=O({});return G(async()=>{var d;const{formProperty:o}=((d=k(e))==null?void 0:d.properties)||{};o!=null&&o.length&&(await me(),Object.keys(t.value).forEach(n=>{var l,r,i,m;const a=((l=t.value[n])==null?void 0:l.label)||"",p=o==null?void 0:o.find(s=>s.prop===n);if(t.value[n].display=p==null?void 0:p.display,t.value[n].disabled=p==null?void 0:p.disabled,t.value[n].detail=p==null?void 0:p.detail,t.value[n].readonly=p==null?void 0:p.readonly,t.value[n].rules=t.value[n].rules??[],p!=null&&p.required&&((r=t.value[n].rules)!=null&&r.some(s=>s.required)))return null;p!=null&&p.required?(i=t.value[n].rules)==null||i.push({required:!0,message:`${a}ä¸ºå¿…å¡«é¡¹`}):t.value[n].rules=(m=t.value[n].rules)==null?void 0:m.filter(s=>!s.required)}))}),t}function Mo(){return{modelValue:{type:Object,default:()=>({})},title:{type:String},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"formTab"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean},circulateId:{type:String}}}function Bo(){return{complete:e=>e}}const ht=Symbol("flowFormState");function jo(e,t){const o=pe(e,void 0,{passive:!0,deep:!0}),{flowDetail:d,modelValue:n,formLoading:a}=o,{getFlowDetail:p}=Le(),{tabs:l}=z(),r=U(()=>(l==null?void 0:l.filter(c=>{var y,u,w;const b=(w=(u=(y=d.value)==null?void 0:y.properties)==null?void 0:u.formProperty)==null?void 0:w.find(v=>v.prop===c.prop);return(b==null?void 0:b.display)!==!1}))??[]);G(()=>{const{flowKey:c,taskId:b,instanceId:y}=e;!c&&!b&&!y||(a.value=!0,p({flowKey:c,taskId:b,flowInstanceId:y}).then(u=>{d.value=u.data,n.value=u.data.formData||{}}).finally(()=>{a.value=!1}))});const i=O(!1),m=U(()=>Object.entries(n.value||{}).filter(([c])=>!c.startsWith("$")).map(([c,b])=>({key:c,value:b}))),s=O(),f={...o,formData:n,formVariables:m,approvalVisible:i,tabList:r,fileIds:s,emit:t};return Yt(ht,f),f}function ce(){return Me(ht)}const Ho=A({__name:"button-list",emits:["click"],setup(e,{emit:t}){const{flowDetail:o,circulateId:d}=ce(),{data:n}=Qe().useList(),{userInfo:a}=z();function p(r,i){return r.map(m=>{const s=i.find(c=>c.buttonKey===m.buttonKey);return{...m,...Ht(s,["display","approval"])}})}const l=U(()=>{var v,h,V,I,F,N;if(d!=null&&d.value){const R=(v=n.value)==null?void 0:v.find($=>$.buttonKey==="flow_circulate");return R?[R]:[]}const r=typeof a=="function"?a():a,{assignee:i,status:m}=((h=o.value)==null?void 0:h.task)||{},{createUser:s,flowInstanceId:f,status:c}=((V=o.value)==null?void 0:V.flowInstance)||{},b={true:!0,false:!1,startUser:s==(r==null?void 0:r.userId),assignee:i==(r==null?void 0:r.userId),todo:m==2,done:m==1,notstarted:!f,started:!!f,finished:c===1,unfinished:c===2},y=((I=n.value)==null?void 0:I.filter(R=>R.buttonKey!=="flow_circulate"))??[],{button:u}=((F=o.value)==null?void 0:F.properties)||{};return((N=p(y,u??[]))==null?void 0:N.filter(R=>{var $,C;return(C=($=R.display)==null?void 0:$.split(","))==null?void 0:C.every(x=>b[x])}))??[]});return(r,i)=>{const m=D("el-button");return T(!0),E(W,null,J(l.value,s=>(T(),S(m,{key:s.buttonKey,type:s.buttonType,onClick:f=>t("click",s)},{default:_(()=>[g(k(se),{icon:s.icon},null,8,["icon"]),P(" "+j(s.name),1)]),_:2},1032,["type","onClick"]))),128)}}});function ze(e){return new Promise((t,o)=>{k(e).validate((n,a,p)=>{n?(a(),t(p)):o(p)})})}const zo=A({__name:"common-comments",props:{modelValue:{}},setup(e){const t=e,{modelValue:o}=pe(t),{batchUpdate:d,create:n,remove:a,useList:p}=cl(),l=O(!1),{activeBtn:r}=ce(),i=U(()=>{var h;return(h=r.value)==null?void 0:h.buttonKey}),{data:m,refresh:s}=p(i),f=U(()=>{var V,I,F;const h=o.value;if(h&&!((V=m.value)!=null&&V.some(N=>N.content===h))){const N=(((F=(I=m.value)==null?void 0:I[0])==null?void 0:F.sort)||1)-1;return[{content:h,sort:N},...m.value||[]]}return m.value});async function c(h){var V;await n({...h,type:(V=r.value)==null?void 0:V.buttonKey}),Z.success("æ·»åŠ æˆåŠŸ"),s()}async function b(h){await a(h.id),Z.success("åˆ é™¤æˆåŠŸ"),s()}async function y(h,V){let I=V.parent.data;I=I.map((F,N)=>({id:F.id,sort:N+1})),await d(I),Z.success("ä¿®æ”¹æ’åºæˆåŠŸ"),s(),l.value=!1}function u(){l.value=!0}const w=O();async function v(h){var V;o.value=h.content??"",await me(),(V=w.value)==null||V.blur()}return(h,V)=>{const I=D("el-input"),F=D("el-text"),N=D("el-col"),R=D("el-button"),$=D("el-row"),C=D("el-tree"),x=D("el-popover");return T(),S(x,{visible:l.value,placement:"bottom",title:"å¸¸ç”¨æ„è§",width:600},{reference:_(()=>[g(I,{ref_key:"inputRef",ref:w,modelValue:k(o),"onUpdate:modelValue":V[0]||(V[0]=L=>ee(o)?o.value=L:null),type:"textarea",placeholder:"è¯·è¾“å…¥æ„è§",rows:"5",onFocus:V[1]||(V[1]=L=>l.value=!0),onBlur:V[2]||(V[2]=L=>l.value=!1)},null,8,["modelValue"])]),default:_(()=>[g(C,{data:f.value,"node-key":"content",draggable:"","allow-drop":(L,K,H)=>H!=="inner",props:{label:"content"},onNodeClick:v,onNodeDrop:y,onNodeDragStart:u},{default:_(({data:L})=>[g($,{style:{width:"600px"}},{default:_(()=>[g(N,{span:22},{default:_(()=>[g(F,{truncated:"",title:L.content},{default:_(()=>[P(j(L.content),1)]),_:2},1032,["title"])]),_:2},1024),g(N,{span:2},{default:_(()=>[L.id?(T(),S(R,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:tt(K=>b(L),["stop"])},null,8,["onClick"])):(T(),S(R,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:tt(K=>c(L),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),Wo=A({__name:"approval-tree",props:{modelValue:{},data:{},autoCheck:{type:Boolean}},setup(e){const t=e,{modelValue:o}=pe(t),d=O(),n={class(s){return`node-${s.type}`}},a=U(()=>pt(t.data??[],(s,f,c)=>{const b=ut();return s.taskNodeKey=(c==null?void 0:c.taskNodeKey)??s.taskNodeKey,s.incoming=(c==null?void 0:c.incoming)??s.incoming,s.multiple=(c==null?void 0:c.multiple)??s.multiple,{...s,id:b,label:s.title,disabled:s.type!=="user"}})),p={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"};xe(()=>[a.value,d.value],async()=>{if(!d.value||!a.value.length)return;if(t.autoCheck){const f=l(a.value);f&&m([f])}ao(a.value,f=>{var c;return!!((c=f.children)!=null&&c.length)}).map(async f=>{var b;await Pt(100);const c=(b=d.value)==null?void 0:b.getNode(f);c==null||c.expand()})},{immediate:!0,debounce:100});function l(s){var f;if(s.length===1)return(f=s[0].children)!=null&&f.length?l(s[0].children):s[0]}async function r(s,{checkedNodes:f}){var y;let c=f.filter(u=>u.type==="user");const b=c.some(u=>u.id===s.id);if(a.value.every(u=>!u.multiple)&&b)c=[s];else if(!s.multiple&&b){const v=((y=d.value)==null?void 0:y.getNode(s)).parent.data.children.filter(h=>h.id!==s.id);c=mt(c,v,"id")}m(c)}function i(s){const f=o.value.filter(c=>c.id!==s.id);m(f)}function m(s){var f;o.value=s,(f=d.value)==null||f.setCheckedNodes(s)}return(s,f)=>{const c=D("el-tag"),b=D("Icon"),y=D("el-tree");return T(),E(W,null,[(T(!0),E(W,null,J(k(o),u=>(T(),S(c,{key:u.id,type:"info",closable:"",onClose:w=>i(u)},{default:_(()=>[P(j(u.title),1)]),_:2},1032,["onClose"]))),128)),g(y,{ref_key:"treeRef",ref:d,class:"approval-tree",data:a.value,props:n,"node-key":"id","check-on-click-node":"","show-checkbox":"",onCheck:r},{default:_(({data:u})=>[Q("div",null,[g(b,{icon:p[u.type]||p.element,style:{display:"inline-block"}},null,8,["icon"]),Q("span",null,j(u.title),1)])]),_:1},8,["data"])],64)}}});const lt=Te(Wo,[["__scopeId","data-v-f1318efd"]]),at=A({__name:"assignee-setter",props:{modelValue:{},tableData:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,{getUserTree:d}=ml(),n=U({get(){return typeof o.modelValue=="string"?o.modelValue?o.modelValue.split(","):[]:o.modelValue},set(i){t("update:modelValue",i.join(","))}}),a=U({get(){return Array.isArray(o.modelValue)?o.modelValue.join(","):o.modelValue},set(i){t("update:modelValue",i)}}),p=O([]),l=O(!1),r=U(()=>{var i,m;return(m=(i=o.tableData)==null?void 0:i.row)==null?void 0:m.type});return de(r,i=>{["dept","post","user"].includes(i)&&(l.value=!0,d(i==="user"?"":i).then(m=>{p.value=pt(m.data,s=>({label:s.title,value:s.id}))}).finally(()=>l.value=!1))},{immediate:!0}),(i,m)=>{const s=D("el-tree-select"),f=D("el-input");return["dept","post","user"].includes(r.value)?(T(),S(s,{key:0,modelValue:n.value,"onUpdate:modelValue":m[0]||(m[0]=c=>n.value=c),data:p.value,loading:l.value,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"","expand-on-click-node":!1},null,8,["modelValue","data","loading"])):(T(),S(f,{key:1,modelValue:a.value,"onUpdate:modelValue":m[1]||(m[1]=c=>a.value=c)},null,8,["modelValue"]))}}}),Yo={key:0,class:"flow-viewer"},qo={key:0,class:"flow-status-legend"},Qo=A({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{},showLegend:{type:Boolean}},emits:["update:modelValue","nodeClick"],setup(e,{emit:t}){const o=e,{FlowDesign:d,tabs:n}=z(),a=ge();io(a,()=>{var u;(u=a.value)==null||u.on("node:click",w=>t("nodeClick",w))});const p=U({get(){let u=to();return typeof o.modelValue=="string"&&o.modelValue?u=JSON.parse(o.modelValue):typeof o.modelValue=="object"&&Object.keys(o.modelValue)&&(u=o.modelValue),u},set(u){t("update:modelValue",JSON.stringify(u))}}),l=U(()=>{const{column:u=[],group:w=[]}=JSON.parse(o.flowFormOption||"{}");return[...u,...w.map(h=>h.column??[]).flat()]}),{data:r}=Qe().useList(),i=U(()=>(n==null?void 0:n.map(u=>({...u,display:!0})))??[]),m=U(()=>{var u;return{formPropertyList:[...l.value,...i.value],buttonList:(u=r.value)==null?void 0:u.filter(w=>w.status===1),fieldsDic:l.value.map(w=>({label:w.label,value:`\${${w.prop}}`,desc:`\${${w.prop}}`})),flowButtonDisplayDic:ne(Ye),flowButtonApprovalDic:ne(qe)}}),s=O({}),f=O({});xe(f,u=>{var w,v,h,V,I,F,N,R,$;u&&((h=(v=(w=u.assignee)==null?void 0:w.children)==null?void 0:v.column)!=null&&h[1]&&(u.assignee.children.column[1].component=at),($=(R=(N=(F=(I=(V=u.circulate)==null?void 0:V.children)==null?void 0:I.column)==null?void 0:F[1])==null?void 0:N.children)==null?void 0:R.column)!=null&&$[1]&&(u.circulate.children.column[1].children.column[1].component=at))},{debounce:1});const{data:c}=be().useParam("flow.task.status"),b=U(()=>{var u;return(u=o.flowHistory)==null?void 0:u.map(w=>{var h,V;const v=(V=(h=c.value)==null?void 0:h.find(I=>I.value===w.status))==null?void 0:V.style;return{id:w.taskNodeKey,style:v}})}),y=U(()=>{var u,w;return(w=(u=o.flowHistory)==null?void 0:u.filter(v=>v.taskNodeType==="userTask"))==null?void 0:w.map(v=>{var h;return{id:v.taskNodeKey,content:`<div>${v.assigneeName}</div>
        <div>${v.endTime??""}</div>
        <div>${((h=v.comment)==null?void 0:h.comment)??""}</div>`}})});return(u,w)=>u.view?(T(),E("div",Yo,[u.showLegend!==!1?(T(),E("div",qo,[(T(!0),E(W,null,J(k(c),v=>{var h;return T(),E("div",{key:v.label,class:"legend-item"},[Q("div",{class:"legend-color",style:qt({backgroundColor:(h=v.style)==null?void 0:h.fill})},null,4),Q("span",null,j(v.label),1)])}),128))])):B("",!0),g(k(d),{lf:a.value,"onUpdate:lf":w[0]||(w[0]=v=>a.value=v),"model-value":p.value,styles:b.value,tooltips:y.value,type:"viewer"},null,8,["lf","model-value","styles","tooltips"])])):(T(),S(k(d),{key:1,modelValue:p.value,"onUpdate:modelValue":w[1]||(w[1]=v=>p.value=v),formData:s.value,"onUpdate:formData":w[2]||(w[2]=v=>s.value=v),formDefaults:f.value,"onUpdate:formDefaults":w[3]||(w[3]=v=>f.value=v),"form-options":k(oo),"data-options":m.value,"form-width":"30%"},null,8,["modelValue","formData","formDefaults","form-options","data-options"]))}});const _e=Te(Qo,[["__scopeId","data-v-9aa4931a"]]),Go=A({__name:"node-select",props:{modelValue:{}},setup(e){const t=e,{modelValue:o}=pe(t),{flowDetail:d}=ce(),n=O(!1);function a({data:p}){p.type==="userTask"&&(n.value=!1,o.value=p.id)}return(p,l)=>{const r=D("el-button"),i=D("el-popover");return T(),S(i,{visible:n.value,"onUpdate:visible":l[0]||(l[0]=m=>n.value=m),placement:"bottom-start",width:"800px",trigger:"click"},{reference:_(()=>[g(r,null,{default:_(()=>[P(" ç‚¹å‡»é€‰æ‹©èŠ‚ç‚¹ ")]),_:1})]),default:_(()=>{var m,s;return[g(_e,{"model-value":(s=(m=k(d))==null?void 0:m.process)==null?void 0:s.flowData,view:"",style:{height:"600px"},onNodeClick:a},null,8,["model-value"])]}),_:1},8,["visible"])}}}),Jo=A({__name:"approval-form",emits:["confirm"],setup(e,{emit:t}){const{getApprovalNode:o}=Le(),{useParam:d}=be(),{formData:n,approvalFormData:a,activeBtn:p,approvalVisible:l,formVariables:r,flowDetail:i}=ce(),m=O([]),s=O([]),f=O([]),c=O([]),b=O(!1),y=O(!1),u=O(),w=O(),v={menuBtn:!1,labelWidth:100,column:[{label:"æŒ‡å®šèŠ‚ç‚¹",prop:"jumpTaskNodeKey",span:24,rules:[{required:!0,message:"è¯·é€‰æ‹©æŒ‡å®šèŠ‚ç‚¹"}]},{label:"å®¡æ‰¹äºº",prop:"assignee",span:24,rules:[{required:!0,validator:h}]},{label:"ä¼ é˜…äºº",prop:"circulate",span:24},{label:"æ„è§",prop:"comment",span:24,rules:[{required:!0,message:"è¯·å¡«å†™æ„è§"}]}]};function h(C,x,L){var Y,M,we;const K=((Y=m.value[0])==null?void 0:Y.type)==="parallelGateway",H=(we=(M=m.value[0])==null?void 0:M.children)==null?void 0:we.every(re=>no([re],Ne=>s.value.some(Oe=>Oe.id===Ne.id)));if(s.value.length){if(K&&!H)return L("è¯·åœ¨æ¯ä¸ªèŠ‚ç‚¹é€‰æ‹©å®¡æ‰¹äºº")}else return L("è¯·é€‰æ‹©å®¡æ‰¹äºº");return!0}const{data:V}=d("flow.default.comment"),{data:I}=d("flow.approval.autocheck");G(async()=>{var x;if(!l.value||!u.value||!w.value)return;F();const{taskId:C}=((x=i.value)==null?void 0:x.task)||{};me(()=>{u.value.resetFields(),a.value.comment=n.value.comment||(C?"":V.value),w.value.jumpTaskNodeKey.display=N("specifyNode"),w.value.assignee.display=N("assignee"),w.value.circulate.display=N("circulate"),w.value.comment.display=N("comment")})}),G(async()=>{var L,K;if(!l.value||!N("assignee")||N("specifyNode")&&!a.value.jumpTaskNodeKey)return;F();const{flowKey:C}=((L=i.value)==null?void 0:L.process)||{},{taskId:x}=((K=i.value)==null?void 0:K.task)||{};try{y.value=!0;const H=await o({flowKey:C,taskId:x,variables:r.value,buttonType:p.value.buttonKey,jumpTaskNodeKey:a.value.jumpTaskNodeKey});m.value=H.data.approvalNodeList,f.value=H.data.circulateNodeList}finally{y.value=!1}});function F(){m.value=[],s.value=[],f.value=[],c.value=[]}function N(C){var x,L;return(L=(x=p.value)==null?void 0:x.approval)==null?void 0:L.includes(C)}async function R(){await ze(u),b.value=!0;const{data:C,outgoing:x}=$(s.value),{data:L}=$(c.value);a.value.assignee=C,a.value.outgoing=[...x],a.value.circulate=L,console.log("ğŸš€ ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",n),t("confirm")}function $(C){const x={},L={},K=new Set;return C.forEach(H=>{const{taskNodeKey:Y,incoming:M}=H;x[Y]||(x[Y]=new Set),H.userId&&x[Y].add(H.userId),L[Y]=[...x[Y]].join(","),M&&K.add(M)}),{set:x,data:L,outgoing:K}}return(C,x)=>{const L=D("el-skeleton"),K=D("avue-form"),H=D("el-button"),Y=D("el-dialog");return T(),S(Y,{modelValue:k(l),"onUpdate:modelValue":x[7]||(x[7]=M=>ee(l)?l.value=M:null),class:"approlval-form",title:k(p).name,width:"900px","append-to-body":""},{footer:_(()=>[g(H,{onClick:x[6]||(x[6]=M=>l.value=!1)},{default:_(()=>[P(" å– æ¶ˆ ")]),_:1}),g(H,{type:"primary",onClick:R},{default:_(()=>[P(" ç¡® å®š ")]),_:1})]),default:_(()=>[g(K,{ref_key:"formRef",ref:u,modelValue:k(a),"onUpdate:modelValue":x[4]||(x[4]=M=>ee(a)?a.value=M:null),defaults:w.value,"onUpdate:defaults":x[5]||(x[5]=M=>w.value=M),option:v},{jumpTaskNodeKey:_(()=>[g(Go,{modelValue:k(a).jumpTaskNodeKey,"onUpdate:modelValue":x[0]||(x[0]=M=>k(a).jumpTaskNodeKey=M)},null,8,["modelValue"])]),assignee:_(()=>[y.value?(T(),S(L,{key:0})):(T(),S(lt,{key:"AssigneeTree",modelValue:s.value,"onUpdate:modelValue":x[1]||(x[1]=M=>s.value=M),data:m.value,"auto-check":k(I)==="true"},null,8,["modelValue","data","auto-check"]))]),circulate:_(()=>[y.value?(T(),S(L,{key:0})):(T(),S(lt,{key:"CirculateTree",modelValue:c.value,"onUpdate:modelValue":x[2]||(x[2]=M=>c.value=M),data:f.value},null,8,["modelValue","data"]))]),comment:_(()=>[g(zo,{modelValue:k(a).comment,"onUpdate:modelValue":x[3]||(x[3]=M=>k(a).comment=M)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["modelValue","title"])}}}),Xo={class:"flow-form__title"},We=A({__name:"index",props:Mo(),emits:Bo(),setup(e,{emit:t}){const o=e,d=jo(o,t),{flowDetail:n,tabList:a,activeTab:p,activeBtn:l,formLoading:r,approvalVisible:i,submitLoading:m}=d,s=O();async function f(y){var u,w;l.value=y,await((u=s.value)==null?void 0:u.validate()),await((w=o.beforeClick)==null?void 0:w.call(o,y)),(y==null?void 0:y.approval)!=="false"?i.value=!0:b()}const c=Ao(d);async function b(){var y,u;try{const{buttonKey:w}=l.value;m.value=!0,await((y=o.beforeSubmit)==null?void 0:y.call(o,l.value));const v=(u=c[w])==null?void 0:u.call(c);v instanceof Promise?(await v,Z.success("æ“ä½œæˆåŠŸ"),i.value=!1,t("complete",l.value)):Z.error("æ“ä½œå¤±è´¥")}finally{m.value=!1}}return(y,u)=>{const w=D("el-skeleton"),v=D("el-main"),h=D("el-header"),V=D("el-tab-pane"),I=D("el-tabs"),F=D("el-container");return k(r)?(T(),S(v,{key:0},{default:_(()=>[g(w)]),_:1})):(T(),S(F,{key:1,class:"flow-form"},{default:_(()=>[g(h,{class:"flow-form__header",height:"auto"},{default:_(()=>{var N;return[Q("div",Xo,j(o.title??((N=k(n).flowInstance)==null?void 0:N.title)),1),y.detail?B("",!0):(T(),S(Ho,{key:0,onClick:f})),Qt(y.$slots,"button")]}),_:3}),g(v,{class:"flow-form__main"},{default:_(()=>[g(I,{modelValue:k(p),"onUpdate:modelValue":u[0]||(u[0]=N=>ee(p)?p.value=N:null)},{default:_(()=>[(T(!0),E(W,null,J(k(a),N=>(T(),S(V,{key:N.prop,label:N.label,name:N.prop,lazy:""},{default:_(()=>[N.prop==="formTab"?(T(),S(ot(y.$slots.default??N.component),{key:0,ref_for:!0,ref:R=>s.value=R},null,512)):(T(),S(ot(N.component),{key:1}))]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1}),g(Jo,{onConfirm:b})]),_:3}))}}});function kt(e,t){switch(t.type){case"window":return Zo(e,t);case"dialog":case"drawer":return el(e,t);default:return{open:o=>{},close:()=>{}}}}function Zo(e,t){const{window:[o="",d="flow-form",n="left=0,top=0,width=1600,height=900"]=[]}=t,a=O(null),p=U(()=>`${o}?${Ut(Et(e,At(Kt,Mt)))}`);return{open:i=>{var m;a.value=window.open(p.value,d,n),(m=a.value)==null||m.addEventListener("message",s=>{const{event:f}=s.data,c={...k(e),...k(i)}[f];typeof c=="function"&&c(s.data)})},close:()=>{var i;return(i=a.value)==null?void 0:i.close()},openedWindow:a}}function el(e,t){const{appContext:o}=it();let d;const n=p=>{d=document.createElement("div"),d.className="flow-form-wrapper";const l=tl(t.formPath),r=Ue(l,{...k(e),...k(p)}),i=Ue(t.type==="dialog"?zt:Wt,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:a,...t.overlay},r);i.appContext=o,Jt(i,d),document.body.appendChild(d)},a=()=>{d&&document.body.removeChild(d)};return{open:n,close:a}}function tl(e){return e?Gt(()=>Xt(()=>import(e),[])):We}const ol=A({setup(){const{flowDetail:e,formData:t,detail:o}=ce(),d=Ko(e.value),{proxy:n}=it(),a=O({});G(()=>{const{formOption:r}=e.value.process??{};a.value=ft.bind(n)(r||'{"menuBtn":false}'),a.value.detail=!!o.value});const p=O();function l(){return ze(p)}return{form:t,option:a,defaults:d,formRef:p,validate:l}},render(){return Ue(D("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),ll=A({__name:"upload-table",setup(e){const{flowDetail:t,fileIds:o}=ce(),{upload:{action:d,headers:n,preview:a,download:p,props:l}={}}=z(),r=typeof n=="function"?n():n,i=U(()=>{var v,h;return((h=(v=t.value)==null?void 0:v.task)==null?void 0:h.flowInstanceId)??ut()}),m={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"æ–‡ä»¶å",prop:"fileName"},{label:"æ–‡ä»¶ç±»å‹",prop:"fileType"},{label:"æ–‡ä»¶å¤§å°",prop:"fileSize"},{label:"ç‰ˆæœ¬",prop:"version"},{label:"ä¸Šä¼ æ—¶é—´",prop:"createTime"}]},{bindVal:s,getDataList:f,handleDel:c,handleSave:b,afterGetList:y,crudStateRefs:{tableData:u}}=X({crudOption:{...pl(),saveSuccessMsg:"ä¸Šä¼ æˆåŠŸ"},tableOption:m,queryForm:{isLatest:1,flowInstanceId:i.value}});y(()=>{o.value=u.value.map(v=>v.id).join(",")}),f();async function w(v,h){var C,x;const{fileName:V,fileType:I,fileSize:F,fileUrl:N,res:R}=l,$={fileName:ye({res:v},`${R}.${V}`),fileType:ye({res:v},`${R}.${I}`),fileSize:ye({res:v},`${R}.${F}`),fileUrl:ye({res:v},`${R}.${N}`),taskId:(x=(C=t.value)==null?void 0:C.task)==null?void 0:x.taskId,flowInstanceId:i.value,rootMark:(h==null?void 0:h.rootMark)||"",version:typeof(h==null?void 0:h.version)=="number"?h.version+1:1};await b($,f,()=>{})}return(v,h)=>{const V=D("el-button"),I=D("el-upload"),F=D("avue-crud");return T(),S(F,oe(le(k(s))),{"menu-left":_(()=>[g(I,{action:k(d),headers:k(r),"show-file-list":!1,onSuccess:h[0]||(h[0]=N=>w(N))},{default:_(()=>[g(V,{type:"primary",icon:"el-icon-upload"},{default:_(()=>[P(" ç‚¹å‡»ä¸Šä¼  ")]),_:1})]),_:1},8,["action","headers"])]),menu:_(({row:N,index:R})=>[g(V,{type:"primary",text:"",icon:"el-icon-view",onClick:$=>{var C;return(C=k(a))==null?void 0:C(N,k(u))}},{default:_(()=>[P(" é¢„è§ˆ ")]),_:2},1032,["onClick"]),g(V,{type:"primary",text:"",icon:"el-icon-download",onClick:$=>{var C;return(C=k(p))==null?void 0:C(N,k(u))}},{default:_(()=>[P(" ä¸‹è½½ ")]),_:2},1032,["onClick"]),g(I,{action:k(d),headers:k(r),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:$=>w($,N)},{default:_(()=>[g(V,{type:"primary",text:"",icon:"el-icon-upload"},{default:_(()=>[P(" æ›´æ–°ç‰ˆæœ¬ ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),g(V,{type:"primary",text:"",icon:"el-icon-delete",onClick:$=>k(c)(N,R)},{default:_(()=>[P(" åˆ é™¤ ")]),_:2},1032,["onClick"])]),_:1},16)}}}),al={class:"flow-track"},nl={key:0},sl={key:1},rl=A({__name:"flow-track",setup(e){const{flowDetail:t}=ce(),o=O("table"),d=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],n=U(()=>{var r,i,m;return((m=(i=(r=t.value)==null?void 0:r.flowHistory)==null?void 0:i.filter(s=>s.taskNodeType==="userTask"))==null?void 0:m.map(s=>({...s,duration:Bt(s.duration)})))??[]}),a={addBtn:!1,menu:!1,border:!0,column:[{label:"èŠ‚ç‚¹åç§°",prop:"taskNodeName"},{label:"å¤„ç†äºº",prop:"assigneeName"},{label:"æ¥æ”¶æ—¶é—´",prop:"startTime"},{label:"å¤„ç†æ—¶é—´",prop:"endTime"},{label:"åŠç†æ—¶é•¿",prop:"duration"},{label:"æ“ä½œç±»å‹",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"åŠç†æ„è§",prop:"comment",bind:"comment.comment"}]},{data:p}=be().useParam("flow.handle.type");function l(r){var i;return(i=p.value)==null?void 0:i.find(m=>m.value===r)}return(r,i)=>{var w,v,h;const m=D("el-radio-button"),s=D("el-radio-group"),f=D("avue-crud"),c=D("el-card"),b=D("el-timeline-item"),y=D("el-timeline"),u=D("el-empty");return T(),E(W,null,[g(s,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=V=>o.value=V)},{default:_(()=>[(T(),E(W,null,J(d,V=>g(m,{key:V.label,label:V.label},{default:_(()=>[g(k(se),{icon:V.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),Q("div",al,[o.value==="table"?(T(),S(f,{key:0,data:n.value,option:a},null,8,["data"])):B("",!0),o.value==="graph"?(T(),S(_e,{key:1,"model-value":(v=(w=k(t))==null?void 0:w.process)==null?void 0:v.flowData,"flow-history":(h=k(t))==null?void 0:h.flowHistory,view:"","show-legend":""},null,8,["model-value","flow-history"])):B("",!0),o.value==="timeline"?(T(),E(W,{key:2},[n.value.length?(T(),S(y,{key:0},{default:_(()=>[(T(!0),E(W,null,J([...n.value].reverse(),V=>(T(),S(b,{key:V.id,timestamp:V.endTime,placement:"top"},{default:_(()=>[g(c,null,{default:_(()=>{var I,F,N;return[Q("div",null,j(V.assigneeName)+" å¼€å§‹å¤„ç† ["+j(V.taskNodeName)+"] ç¯èŠ‚ ",1),V.duration?(T(),E("div",nl," åŠç†æ—¶é•¿ï¼š"+j(V.duration),1)):B("",!0),V.type&&((I=V.comment)!=null&&I.comment)?(T(),E("div",sl,j((F=l(V.type))==null?void 0:F.label)+"æ„è§ï¼š"+j((N=V.comment)==null?void 0:N.comment),1)):B("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(T(),S(u,{key:1}))],64)):B("",!0)])],64)}}});const ul=Te(rl,[["__scopeId","data-v-ee4b339a"]]),nt=Symbol("flowPagesConfig"),il={FlowDesign:lo,FormDesign:so,FlowForm:We,tabs:[{label:"å®¡æ‰¹è¡¨å•",prop:"formTab",component:ol},{label:"é™„ä»¶èµ„æ–™",prop:"fileTab",component:ll},{label:"æµç¨‹è·Ÿè¸ª",prop:"trackTab",component:ul}],request:()=>{},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}};var Ct=(e=>(e[e.å¦=0]="å¦",e[e.æ˜¯=1]="æ˜¯",e))(Ct||{});const Ae=ne(Ct);function z(e,t){return e&&t?(e.provide(nt,jt(il,t)),t):Me(nt)}function cl(){const{request:e}=z(),t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},o=r=>e.get(t.list,{params:{type:r,ascs:"sort"}});return{url:t,getList:o,useList:r=>ie(()=>o(r.value).then(i=>i.data.records),{refreshDeps:[r]}),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),batchUpdate:r=>e.post(t.batchUpdate,r)}}var Vt=(e=>(e.é»˜è®¤="default",e.ä¸»è¦="primary",e.æˆåŠŸ="success",e.è­¦å‘Š="warning",e.å±é™©="danger",e.ä¿¡æ¯="info",e.æ–‡å­—="text",e))(Vt||{}),Ye=(e=>(e.æ˜¾ç¤º="true",e.éšè—="false",e.å‘èµ·äºº="startUser",e.å¤„ç†äºº="assignee",e.å·²åŠ="done",e.å¾…åŠ="todo",e.æœªå‘èµ·="notstarted",e.å·²å‘èµ·="started",e.æœªåŠç»“="unfinished",e.å·²åŠç»“="finished",e))(Ye||{}),qe=(e=>(e.ä¸æ˜¾ç¤º="false",e.æŒ‡å®šèŠ‚ç‚¹="specifyNode",e.å®¡æ‰¹äºº="assignee",e.ä¼ é˜…äºº="circulate",e.æ„è§="comment",e))(qe||{}),Dt=(e=>(e[e.ç¦ç”¨=0]="ç¦ç”¨",e[e.æ­£å¸¸=1]="æ­£å¸¸",e))(Dt||{});function Qe(){const{request:e}=z(),t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1,ascs:"sort"}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function dl(){const{request:e}=z(),t={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"};return{getList:l=>e.get(t.list,{params:l}),getTree:l=>e.get(t.tree,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function Tt(){const{request:e}=z(),t={list:"/sapier-flow/flow-circulate/userTaskList",opslist:"/sapier-flow/flow-circulate-ops/list",update:"/sapier-flow/flow-circulate-ops/update",remove:"/sapier-flow/flow-circulate-ops/remove"};return{url:t,getCirculateList:p=>e.get(t.list,{params:p}),getCirculateOpsList:p=>e.get(t.list,{params:p}),updateCirculate:p=>e.post(t.update,p),removeCirculate:p=>e.post(t.remove,{},{params:{ids:p}})}}function Ge(){const{request:e}=z(),t={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"};return{url:t,getList:l=>e.get(t.list,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),deploy:l=>e.post(t.deploy,l),getDetail:l=>e.get(t.detail,{params:l})}}var xt=(e=>(e[e.å¦=0]="å¦",e[e.æ˜¯=1]="æ˜¯",e))(xt||{});function Je(){const{request:e}=z(),t={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",detail:"/sapier-flow/flow-deploy/detail"};return{url:t,getList:a=>e.get(t.list,{params:a}),getDetail:a=>e.get(t.detail,{params:a}),update:a=>e.post(t.update,a)}}function pl(){const{request:e}=z(),t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:a=>e.get(t.list,{params:a}),create:a=>e.post(t.save,a),remove:a=>e.post(t.remove,{},{params:{ids:a}})}}function fl(){const{request:e}=z(),t={list:"/sapier-flow/flow-ops/list"};return{url:t,getTaskOpsList:d=>e.get(t.list,{params:d})}}function be(){const{request:e}=z(),t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},o=i=>e.get(t.list,{params:i}),d=()=>e.get(t.all),n=i=>e.get(t.key,{params:{paramKey:i}});return{url:t,getList:o,getAllParam:d,getParam:n,useParam:i=>ie(()=>n(i).then(m=>m.data)),create:i=>e.post(t.save,i),update:i=>e.post(t.update,i),remove:i=>e.post(t.remove,{},{params:{ids:i}})}}function Lt(){const{request:e}=z(),t={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function ml(){const{request:e}=z(),t={tree:"/sapier-flow/flow-user/tree"},o=n=>e.get(t.tree,{params:{filter:n}});return{url:t,getUserTree:o,useUserTree:()=>ie(()=>o().then(n=>n.data))}}function Nt(){const{request:e}=z(),t={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}var Ot=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Ot||{});function Ke(){const{request:e}=z(),t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy"},o=r=>e.get(t.list,{params:r});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1}).then(r=>r.data.records)),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),deploy:r=>e.post(t.deploy,r)}}const vl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"æŒ‰é’®åç§°",prop:"name",search:!0},{label:"æŒ‰é’®æ ‡è¯†",prop:"buttonKey",search:!0},{label:"æŒ‰é’®å›¾æ ‡",prop:"icon",component:"icon-select"},{label:"æŒ‰é’®ç±»å‹",prop:"buttonType",type:"select",dicData:ne(Vt)},{label:"é»˜è®¤æ˜¾ç¤ºæ¡ä»¶",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ne(Ye),tip:"é€‰æ‹©å¤šä¸ªæ—¶,æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³æ‰æ˜¾ç¤º",labelTip:`æ˜¾ç¤º: å§‹ç»ˆæ˜¾ç¤º;<br/>éšè—: å§‹ç»ˆéšè—;<br/>
      å‘èµ·äºº: ç”¨æˆ·ä¸ºå‘èµ·äººæ—¶æ˜¾ç¤º;<br/>å¤„ç†äºº: ç”¨æˆ·ä¸ºå¤„ç†äººæ—¶æ˜¾ç¤º;<br/>
      å·²åŠ: ä»»åŠ¡çŠ¶æ€ä¸ºå·²åŠæ—¶æ˜¾ç¤º;<br/>å¾…åŠ: ä»»åŠ¡çŠ¶æ€ä¸ºå¾…åŠæ—¶æ˜¾ç¤º;<br/>
      æœªå‘èµ·: æµç¨‹æœªå‘èµ·æ—¶æ˜¾ç¤º;<br/>å·²å‘èµ·: æµç¨‹å·²å‘èµ·æ—¶æ˜¾ç¤º;<br/>
      æœªåŠç»“: æµç¨‹æœªåŠç»“æ—¶æ˜¾ç¤º;<br/>å·²åŠç»“: æµç¨‹å·²åŠç»“æ—¶æ˜¾ç¤º;`},{label:"é»˜è®¤å®¡æ‰¹çª—å£æ˜¾ç¤º",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ne(qe),labelTip:`ä¸æ˜¾ç¤º: ä¸æ˜¾ç¤ºå®¡æ‰¹çª—å£;<br/>æŒ‡å®šèŠ‚ç‚¹: æ˜¾ç¤ºæŒ‡å®šèŠ‚ç‚¹é€‰æ‹©æ¡†(å¸¸ç”¨äºç»¿è‰²é€šé“ç­‰);<br/>
      å®¡æ‰¹äºº: æ˜¾ç¤ºå®¡æ‰¹äººé€‰æ‹©æ¡†;<br/>ä¼ é˜…äºº: æ˜¾ç¤ºä¼ é˜…äººé€‰æ‹©æ¡†;<br/>æ„è§: æ˜¾ç¤ºæ„è§è¾“å…¥æ¡†;`},{label:"æ’åº",prop:"sort",type:"number",value:0},{label:"çŠ¶æ€",prop:"status",type:"switch",value:1,dicData:ne(Dt)},{label:"æŒ‰é’®é¢„è§ˆ",prop:"buttonPreview",width:150}]},_l=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:d}=X({tableOption:vl,crudOption:Qe(),sortOption:{ascs:"sort"}});return d(),(n,a)=>{const p=D("el-button"),l=D("avue-crud");return T(),S(l,oe(le(k(t))),{icon:_(({row:r})=>[g(k(se),{icon:r.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:_(({row:r})=>[g(p,{type:r.buttonType},{default:_(()=>[g(k(se),{icon:r.icon},null,8,["icon"]),P(" "+j(r.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":_(()=>[g(p,{type:k(o).buttonType},{default:_(()=>[g(k(se),{icon:k(o).icon},null,8,["icon"]),P(" "+j(k(o).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Xe={menuBtn:!1,span:24,column:[{label:"æµç¨‹åç§°",prop:"flowName",rules:[{required:!0,message:"è¯·è¾“å…¥æµç¨‹åç§°"}]},{label:"æµç¨‹æ ‡è¯†",prop:"flowKey",rules:[{required:!0,message:"è¯·è¾“å…¥æµç¨‹æ ‡è¯†"}]},{label:"æµç¨‹åˆ†ç±»",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"æµç¨‹å›¾æ ‡",prop:"flowIcon",component:"icon-select"},{label:"æµç¨‹æè¿°",prop:"remarks"},{label:"è‡ªå®šä¹‰è¡¨å•",prop:"formPath"},{label:"å…³è”è¡¨",prop:"formDataTable",type:"select",dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}}]},bl={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:300,column:[...Xe.column.map((e,t)=>({...e,search:t<2})),{label:"æµç¨‹ä¸»ç‰ˆæœ¬",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},It=A({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(e,{emit:t}){const o=e,{getList:d,deploy:n}=Ge(),{bindVal:a,crudStateRefs:{searchForm:p},getDataList:l}=X({tableOption:bl,crudOption:{getList:d},searchForm:{categoryId:o.categoryId}});G(()=>{p.value.categoryId=o.categoryId??"",l()});const r=O(!1);async function i(m){await Ve.confirm("å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œæ˜¯å¦ç¡®è®¤ï¼Ÿ","æç¤º",{type:"success"}),r.value=!0,n({flowModuleId:m.flowModuleId}).then(()=>{Z.success("å‘å¸ƒæˆåŠŸ"),l()}).finally(()=>{r.value=!1})}return(m,s)=>{const f=D("el-button"),c=D("avue-crud");return T(),S(c,oe(le(k(a))),{"menu-left":_(()=>[g(f,{type:"primary",icon:"el-icon-plus",onClick:s[0]||(s[0]=b=>t("add"))},{default:_(()=>[P(" æ–°å¢ ")]),_:1})]),menu:_(({row:b})=>[g(f,{loading:r.value,type:"text",icon:"el-icon-view",onClick:y=>t("view",b)},{default:_(()=>[P(" æŸ¥çœ‹ ")]),_:2},1032,["loading","onClick"]),g(f,{loading:r.value,type:"text",icon:"el-icon-edit",onClick:y=>t("edit",b)},{default:_(()=>[P(" ç¼–è¾‘ ")]),_:2},1032,["loading","onClick"]),g(f,{loading:r.value,type:"text",icon:"el-icon-upload",onClick:y=>i(b)},{default:_(()=>[P(" å‘å¸ƒ ")]),_:2},1032,["loading","onClick"]),g(f,{loading:r.value,type:"text",icon:"el-icon-switch",onClick:y=>t("version",b)},{default:_(()=>[P(" ç‰ˆæœ¬ç®¡ç† ")]),_:2},1032,["loading","onClick"])]),flowIcon:_(({row:b})=>[g(k(se),{icon:b.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),wl={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:250,column:[...Xe.column,{label:"æµç¨‹ç‰ˆæœ¬",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"æ˜¯å¦ä¸»ç‰ˆæœ¬",prop:"mainVersion",type:"select",dicData:[{label:"å¦",value:0},{label:"æ˜¯",value:1}]}]},$t=A({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(e,{emit:t}){const o=e,{getList:d,update:n}=Je(),{bindVal:a,crudStateRefs:{searchForm:p},getDataList:l}=X({tableOption:wl,crudOption:{getList:d,dataPath:"res.data"}});G(()=>{o.flowModuleId&&(p.value.flowModuleId=o.flowModuleId,l())});const r=O(!1);async function i(m){await Ve.confirm(`ç¡®å®šå°† ${m.flowName}(${m.flowKey}:v${m.version}) è®¾ä¸ºä¸»ç‰ˆæœ¬?`,"æç¤º",{type:"warning"}),r.value=!0,n({flowDeployId:m.flowDeployId,flowModuleId:m.flowModuleId,mainVersion:1}).then(()=>{Z.success("è®¾ç½®æˆåŠŸ"),l()}).finally(()=>{r.value=!1})}return(m,s)=>{const f=D("el-button"),c=D("avue-crud");return T(),S(c,oe(le(k(a))),{"menu-left":_(()=>[g(f,{loading:r.value,type:"primary",icon:"el-icon-arrow-left",onClick:s[0]||(s[0]=b=>t("back"))},{default:_(()=>[P(" è¿”å› ")]),_:1},8,["loading"])]),menu:_(({row:b})=>[g(f,{loading:r.value,type:"text",icon:"el-icon-view",onClick:y=>t("view",b)},{default:_(()=>[P(" æŸ¥çœ‹ ")]),_:2},1032,["loading","onClick"]),g(f,{loading:r.value,type:"text",icon:"el-icon-edit",onClick:y=>t("edit",b)},{default:_(()=>[P(" ç¼–è¾‘ ")]),_:2},1032,["loading","onClick"]),g(f,{loading:r.value,disabled:b.mainVersion===k(xt).æ˜¯,type:"text",icon:"el-icon-switch",onClick:y=>i(b)},{default:_(()=>[P(" è®¾ä¸ºä¸»ç‰ˆæœ¬ ")]),_:2},1032,["loading","disabled","onClick"])]),flowIcon:_(({row:b})=>[g(k(se),{icon:b.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),st={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"åˆ†ç±»åç§°",prop:"name",rules:[{required:!0,message:"è¯·è¾“å…¥åˆ†ç±»åç§°"}]},{label:"æè¿°",prop:"remark"}]}},yl=A({__name:"index",emits:["node-click"],setup(e,{emit:t}){const{crudStateRefs:{formData:o,tableData:d},getDataList:n,handleSave:a,handleUpdate:p,handleDel:l}=X({crudOption:{rowKey:"id",...dl(),dataPath:"res.data"},tableOption:st,pageOption:{pageSize:20}});n();function r(s,f,c,b){a(f,c,b)}function i(s,f,c,b){p(f,NaN,c,b)}async function m(s,f){await l(s.data,NaN),f()}return(s,f)=>{const c=D("avue-tree");return T(),S(c,{modelValue:k(o),"onUpdate:modelValue":f[0]||(f[0]=b=>ee(o)?o.value=b:null),option:k(st),data:k(d),onNodeClick:f[1]||(f[1]=b=>t("node-click",b)),onSave:r,onUpdate:i,onDel:m},null,8,["modelValue","option","data"])}}}),Ze=A({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(e,{emit:t}){var r;const o=e,{FormDesign:d}=z(),n=U({get(){return o.modelValue?ft(o.modelValue):{menuBtn:!1,span:24}},set(i){t("update:modelValue",ro(i,{useJson5:!1}))}}),a=U(()=>o.fields?JSON.parse(o.fields):[]),p=U(()=>{const i={type:"select",dicData:a.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...i,props:{label:"name",value:"name",desc:"comment"}},{...i,props:{label:"comment",value:"comment",desc:"name"}}]}),l={form:{settings:Array.from({length:((r=uo.settings)==null?void 0:r.length)??0}).fill({}).concat({label:"æ ·å¼ç±»",prop:"class"})}};return(i,m)=>{const s=D("avue-form");return i.view?(T(),S(s,{key:0,class:Zt(n.value.class),"model-value":{},option:n.value},null,8,["class","option"])):(T(),S(k(d),{key:1,modelValue:n.value,"onUpdate:modelValue":m[0]||(m[0]=f=>n.value=f),"base-option":p.value,resources:l},null,8,["modelValue","base-option"]))}}}),gl=Q("span",null,"æµç¨‹è®¾è®¡",-1),hl={key:0},kl={key:1},Cl={style:{height:"calc(100vh - 144px)"}},Vl=A({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(e,{emit:t}){const d=pe(e),{visible:n,modelValue:a}=d,{create:p,deploy:l,getDetail:r,update:i}=Ge(),{getDetail:m,update:s}=Je(),f=["æµç¨‹ä¿¡æ¯","è¡¨å•è®¾è®¡","æ¨¡å‹è®¾è®¡","å®Œæˆ"],c=O(!1);de(n,async $=>{if(!$)return;const{flowModuleId:C}=a.value,{flowDeployId:x}=a.value;try{c.value=!0;let L={};x?L=await m({flowDeployId:x}):C&&(L=await r({flowModuleId:C})),a.value=L.data}finally{c.value=!1}},{immediate:!0});const{data:b}=Nt().useList(),{data:y}=Lt().useList(),{data:u}=Ke().useList(),w=U(()=>{var $,C;return(C=($=u.value)==null?void 0:$.find(x=>x.tableName===a.value.formDataTable))==null?void 0:C.tableFields}),v=O(0),h=U(()=>{var $,C;return v.value===1?(($=b.value)==null?void 0:$.map(x=>({label:x.formName,value:x.formOption})))??[]:v.value===2?((C=y.value)==null?void 0:C.map(x=>({label:x.flowName,value:x.flowData})))??[]:[]});function V($){v.value===1?a.value.formOption=$.value:v.value===2&&(a.value.flowData=$.value)}const I=O();async function F($){v.value===0&&await ze(I),c.value=!0;const{flowModuleId:C}=a.value,{flowDeployId:x}=a.value;try{x?await s(a.value):C?await i(a.value):await p(a.value).then(L=>{a.value.flowModuleId=L.data.flowModuleId}),Z.success("ä¿å­˜æˆåŠŸ")}finally{c.value=!1}typeof $=="number"?v.value=$:v.value++}async function N(){await Ve.confirm("å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œæ˜¯å¦ç¡®è®¤ï¼Ÿ","æç¤º"),c.value=!0,l({flowModuleId:a.value.flowModuleId}).then(()=>{Z.success("å‘å¸ƒæˆåŠŸ")}).finally(()=>{c.value=!1})}function R(){n.value=!1,v.value=0,a.value={},t("close")}return($,C)=>{const x=D("el-link"),L=D("el-dropdown-item"),K=D("el-dropdown-menu"),H=D("el-dropdown"),Y=D("el-col"),M=D("el-step"),we=D("el-steps"),re=D("el-button"),Ne=D("el-row"),Oe=D("avue-form"),St=D("el-result"),Rt=D("el-dialog"),Ft=ct("loading");return T(),S(Rt,{modelValue:k(n),"onUpdate:modelValue":C[5]||(C[5]=q=>ee(n)?n.value=q:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:R},{header:_(()=>[g(Ne,{justify:"center"},{default:_(()=>[g(Y,{span:5},{default:_(()=>{var q,fe,Ie,et;return[Q("div",null,[gl,(q=k(a))!=null&&q.flowName?(T(),E("span",hl," - "+j((fe=k(a))==null?void 0:fe.flowName),1)):B("",!0),(Ie=k(a))!=null&&Ie.version?(T(),E("span",kl," - V"+j((et=k(a))==null?void 0:et.version),1)):B("",!0)]),h.value.length?(T(),S(H,{key:0},{dropdown:_(()=>[g(K,null,{default:_(()=>[(T(!0),E(W,null,J(h.value,$e=>(T(),S(L,{key:$e.label,onClick:Ql=>V($e)},{default:_(()=>[P(j($e.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:_(()=>[g(x,{icon:"el-icon-arrow-down",underline:!1},{default:_(()=>[P(" é€‰æ‹©æ¨¡æ¿ ")]),_:1})]),_:1})):B("",!0)]}),_:1}),g(Y,{span:14},{default:_(()=>[g(we,{active:v.value,simple:"","process-status":"finish","finish-status":"success"},{default:_(()=>[(T(),E(W,null,J(f,(q,fe)=>g(M,{key:fe,title:q,onClick:Ie=>F(fe)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),g(Y,{span:5,style:{"text-align":"right"}},{default:_(()=>[g(re,{disabled:v.value===0,loading:c.value,type:"primary",onClick:C[0]||(C[0]=q=>v.value--)},{default:_(()=>[P(" ä¸Šä¸€æ­¥ ")]),_:1},8,["disabled","loading"]),g(re,{disabled:v.value===f.length-1,type:"primary",loading:c.value,onClick:C[1]||(C[1]=q=>F())},{default:_(()=>[P(" ä¸‹ä¸€æ­¥ ")]),_:1},8,["disabled","loading"]),g(re,{onClick:R},{default:_(()=>[P(" å…³é—­ ")]),_:1})]),_:1})]),_:1})]),default:_(()=>[dt((T(),E("div",Cl,[v.value===0?(T(),S(Oe,{key:0,ref_key:"formRef",ref:I,modelValue:k(a),"onUpdate:modelValue":C[2]||(C[2]=q=>ee(a)?a.value=q:null),option:k(Xe),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):B("",!0),v.value===1?(T(),S(Ze,{key:1,modelValue:k(a).formOption,"onUpdate:modelValue":C[3]||(C[3]=q=>k(a).formOption=q),fields:w.value},null,8,["modelValue","fields"])):B("",!0),v.value===2?(T(),S(_e,{key:2,modelValue:k(a).flowData,"onUpdate:modelValue":C[4]||(C[4]=q=>k(a).flowData=q),"flow-form-option":k(a).formOption},null,8,["modelValue","flow-form-option"])):B("",!0),v.value===3?(T(),S(St,{key:3,icon:"success",title:"æµç¨‹è®¾è®¡å®Œæˆ"},{extra:_(()=>[k(a).flowDeployId?B("",!0):(T(),S(re,{key:0,type:"primary",onClick:N},{default:_(()=>[P(" å‘å¸ƒ ")]),_:1})),g(re,{onClick:R},{default:_(()=>[P(" å…³é—­ ")]),_:1})]),_:1})):B("",!0)])),[[Ft,c.value]])]),_:1},8,["modelValue"])}}}),Dl=Q("span",null,"æµç¨‹æŸ¥çœ‹",-1),Tl={key:0},xl={key:1},Ll=A({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(e){const o=pe(e),{visible:d,modelValue:n}=o,{getDetail:a}=Ge(),{getDetail:p}=Je(),l=O("form"),r=O(!1);de(d,async m=>{if(!m)return;const{flowModuleId:s}=n.value,{flowDeployId:f}=n.value;try{r.value=!0;let c={};f?c=await p({flowDeployId:f}):s&&(c=await a({flowModuleId:s})),n.value={...c.data}}finally{r.value=!1}},{immediate:!0});function i(){n.value={},l.value="form"}return(m,s)=>{const f=D("el-tab-pane"),c=D("el-tabs"),b=D("el-dialog"),y=ct("loading");return T(),S(b,{modelValue:k(d),"onUpdate:modelValue":s[3]||(s[3]=u=>ee(d)?d.value=u:null),width:"60%",top:"0",onClose:i},{header:_(()=>{var u,w,v,h;return[Dl,(u=k(n))!=null&&u.flowName?(T(),E("span",Tl," - "+j((w=k(n))==null?void 0:w.flowName),1)):B("",!0),(v=k(n))!=null&&v.version?(T(),E("span",xl," - V"+j((h=k(n))==null?void 0:h.version),1)):B("",!0)]}),default:_(()=>[dt((T(),S(c,{modelValue:l.value,"onUpdate:modelValue":s[2]||(s[2]=u=>l.value=u)},{default:_(()=>[g(f,{label:"æŸ¥çœ‹è¡¨å•",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:_(()=>[l.value==="form"&&k(n).formOption?(T(),S(Ze,{key:0,modelValue:k(n).formOption,"onUpdate:modelValue":s[0]||(s[0]=u=>k(n).formOption=u),view:""},null,8,["modelValue"])):B("",!0)]),_:1}),g(f,{label:"æŸ¥çœ‹æµç¨‹",name:"flow",style:{height:"600px"}},{default:_(()=>[l.value==="flow"?(T(),S(_e,{key:0,modelValue:k(n).flowData,"onUpdate:modelValue":s[1]||(s[1]=u=>k(n).flowData=u),view:""},null,8,["modelValue"])):B("",!0)]),_:1})]),_:1},8,["modelValue"])),[[y,r.value]])]),_:1},8,["modelValue"])}}}),Nl=A({__name:"index",setup(e){const t=O("definition"),o=O({}),d=O(""),n=O("");function a(b){d.value===b.id?d.value="":d.value=b.id}const p=O(!1),l=O(!1);function r(){o.value={},p.value=!0}function i(b){o.value=b,p.value=!0}function m(b){o.value=b,l.value=!0}function s(b){n.value=b.flowModuleId||"",t.value="deploy"}function f(){n.value="",t.value="definition"}async function c(){const b=t.value;await me(),t.value="",await me(),t.value=`${b}`}return(b,y)=>{const u=D("el-col"),w=D("el-row");return T(),S(w,{gutter:20},{default:_(()=>[g(u,{span:4},{default:_(()=>[g(yl,{onNodeClick:a})]),_:1}),g(u,{span:20},{default:_(()=>[t.value==="definition"?(T(),S(It,{key:0,"category-id":d.value,onAdd:r,onEdit:i,onView:m,onVersion:s},null,8,["category-id"])):B("",!0),t.value==="deploy"?(T(),S($t,{key:1,"flow-module-id":n.value,onEdit:i,onView:m,onBack:f},null,8,["flow-module-id"])):B("",!0),g(Vl,{modelValue:o.value,"onUpdate:modelValue":y[0]||(y[0]=v=>o.value=v),visible:p.value,"onUpdate:visible":y[1]||(y[1]=v=>p.value=v),onClose:c},null,8,["modelValue","visible"]),g(Ll,{modelValue:o.value,"onUpdate:modelValue":y[2]||(y[2]=v=>o.value=v),visible:l.value,"onUpdate:visible":y[3]||(y[3]=v=>l.value=v)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),Ol=[{label:"æµç¨‹åç§°",prop:"flowName"},{label:"æµç¨‹æ ‡è¯†",prop:"flowKey"},{label:"æµç¨‹åˆ†ç±»",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"æ ‡é¢˜",prop:"processTitle",search:!0},{label:"æµæ°´å·",prop:"serialNumber"},{label:"å½“å‰èŠ‚ç‚¹",prop:"taskNodeName"},{label:"å®¡æ‰¹äºº",prop:"assigneeName"},{label:"ç”³è¯·äºº",prop:"applyUserName"},{label:"æ¥æ”¶æ—¶é—´",prop:"startTime"},{label:"ä»»åŠ¡çŠ¶æ€",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}].map(e=>({...e,display:!1})),Il=[{label:"å®¡æ‰¹äºº",prop:"assignee"},{label:"èŠ‚ç‚¹åç§°",prop:"taskNodeName"},{label:"æ¥æ”¶æ—¶é—´",prop:"startTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"ç»“æŸæ—¶é—´",prop:"endTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"è€—æ—¶",prop:"duration"},{label:"ä¼ é˜…æ„è§",prop:"comment"}].map(e=>({...e,hide:!0})),$l={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!0,addBtn:!1,column:[...Ol,...Il]},Sl=A({__name:"index",setup(e){const t=co("debugMode",!1),{getTaskOpsList:o}=fl(),{getCirculateOpsList:d,updateCirculate:n,removeCirculate:a}=Tt(),{bindVal:p,getDataList:l,crudStateRefs:{searchForm:r,crudOption:i}}=X({tableOption:$l,crudOption:{getList:o},searchForm:{status:2},sortOption:{descs:"start_time"}});xe(r,l,{debounce:300,immediate:!0,deep:!0});const m=O("task"),s=[{label:"ä»»åŠ¡",name:"task",getList:o},{label:"ä¼ é˜…",name:"circulate",getList:d,update:n,remove:a}];function f({paneName:u}){const w=s.find(v=>v.name===u);i.value.getList=w.getList,i.value.update=w.update,i.value.remove=w.remove,l()}const{open:c,close:b}=kt({onComplete:()=>(b(),l())},{type:"drawer"});function y(u){c({flowKey:u.flowKey,taskId:u.taskId,instanceId:u.flowInstanceId,debug:t.value,circulateId:u.id})}return(u,w)=>{const v=D("el-tab-pane"),h=D("el-tabs"),V=D("el-switch"),I=D("el-button"),F=D("el-link"),N=D("avue-crud");return T(),E(W,null,[g(h,{modelValue:m.value,"onUpdate:modelValue":w[0]||(w[0]=R=>m.value=R),onTabClick:f},{default:_(()=>[(T(),E(W,null,J(s,R=>g(v,{key:R.name,label:R.label,name:R.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),g(N,eo(k(p),{permission:{menu:m.value==="circulate"}}),{"menu-right":_(()=>[g(I,{type:"text"},{default:_(()=>[g(V,{modelValue:k(t),"onUpdate:modelValue":w[1]||(w[1]=R=>ee(t)?t.value=R:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:_(({row:R})=>[g(F,{type:"primary",underline:!1,onClick:$=>y(R)},{default:_(()=>[P(j(R.processTitle||"æ— æ ‡é¢˜"),1)]),_:2},1032,["onClick"])]),_:1},16,["permission"])],64)}}}),Rl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,column:[{label:"é…ç½®åç§°",prop:"paramName",search:!0},{label:"é…ç½®Key",prop:"paramKey",search:!0},{label:"å¤‡æ³¨",prop:"remark"},{label:"ç³»ç»Ÿå†…ç½®",prop:"paramType",type:"switch",dicData:Ae},{label:"é…ç½®å€¼",prop:"paramValue",type:"textarea",maxRows:20,span:24,overHidden:!0}]},Fl=A({__name:"index",setup(e){const{bindVal:t,getDataList:o}=X({tableOption:Rl,crudOption:be()});return o(),(d,n)=>{const a=D("avue-crud");return T(),S(a,oe(le(k(t))),null,16)}}}),Pl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"æµç¨‹åç§°",prop:"flowName"},{label:"æµç¨‹æ ‡è¯†",prop:"flowKey"},{label:"æµç¨‹åˆ†ç±»",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"æ ‡é¢˜",prop:"processTitle",search:!0},{label:"æµæ°´å·",prop:"serialNumber"},{label:"å½“å‰èŠ‚ç‚¹",prop:"taskNodeName"},{label:"å®¡æ‰¹äºº",prop:"assigneeName"},{label:"ç”³è¯·äºº",prop:"applyUserName"},{label:"æ¥æ”¶æ—¶é—´",prop:"startTime"}]},Ul={class:"flow-list"},El=["onClick"],Al={class:"flow-name"},Kl=A({__name:"index",setup(e){const t=O([]),{getPublishList:o,getTaskList:d}=Le(),{getCirculateList:n}=Tt();o().then(u=>{t.value=u.data});const a=[{label:"å¾…åŠ",value:2},{label:"å·²åŠ",value:1}],{bindVal:p,getDataList:l,crudStateRefs:{searchForm:r,crudOption:i}}=X({tableOption:Pl,crudOption:{getList:d},searchForm:{status:2}});xe(r,l,{debounce:300,immediate:!0,deep:!0});const m=O("task"),s=[{label:"ä»»åŠ¡",name:"task",getList:d},{label:"ä¼ é˜…",name:"circulate",getList:n}];function f({paneName:u}){const w=s.find(v=>v.name===u);i.value.getList=w.getList,l()}const{open:c,close:b}=kt({onComplete:()=>(b(),l())},{type:"drawer"});function y(u){c({flowKey:u.flowKey,taskId:u.taskId,instanceId:u.flowInstanceId,circulateId:u.id,detail:u.taskId?u.status===gt.å·²åŠ:!1})}return(u,w)=>{const v=D("el-button"),h=D("el-collapse-item"),V=D("el-collapse"),I=D("el-card"),F=D("el-divider"),N=D("el-tab-pane"),R=D("el-tabs"),$=D("avue-radio"),C=D("el-link"),x=D("avue-crud");return T(),E(W,null,[g(I,{"body-style":{padding:"0 20px"}},{default:_(()=>[g(V,{"model-value":"1"},{default:_(()=>[g(h,{name:"1"},{title:_(()=>[g(v,{text:"",icon:"el-icon-promotion"},{default:_(()=>[P(" å‘èµ·å®¡æ‰¹ ")]),_:1})]),default:_(()=>[Q("div",Ul,[(T(!0),E(W,null,J(t.value,L=>(T(),E("div",{key:L.flowKey,class:"flow-item",onClick:K=>y(L)},[g(k(se),{class:"flow-icon",icon:L.flowIcon,width:"60"},null,8,["icon"]),Q("div",Al,j(L.flowName),1)],8,El))),128))])]),_:1})]),_:1})]),_:1}),g(F,{direction:"horizontal","content-position":"left"}),g(R,{modelValue:m.value,"onUpdate:modelValue":w[0]||(w[0]=L=>m.value=L),onTabClick:f},{default:_(()=>[(T(),E(W,null,J(s,L=>g(N,{key:L.name,label:L.label,name:L.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),g(x,oe(le(k(p))),{"menu-left":_(()=>[g($,{modelValue:k(r).status,"onUpdate:modelValue":w[1]||(w[1]=L=>k(r).status=L),button:"",dic:a},null,8,["modelValue"])]),processTitle:_(({row:L})=>[g(C,{type:"primary",underline:!1,onClick:K=>y(L)},{default:_(()=>[P(j(L.processTitle||"æ— æ ‡é¢˜"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}});const Ml=Te(Kl,[["__scopeId","data-v-e1f72e36"]]),Bl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"æµç¨‹æ ‡è¯†",prop:"flowKey",search:!0},{label:"æµç¨‹åç§°",prop:"flowName",search:!0},{label:"æµç¨‹æ¨¡å‹æ•°æ®",prop:"flowData",display:!1},{label:"æµç¨‹å¤‡æ³¨",prop:"remarks"},{label:"æ’åº",prop:"sort"}]},jl=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:d,handleUpdate:n}=X({tableOption:Bl,crudOption:Lt()});d();const a=O(!1);async function p(r){o.value=r,a.value=!0}async function l(){await n(o.value,NaN,()=>a.value=!1,()=>{})}return(r,i)=>{const m=D("el-button"),s=D("avue-crud"),f=D("el-dialog");return T(),E(W,null,[g(s,oe(le(k(t))),{flowData:_(({row:c})=>[g(m,{type:"primary",text:"",icon:"el-icon-crop",onClick:b=>p(c)},{default:_(()=>[P(" è®¾è®¡ ")]),_:2},1032,["onClick"])]),_:1},16),g(f,{modelValue:a.value,"onUpdate:modelValue":i[2]||(i[2]=c=>a.value=c),title:`æ¨¡å‹è®¾è®¡-${k(o).flowName}`,fullscreen:"","destroy-on-close":""},{footer:_(()=>[g(m,{type:"primary",onClick:l},{default:_(()=>[P(" ä¿å­˜ ")]),_:1}),g(m,{onClick:i[1]||(i[1]=c=>a.value=!1)},{default:_(()=>[P(" å–æ¶ˆ ")]),_:1})]),default:_(()=>[g(_e,{modelValue:k(o).flowData,"onUpdate:modelValue":i[0]||(i[0]=c=>k(o).flowData=c),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Hl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"è¡¨å•æ ‡è¯†",prop:"formKey",search:!0},{label:"è¡¨å•åç§°",prop:"formName",search:!0},{label:"è¡¨å•é…ç½®",prop:"formOption",display:!1},{label:"è¡¨å•å¤‡æ³¨",prop:"remarks"},{label:"æ’åº",prop:"sort",type:"number"}]},zl=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:d,handleUpdate:n}=X({tableOption:Hl,crudOption:Nt()});d();const a=O(!1);async function p(r){o.value={...r},a.value=!0}async function l(){await n(o.value,NaN,()=>a.value=!1,()=>{})}return(r,i)=>{const m=D("el-button"),s=D("avue-crud"),f=D("el-dialog");return T(),E(W,null,[g(s,oe(le(k(t))),{formOption:_(({row:c})=>[g(m,{type:"primary",text:"",icon:"el-icon-crop",onClick:b=>p(c)},{default:_(()=>[P(" è®¾è®¡ ")]),_:2},1032,["onClick"])]),_:1},16),g(f,{modelValue:a.value,"onUpdate:modelValue":i[2]||(i[2]=c=>a.value=c),title:`è¡¨å•è®¾è®¡-${k(o).formName}`,fullscreen:"","destroy-on-close":""},{footer:_(()=>[g(m,{type:"primary",onClick:l},{default:_(()=>[P(" ä¿å­˜ ")]),_:1}),g(m,{onClick:i[1]||(i[1]=c=>a.value=!1)},{default:_(()=>[P(" å–æ¶ˆ ")]),_:1})]),default:_(()=>[g(Ze,{modelValue:k(o).formOption,"onUpdate:modelValue":i[0]||(i[0]=c=>k(o).formOption=c),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),rt=[{label:"å­—æ®µåç§°",prop:"name"},{label:"å­—æ®µå¤‡æ³¨",prop:"comment"},{label:"å­—æ®µç±»å‹",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:ne(Ot)},{label:"å­—æ®µé•¿åº¦",prop:"size",type:"number"},{label:"å°æ•°ä½",prop:"point",type:"number"},{label:"é»˜è®¤å€¼",prop:"default"},{label:"æ˜¯å¦ä¸»é”®",prop:"primary",type:"switch",dicData:Ae,value:0},{label:"æ˜¯å¦å…è®¸ä¸ºç©º",prop:"permitNull",type:"switch",dicData:Ae,value:1}],Wl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,dialogFullscreen:!0,column:[{label:"è¡¨å",prop:"tableName",search:!0},{label:"è¡¨æ³¨é‡Š",prop:"tableComment",search:!0},{label:"è¡¨å¼•æ“",prop:"tableEngine"},{label:"è¡¨ä¸»é”®ç­–ç•¥",prop:"tablePrimary"},{label:"æ•°æ®åº“å­—æ®µ",prop:"editFields",hide:!0,type:"dynamic",children:{column:rt}},{label:"é»˜è®¤å­—æ®µ",prop:"defaultFields",hide:!0,type:"dynamic",children:{addBtn:!1,delBtn:!1,column:rt}}]},Yl=Q("br",null,null,-1),ql=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o,defaults:d},getDataList:n,afterOpen:a,beforeSubmit:p}=X({crudOption:Ke(),tableOption:Wl});n();const{data:l}=be().useParam("table.default.fields");a(f=>{if(o.value.defaultFields=l.value??[],f==="edit"){const c=JSON.parse(o.value.tableFields);o.value.editFields=mt(c,l.value??[],"name")}}),p(f=>{const c=[...f.defaultFields,...f.editFields];f.tableFields=JSON.stringify(c)});const r=O(!1);G(()=>{var f;(f=d.value)!=null&&f.defaultFields&&(d.value.defaultFields.display=r.value)});const{deploy:i}=Ke(),m=O(!1);async function s(f){await Ve.confirm("éƒ¨ç½²å°†è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“è¡¨ï¼Œæ˜¯å¦ç¡®è®¤ï¼Ÿ","æç¤º",{type:"success"}),m.value=!0,i({id:f.id}).then(()=>{Z.success("éƒ¨ç½²æˆåŠŸ"),n()}).finally(()=>{m.value=!1})}return(f,c)=>{const b=D("el-button"),y=D("el-switch"),u=D("el-tooltip"),w=D("avue-crud");return T(),S(w,oe(le(k(t))),{menu:_(({row:v})=>[g(b,{type:"text",icon:"el-icon-upload",onClick:h=>s(v)},{default:_(()=>[P(" éƒ¨ç½² ")]),_:2},1032,["onClick"])]),"editFields-label":_(()=>[Q("div",null,[P(" æ•°æ®åº“å­—æ®µ "),Yl,g(u,{content:"æ˜¾ç¤ºé»˜è®¤å­—æ®µ"},{default:_(()=>[g(y,{modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=v=>r.value=v)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),en={install(e,t){e.component("FlowButton",_l).component("FlowDefinition",It).component("FlowDeploy",$t).component("FlowForm",We).component("FlowManage",Nl).component("FlowOps",Sl).component("FlowParam",Fl).component("FlowTemplate",jl).component("FormTemplate",zl).component("TableTemplate",ql).component("FlowWorkbench",Ml),z(e,t)}};export{il as CONFIG_DEFAULT,nt as CONFIG_PROVIDE_KEY,_l as FlowButton,It as FlowDefinition,$t as FlowDeploy,We as FlowForm,Nl as FlowManage,Sl as FlowOps,Fl as FlowParam,jl as FlowTemplate,Ml as FlowWorkbench,zl as FormTemplate,ql as TableTemplate,Ct as Whether,en as default,tl as resolveFlowFormComponent,z as useConfigProvider,kt as useFlowForm,el as useFlowFormOverlay,Zo as useFlowFormWindow,Ae as whetherDic};
