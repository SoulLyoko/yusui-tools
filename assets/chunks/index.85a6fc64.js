import{Q as Z,aM as ut,aN as Pt,aO as ne,aP as Ut,al as Et,an as At,aQ as X,aR as Kt,K as Mt,R as Ve}from"../composables_use-crud_index.md.78467a23.js";import{I as se}from"../components_icon-select_index.md.445f9467.js";import{X as Me,B as De,r as I,s as ge,d as U,e as G,w as de,i as ee,u as k,n as ve,Y as Bt,h as A,H as D,j as T,k as E,R as J,F as W,D as $,E as b,J as g,p as P,q as j,a3 as tt,C as Q,_ as Te,G as B,K as jt,l as Ht,O as ot,b as it,L as zt,a5 as Ue,aA as Wt,M as Yt,ai as oe,aj as le,m as qt,aM as ct,aa as dt,I as Qt}from"./framework.19abbf41.js";import{a as Gt,d as Jt,e as Xt}from"../flow-design_demo.md.dd48f6fb.js";import{_ as Zt}from"./index.vue_vue_type_script_setup_true_lang.467901d0.js";import{a7 as pt,a8 as eo,a9 as to,a5 as mt,_ as oo,a4 as lo,A as ao}from"./index.vue_vue_type_script_setup_true_lang.96cac69c.js";import{u as pe,w as xe,d as no,e as so}from"./theme.df9598b1.js";import{p as ro}from"../components_input-tree_index.md.585521e0.js";import{d as ft}from"./differenceBy.788050f0.js";import{a9 as uo,au as io,aj as we}from"./index.daca2715.js";import{J as co,K as po}from"../app.6021b25a.js";import"./uniqueId.3d52e0a8.js";import"./vue.runtime.esm-bundler.6ea500c1.js";import"../components_index.md.ed080eb5.js";import"../components_v-text_index.md.ab7897dc.js";import"../composables_index.md.8102a498.js";import"../flow-design_index.md.267dc74d.js";import"../flow-pages_index.md.61086be5.js";import"../flow-pages_pages_flow-button_index.md.cff1c959.js";import"../flow-pages_pages_flow-manage_index.md.3fe7431a.js";import"../flow-pages_pages_flow-ops_index.md.740e87f3.js";import"../flow-pages_pages_flow-param_index.md.38d922b3.js";import"../flow-pages_pages_flow-template_index.md.ab1c2131.js";import"../flow-pages_pages_flow-workbench_index.md.3abb69f4.js";import"../flow-pages_pages_form-template_index.md.d2944a19.js";import"../flow-pages_pages_table-template_index.md.d5d619a4.js";import"../form-design_demo.md.6bd3bed6.js";import"../form-design_index.md.e65b4571.js";import"../guide_changelog.md.dd2417b7.js";import"../guide_start.md.63241896.js";import"../index.md.10a29696.js";import"../plugins_avue-patch_index.md.95104f3a.js";import"../plugins_compatible-tips_index.md.14ed4abc.js";import"../plugins_env-dts_index.md.d8ca01e0.js";import"../plugins_index.md.06e5bca9.js";import"../plugins_load-proxy_index.md.8522f6d0.js";import"../plugins_setup-extend_index.md.c81cc814.js";import"../plugins_uni-ui-patch_index.md.cb9f52bf.js";import"../plugins_uview-patch_index.md.55020e2d.js";import"../types_avue_index.md.d294f23a.js";import"../types_index.md.b2ecc5b3.js";import"../utils_date_dateFormat.md.d75b5beb.js";import"../utils_date_durationFormat.md.3452ef38.js";import"../utils_emitter_mittAsync.md.c888c2ea.js";import"../utils_index.md.7db024e0.js";import"../utils_math_index.md.dfd5c6ea.js";import"../utils_object_filterObj.md.f0dc97c3.js";import"../utils_object_filterObjDeep.md.ff4b0903.js";import"../utils_object_getDataType.md.1d2816c5.js";import"../utils_string_deserialize.md.6296f7ed.js";import"../utils_string_serialize.md.547ef93e.js";import"../utils_string_uuid.md.e68bfa8c.js";import"../utils_tool_awaitTo.md.93c39e8e.js";import"../utils_tool_enumToDic.md.cff2a41a.js";import"../utils_tool_sleep.md.76753705.js";import"../utils_tree_buildTree.md.22d96cae.js";import"../utils_tree_filterTree.md.370e7afb.js";import"../utils_tree_findTree.md.f313e2c8.js";import"../utils_tree_flatTree.md.d34a1d9c.js";import"../utils_tree_treeMap.md.334d787b.js";const mo={},fo=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),vo=()=>mo,ae=e=>e,Ee=e=>Array.isArray(e),Be=e=>e!==null&&typeof e=="object",je=e=>e instanceof Function,_e=e=>e==null,He=typeof window>"u",vt=()=>{var e;return He||_e((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},_o=()=>{var e,t;return(e=!He&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},Se=()=>new Promise(()=>{}),te=e=>ee(e)?e.value:e,bo=e=>Be(e)?Object.assign(Ee(e)?[]:{},e):e,he=new Map,yo=e=>_e(e)?void 0:he.get(e),wo=(e,t,o)=>{const c=he.get(e);c!=null&&c.timer&&clearTimeout(c.timer);const s=setTimeout(()=>he.delete(e),t);he.set(e,{...o,timer:s})};function _t(e,t,o){let c,s,a,d,l,r,p=0,f=!1,n=!1,m=!0;const i=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,Be(o)&&(f=!!o.leading,n="maxWait"in o,a=n?Math.max(+o.maxWait||0,t):a,m="trailing"in o?!!o.trailing:m);function _(C){const x=c,L=s;return c=s=void 0,p=C,d=e.apply(L,x),d}function w(C,x){return i?(window.cancelAnimationFrame(l),window.requestAnimationFrame(C)):setTimeout(C,x)}function u(C){if(i)return window.cancelAnimationFrame(C);clearTimeout(C)}function y(C){return p=C,l=w(V,t),f?_(C):d}function v(C){const x=C-r,L=C-p,K=t-x;return n?Math.min(K,a-L):K}function h(C){const x=C-r,L=C-p;return r===void 0||x>=t||x<0||n&&L>=a}function V(){const C=Date.now();if(h(C))return O(C);l=w(V,v(C))}function O(C){return l=void 0,m&&c?_(C):(c=s=void 0,d)}function F(){l!==void 0&&u(l),p=0,c=r=s=l=void 0}function N(){return l===void 0?d:O(Date.now())}function R(){return l!==void 0}function S(){const C=Date.now(),x=h(C);for(var L=arguments.length,K=new Array(L),H=0;H<L;H++)K[H]=arguments[H];if(c=K,s=this,r=C,x){if(l===void 0)return y(r);if(n)return l=w(V,t),_(r)}return l===void 0&&(l=w(V,t)),d}return S.cancel=F,S.flush=N,S.pending=R,S}function go(e,t,o){let c=!0,s=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Be(o)&&(c="leading"in o?!!o.leading:c,s="trailing"in o?!!o.trailing:s),_t(e,t,{leading:c,trailing:s,maxWait:t})}var ho=ae((e,t)=>{let{debounceInterval:o,debounceOptions:c,manual:s}=t;const a=I(!1),d=I(),l=U(()=>c),r=U(()=>te(o)),p=I(e.context.runAsync);return s||(a.value=!0),G(f=>{_e(r.value)||(d.value=_t(n=>n(),r.value,l.value),e.context.runAsync=function(){for(var n=arguments.length,m=new Array(n),i=0;i<n;i++)m[i]=arguments[i];return new Promise((_,w)=>{a.value?(a.value=!1,p.value(...m).then(_).catch(w)):d.value(()=>{p.value(...m).then(_).catch(w)})})},f(()=>{var n;(n=d.value)===null||n===void 0||n.cancel(),e.context.runAsync=p.value}))}),{onCancel(){var f;(f=d.value)===null||f===void 0||f.cancel()}}}),ko=ae((e,t)=>{let{errorRetryCount:o=0,errorRetryInterval:c=0}=t;const s=I(),a=I(0),d=U(()=>te(o)),l=U(()=>te(c));let r=!1;const p=()=>{a.value=0},f=U(()=>{if(l.value)return l.value;const i=1e3,_=1,w=9,u=Math.floor(Math.random()*2**Math.min(a.value,w)+_);return i*u}),n=()=>{let i;const _=d.value===-1,w=a.value<d.value;return(_||w)&&(_||(a.value+=1),i=setTimeout(()=>{r=!0,e.context.refresh()},f.value)),()=>i&&clearTimeout(i)},m=()=>{s.value&&s.value()};return{onBefore(){r||p(),r=!1,m()},onSuccess(){p()},onError(){s.value=n()},onCancel(){p(),m()}}}),Co=ae((e,t)=>{let{ready:o=I(!0),manual:c,defaultParams:s=[]}=t;return de(o,a=>{!c&&a&&e.context.run(...s)},{flush:"sync"}),{onBefore(){if(!(je(o)?o():o.value))return e.loading.value=!1,{isBreak:!0}}}}),Vo=ae((e,t)=>{let{refreshDeps:o,refreshDepsAction:c,manual:s}=t;if(o===void 0||Ee(o)&&o.length===0)return{};const a=Ee(o)?o:[o];return de(a,()=>{c?c():!s&&e.context.refresh()}),{}}),Do=ae((e,t)=>{let{throttleInterval:o,throttleOptions:c}=t;const s=I(),a=U(()=>te(o)),d=U(()=>c),l=I(e.context.runAsync);return G(r=>{if(_e(o))return{};s.value=go(p=>p(),a.value,d.value),e.context.runAsync=function(){for(var p=arguments.length,f=new Array(p),n=0;n<p;n++)f[n]=arguments[n];return new Promise((m,i)=>{s.value(()=>{l.value(...f).then(m).catch(i)})})},r(()=>{var p;(p=s.value)===null||p===void 0||p.cancel(),e.context.runAsync=l.value})}),{onCancel(){var r;(r=s.value)===null||r===void 0||r.cancel()}}});const To=(e,t)=>o=>{Object.keys(o).forEach(c=>{e[c].value=o[c]}),t.forEach(c=>c(e))},xo=(e,t)=>()=>{let o=t;for(let c=e.length;c-- >0;)o=e[c](o);return o()},Lo=(e,t,o)=>{var c,s;const{initialData:a,onSuccess:d,onError:l,onBefore:r,onAfter:p}=t,f=I((c=o==null?void 0:o.loading)!==null&&c!==void 0?c:!1),n=ge((s=o==null?void 0:o.data)!==null&&s!==void 0?s:a),m=ge(o==null?void 0:o.error),i=I(o==null?void 0:o.params),_=I([]),w=ge("pending"),u={},y=To({status:w,loading:f,data:n,error:m,params:i},[]),v=function(V){for(var O=arguments.length,F=new Array(O>1?O-1:0),N=1;N<O;N++)F[N-1]=arguments[N];if(V==="onQuery"){const R=_.value.map(S=>S.onQuery).filter(Boolean);return{servicePromise:xo(R,F[0])()}}else{const R=_.value.map(S=>{var C;return(C=S[V])===null||C===void 0?void 0:C.call(S,...F)});return Object.assign({},...R)}},h=I(0);return u.runAsync=async function(){for(var V=arguments.length,O=new Array(V),F=0;F<V;F++)O[F]=arguments[F];y({loading:!0,params:O,status:"pending"}),h.value+=1;const N=h.value,{isBreak:R,breakResult:S=Se()}=v("onBefore",O);if(R)return y({status:"settled"}),S;r==null||r(O);try{const C=()=>new Promise(K=>K(e(...i.value)));let{servicePromise:x}=v("onQuery",C);x||(x=C());const L=await x;return N!==h.value?Se():(y({data:L,loading:!1,error:void 0,status:"settled"}),v("onSuccess",L,O),d==null||d(L,O),N===h.value&&v("onAfter",O,L,void 0),p==null||p(O),L)}catch(C){if(N!==h.value)return Se();throw y({loading:!1,error:C,status:"settled"}),v("onError",C,O),l==null||l(C,O),N===h.value&&v("onAfter",O,void 0,C),p==null||p(O),C}},u.run=function(){u.runAsync(...arguments).catch(V=>{l||console.error(V)})},u.cancel=()=>{h.value+=1,y({loading:!1}),v("onCancel")},u.refresh=()=>{u.run(...i.value||[])},u.refreshAsync=()=>u.runAsync(...i.value||[]),u.mutate=V=>{const O=je(V)?V(n.value):V,F=bo(O);y({data:F}),v("onMutate",F)},{status:w,loading:f,data:n,error:m,params:i,plugins:_,context:u}};function No(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const c=Me(fo,{}),s={...vo(),...c,...t},{manual:a=!1,defaultParams:d=[]}=s,l=Lo(e,s);if(l.plugins.value=o.map(r=>r(l,s)),!a){const r=l.params.value||d;l.context.run(...r)}return De(()=>{l.context.cancel()}),{loading:l.loading,data:l.data,error:l.error,params:l.params,cancel:l.context.cancel,refresh:l.context.refresh,refreshAsync:l.context.refreshAsync,mutate:l.context.mutate,run:l.context.run,runAsync:l.context.runAsync}}const ke=new Map,Io=(e,t)=>{ke.set(e,t),t.then(o=>(ke.delete(e),o)).catch(()=>{ke.delete(e)})},Oo=e=>ke.get(e),ue=new Map,$o=(e,t)=>{ue.has(e)&&ue.get(e).forEach(o=>o(t))},So=(e,t)=>(ue.has(e)?ue.get(e).push(t):ue.set(e,[t]),()=>{const o=ue.get(e).indexOf(t);ue.get(e).splice(o,1)});var Ro=ae((e,t)=>{let{cacheKey:o,cacheTime:c=6e5,staleTime:s=0,getCache:a,setCache:d}=t;if(!o)return{};const l=je(o)?o:()=>o,r=I(()=>{});let p;const f=y=>a?a(y):yo(y),n=(y,v,h)=>{d?d(y,h):wo(y,v,h),$o(y,h.data)},m=y=>s===-1||y+s>new Date().getTime(),i=(y,v)=>Object.prototype.hasOwnProperty.call(y,v),_=y=>{const v=l(y);return So(v,h=>{e.data.value=h})},w=l(),u=f(w);return u&&i(u,"data")&&(e.data.value=u.data,e.params.value=u.params),w&&(r.value=_()),De(()=>{r.value()}),{onBefore(y){const v=l(y),h=f(v);if(!h||!i(h,"data"))return{};if(m(h.time))return e.data.value=h.data,e.loading.value=!1,{isBreak:!0,breakResult:h.data};e.data.value=h.data},onQuery(y){const v=e.params.value,h=l(v);let V=Oo(h);return V&&V!==p?()=>V:(V=y(),p=V,Io(h,V),()=>V)},onSuccess(y,v){const h=l(v);h&&(r.value(),n(h,c,{data:y,params:v,time:new Date().getTime()}),r.value=_(v))},onMutate(y){const v=l(e.params.value);v&&(r.value(),n(v,c,{data:y,params:e.params.value,time:new Date().getTime()}),r.value=_(e.params.value))}}});function Fo(e){let t,o;class c extends Promise{constructor(a){super(a),this.cancel=()=>{o(),clearTimeout(t)}}}return new c(s=>{o=s,t=setTimeout(o,e)})}function Re(){return new Date().getTime()}var Po=ae((e,t)=>{let{loadingDelay:o=0,loadingKeep:c=0}=t;const s=I(()=>{}),a=U(()=>te(o)),d=U(()=>te(c));let l=0,r={};const p=()=>{let f;return a.value&&(f=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},a.value)),()=>f&&clearTimeout(f)};return{onBefore(){e.loading.value=!a.value,s.value(),s.value=p(),l=Re()},onQuery(f){if(!d.value)return()=>f();r=Fo(d.value+a.value);const n=async()=>{try{const i=await f();return Re()-l<=a.value&&r.cancel(),Promise.resolve(i)}catch(i){return Re()-l<=a.value&&r.cancel(),Promise.reject(i)}},m=Promise.allSettled([n(),r]).then(i=>{const _=i[0];return _.status==="fulfilled"?_.value:Promise.reject(_.reason)});return()=>m},onCancel(){s.value()},onAfter(){s.value()}}}),Fe;const bt=new Set,yt=new Set,wt=new Set,Ce=(e,t)=>{let o;switch(e){case"FOCUS_LISTENER":o=bt;break;case"RECONNECT_LISTENER":o=wt;break;case"VISIBLE_LISTENER":o=yt;break}if(!o.has(t))return o.add(t),()=>{o.delete(t)}},Pe=e=>{e.forEach(t=>{t()})};!He&&(Fe=window)!==null&&Fe!==void 0&&Fe.addEventListener&&(window.addEventListener("visibilitychange",()=>{vt()&&Pe(yt)},!1),window.addEventListener("focus",()=>Pe(bt),!1),window.addEventListener("online",()=>Pe(wt),!1));var Uo=ae((e,t)=>{let{pollingInterval:o,pollingWhenHidden:c=!1,pollingWhenOffline:s=!1,errorRetryCount:a=0}=t;const d=I(),l=I(!1),r=U(()=>te(o)),p=U(()=>te(a)),f=[],n=w=>{w&&f.push(w)},m=()=>(c||vt())&&(s||_o()),i=w=>{if(e.error.value&&p.value!==0)return;let u;if(!_e(r.value)&&r.value>=0)if(m())u=setTimeout(w,r.value);else{l.value=!0;return}return()=>u&&clearTimeout(u)},_=()=>{l.value&&m()&&(e.context.refresh(),l.value=!1)};return de(r,()=>{d.value&&(d.value(),d.value=i(()=>e.context.refresh()))}),c||n(Ce("VISIBLE_LISTENER",_)),s||n(Ce("RECONNECT_LISTENER",_)),De(()=>{f.forEach(w=>w())}),{onBefore(){var w;(w=d.value)===null||w===void 0||w.call(d)},onCancel(){var w;(w=d.value)===null||w===void 0||w.call(d)},onAfter(){d.value=i(()=>e.context.refresh())}}});const Eo=(e,t)=>{let o=!1;return function(){o||(o=!0,e(...arguments),setTimeout(()=>{o=!1},t))}};var Ao=ae((e,t)=>{let{refreshOnWindowFocus:o=!1,refocusTimespan:c=5e3}=t;const s=U(()=>te(o)),a=U(()=>te(c)),d=[],l=p=>{p&&d.push(p)},r=()=>{d.forEach(p=>p())};return G(()=>{if(r(),s.value){const p=Eo(e.context.refresh,a.value);l(Ce("VISIBLE_LISTENER",p)),l(Ce("FOCUS_LISTENER",p))}}),De(()=>{r()}),{}});function ie(e,t){return No(e,t,[Po,ko,ho,Uo,Do,Ao,Vo,Co,Ro])}var gt=(e=>(e[e.å·²åŠ=1]="å·²åŠ",e[e.å¾…åŠ=2]="å¾…åŠ",e[e.å¤±è´¥=3]="å¤±è´¥",e[e.æ’¤é”€=4]="æ’¤é”€",e[e.ç»ˆæ­¢=5]="ç»ˆæ­¢",e))(gt||{});function Le(){const{request:e}=z(),t={publishList:"/sapier-flow/flow-run/queryPublishFlowList",taskList:"/sapier-flow/flow-run/userTaskList",detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",reject:"/sapier-flow/flow-run/rollbackTask",green:"/sapier-flow/flow-run/greenTask",circulate:"/sapier-flow/flow-circulate/commitTask"};return{url:t,getPublishList:()=>e.get(t.publishList),getTaskList:u=>e.get(t.taskList,{params:u}),getFlowDetail:u=>e.get(t.detail,{params:u}),getApprovalNode:u=>e.post(t.approvalNode,u),startTask:u=>e.post(t.start,u),commitTask:u=>e.post(t.commit,u),saveDraft:u=>e.post(t.draft,u),revokeTask:u=>e.post(t.revoke,u),terminateTask:u=>e.post(t.terminate,u),withdrawTask:u=>e.post(t.withdraw,u),transferTask:u=>e.post(t.transfer,u),rejectTask:u=>e.post(t.reject,u),greenChannel:u=>e.post(t.green,u),circulateTask:u=>e.post(t.circulate,u)}}function Ko(e){const{commitTask:t,revokeTask:o,saveDraft:c,startTask:s,terminateTask:a,transferTask:d,withdrawTask:l,rejectTask:r,greenChannel:p,circulateTask:f}=Le(),n=U(()=>{const{flowDetail:i,formVariables:_,approvalFormData:w,debug:u,fileIds:y}=e,{flowDeployId:v}=i.value.process??{},{taskId:h,flowInstanceId:V}=i.value.task??{};return{flowDeployId:v,taskId:h,flowInstanceId:V,variables:_.value,debug:u.value,fileIds:y.value,...w.value}}),m=()=>n.value.taskId&&n.value.flowInstanceId;return{flow_draft(){if(m())return c(n.value)},flow_pass(){return m()?t(n.value):s(n.value)},flow_revoke(){if(m())return o(n.value)},flow_withdraw(){if(m())return l(n.value)},flow_terminate(){if(m())return a(n.value)},flow_transfer(){if(m())return d(n.value)},flow_reject(){if(m())return r(n.value)},flow_green(){if(m())return p(n.value)},flow_circulate(){if(m()){const{approvalFormData:i,circulateId:_}=e;return f({id:_==null?void 0:_.value,comment:i==null?void 0:i.value.comment})}}}}function Mo(e){const t=I({});return G(async()=>{var c;const{formProperty:o}=((c=k(e))==null?void 0:c.properties)||{};o!=null&&o.length&&(await ve(),Object.keys(t.value).forEach(s=>{var l,r,p,f;const a=((l=t.value[s])==null?void 0:l.label)||"",d=o==null?void 0:o.find(n=>n.prop===s);if(t.value[s].display=d==null?void 0:d.display,t.value[s].disabled=d==null?void 0:d.disabled,t.value[s].detail=d==null?void 0:d.detail,t.value[s].readonly=d==null?void 0:d.readonly,t.value[s].rules=t.value[s].rules??[],d!=null&&d.required&&((r=t.value[s].rules)!=null&&r.some(n=>n.required)))return null;d!=null&&d.required?(p=t.value[s].rules)==null||p.push({required:!0,message:`${a}ä¸ºå¿…å¡«é¡¹`}):t.value[s].rules=(f=t.value[s].rules)==null?void 0:f.filter(n=>!n.required)}))}),t}function Bo(){return{modelValue:{type:Object,default:()=>({})},title:{type:String},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"formTab"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean},circulateId:{type:String}}}function jo(){return{complete:e=>e}}const ht=Symbol("flowFormState");function Ho(e,t){const o=pe(e,void 0,{passive:!0,deep:!0}),{flowDetail:c,modelValue:s,formLoading:a}=o,{getFlowDetail:d}=Le(),{tabs:l}=z(),r=U(()=>(l==null?void 0:l.filter(i=>{var w,u,y;const _=(y=(u=(w=c.value)==null?void 0:w.properties)==null?void 0:u.formProperty)==null?void 0:y.find(v=>v.prop===i.prop);return(_==null?void 0:_.display)!==!1}))??[]);G(()=>{const{flowKey:i,taskId:_,instanceId:w}=e;!i&&!_&&!w||(a.value=!0,d({flowKey:i,taskId:_,flowInstanceId:w}).then(u=>{c.value=u.data,s.value=u.data.formData||{}}).finally(()=>{a.value=!1}))});const p=I(!1),f=U(()=>Object.entries(s.value||{}).filter(([i])=>!i.startsWith("$")).map(([i,_])=>({key:i,value:_}))),n=I(),m={...o,formData:s,formVariables:f,approvalVisible:p,tabList:r,fileIds:n,emit:t};return Bt(ht,m),m}function ce(){return Me(ht)}const zo=A({__name:"button-list",emits:["click"],setup(e,{emit:t}){const{flowDetail:o,circulateId:c}=ce(),{data:s}=Qe().useList(),{userInfo:a}=z();function d(r,p){return r.map(f=>{const n=p.find(i=>i.buttonKey===f.buttonKey);return{...f,...ro(n,["display","approval"])}})}const l=U(()=>{var v,h,V,O,F,N;if(c!=null&&c.value){const R=(v=s.value)==null?void 0:v.find(S=>S.buttonKey==="flow_circulate");return R?[R]:[]}const r=typeof a=="function"?a():a,{assignee:p,status:f}=((h=o.value)==null?void 0:h.task)||{},{createUser:n,flowInstanceId:m,status:i}=((V=o.value)==null?void 0:V.flowInstance)||{},_={true:!0,false:!1,startUser:n==(r==null?void 0:r.userId),assignee:p==(r==null?void 0:r.userId),todo:f==2,done:f==1,notstarted:!m,started:!!m,finished:i===1,unfinished:i===2},w=((O=s.value)==null?void 0:O.filter(R=>R.buttonKey!=="flow_circulate"))??[],{button:u}=((F=o.value)==null?void 0:F.properties)||{};return((N=d(w,u??[]))==null?void 0:N.filter(R=>{var S,C;return(C=(S=R.display)==null?void 0:S.split(","))==null?void 0:C.every(x=>_[x])}))??[]});return(r,p)=>{const f=D("el-button");return T(!0),E(W,null,J(l.value,n=>(T(),$(f,{key:n.buttonKey,type:n.buttonType,onClick:m=>t("click",n)},{default:b(()=>[g(k(se),{icon:n.icon},null,8,["icon"]),P(" "+j(n.name),1)]),_:2},1032,["type","onClick"]))),128)}}});function ze(e){return new Promise((t,o)=>{k(e).validate((s,a,d)=>{s?(a(),t(d)):o(d)})})}const Wo=A({__name:"common-comments",props:{modelValue:{}},setup(e){const t=e,{modelValue:o}=pe(t),{batchUpdate:c,create:s,remove:a,useList:d}=dl(),l=I(!1),{activeBtn:r}=ce(),p=U(()=>{var h;return(h=r.value)==null?void 0:h.buttonKey}),{data:f,refresh:n}=d(p),m=U(()=>{var V,O,F;const h=o.value;if(h&&!((V=f.value)!=null&&V.some(N=>N.content===h))){const N=(((F=(O=f.value)==null?void 0:O[0])==null?void 0:F.sort)||1)-1;return[{content:h,sort:N},...f.value||[]]}return f.value});async function i(h){var V;await s({...h,type:(V=r.value)==null?void 0:V.buttonKey}),Z.success("æ·»åŠ æˆåŠŸ"),n()}async function _(h){await a(h.id),Z.success("åˆ é™¤æˆåŠŸ"),n()}async function w(h,V){let O=V.parent.data;O=O.map((F,N)=>({id:F.id,sort:N+1})),await c(O),Z.success("ä¿®æ”¹æ’åºæˆåŠŸ"),n(),l.value=!1}function u(){l.value=!0}const y=I();async function v(h){var V;o.value=h.content??"",await ve(),(V=y.value)==null||V.blur()}return(h,V)=>{const O=D("el-input"),F=D("el-text"),N=D("el-col"),R=D("el-button"),S=D("el-row"),C=D("el-tree"),x=D("el-popover");return T(),$(x,{visible:l.value,placement:"bottom",title:"å¸¸ç”¨æ„è§",width:600},{reference:b(()=>[g(O,{ref_key:"inputRef",ref:y,modelValue:k(o),"onUpdate:modelValue":V[0]||(V[0]=L=>ee(o)?o.value=L:null),type:"textarea",placeholder:"è¯·è¾“å…¥æ„è§",rows:"5",onFocus:V[1]||(V[1]=L=>l.value=!0),onBlur:V[2]||(V[2]=L=>l.value=!1)},null,8,["modelValue"])]),default:b(()=>[g(C,{data:m.value,"node-key":"content",draggable:"","allow-drop":(L,K,H)=>H!=="inner",props:{label:"content"},onNodeClick:v,onNodeDrop:w,onNodeDragStart:u},{default:b(({data:L})=>[g(S,{style:{width:"600px"}},{default:b(()=>[g(N,{span:22},{default:b(()=>[g(F,{truncated:"",title:L.content},{default:b(()=>[P(j(L.content),1)]),_:2},1032,["title"])]),_:2},1024),g(N,{span:2},{default:b(()=>[L.id?(T(),$(R,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:tt(K=>_(L),["stop"])},null,8,["onClick"])):(T(),$(R,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:tt(K=>i(L),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),Yo=A({__name:"approval-tree",props:{modelValue:{},data:{},autoCheck:{type:Boolean}},setup(e){const t=e,{modelValue:o}=pe(t),c=I(),s={class(n){return`node-${n.type}`}},a=U(()=>pt(t.data??[],(n,m,i)=>{const _=ut();return n.taskNodeKey=(i==null?void 0:i.taskNodeKey)??n.taskNodeKey,n.incoming=(i==null?void 0:i.incoming)??n.incoming,n.multiple=(i==null?void 0:i.multiple)??n.multiple,{...n,id:_,label:n.title,disabled:n.type!=="user"}})),d={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"};xe(()=>[a.value,c.value],async()=>{if(!c.value||!a.value.length)return;if(t.autoCheck){const m=l(a.value);m&&f([m])}eo(a.value,m=>{var i;return!!((i=m.children)!=null&&i.length)}).map(async m=>{var _;await Pt(100);const i=(_=c.value)==null?void 0:_.getNode(m);i==null||i.expand()})},{immediate:!0,debounce:100});function l(n){var m;if(n.length===1)return(m=n[0].children)!=null&&m.length?l(n[0].children):n[0]}async function r(n,{checkedNodes:m}){var w;let i=m.filter(u=>u.type==="user");const _=i.some(u=>u.id===n.id);if(a.value.every(u=>!u.multiple)&&_)i=[n];else if(!n.multiple&&_){const v=((w=c.value)==null?void 0:w.getNode(n)).parent.data.children.filter(h=>h.id!==n.id);i=ft(i,v,"id")}f(i)}function p(n){const m=o.value.filter(i=>i.id!==n.id);f(m)}function f(n){var m;o.value=n,(m=c.value)==null||m.setCheckedNodes(n)}return(n,m)=>{const i=D("el-tag"),_=D("Icon"),w=D("el-tree");return T(),E(W,null,[(T(!0),E(W,null,J(k(o),u=>(T(),$(i,{key:u.id,type:"info",closable:"",onClose:y=>p(u)},{default:b(()=>[P(j(u.title),1)]),_:2},1032,["onClose"]))),128)),g(w,{ref_key:"treeRef",ref:c,class:"approval-tree",data:a.value,props:s,"node-key":"id","check-on-click-node":"","show-checkbox":"",onCheck:r},{default:b(({data:u})=>[Q("div",null,[g(_,{icon:d[u.type]||d.element,style:{display:"inline-block"}},null,8,["icon"]),Q("span",null,j(u.title),1)])]),_:1},8,["data"])],64)}}});const lt=Te(Yo,[["__scopeId","data-v-f1318efd"]]),at=A({__name:"assignee-setter",props:{modelValue:{},tableData:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,c=U({get(){return typeof o.modelValue=="string"?o.modelValue?o.modelValue.split(","):[]:o.modelValue},set(n){t("update:modelValue",n.join(","))}}),s=U({get(){return Array.isArray(o.modelValue)?o.modelValue.join(","):o.modelValue},set(n){t("update:modelValue",n)}}),a=I(!1),d=U(()=>{var n,m;return(m=(n=o.tableData)==null?void 0:n.row)==null?void 0:m.type}),l=I([]),r=I([]),{getUserTree:p}=vl(),{getParam:f}=me();return de(d,n=>{["dept","post","user"].includes(n)?(a.value=!0,p(n==="user"?"":n).then(m=>{l.value=pt(m.data,i=>({label:i.title,value:i.id}))}).finally(()=>a.value=!1)):d.value==="dynamic"&&(a.value=!0,f("flow.trends.user").then(m=>{r.value=m.data}).finally(()=>a.value=!1))},{immediate:!0}),(n,m)=>{const i=D("el-tree-select"),_=D("el-input");return["dept","post","user"].includes(d.value)?(T(),$(i,{key:0,modelValue:c.value,"onUpdate:modelValue":m[0]||(m[0]=w=>c.value=w),data:l.value,loading:a.value,"expand-on-click-node":!1,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"",clearable:""},null,8,["modelValue","data","loading"])):d.value==="dynamic"?(T(),$(i,{key:1,modelValue:s.value,"onUpdate:modelValue":m[1]||(m[1]=w=>s.value=w),data:r.value,loading:a.value,clearable:""},null,8,["modelValue","data","loading"])):d.value==="userTask"?(T(),$(k(Gt),{key:2,modelValue:s.value,"onUpdate:modelValue":m[2]||(m[2]=w=>s.value=w),"filter-type":"userTask"},null,8,["modelValue"])):(T(),$(_,{key:3,modelValue:s.value,"onUpdate:modelValue":m[3]||(m[3]=w=>s.value=w)},null,8,["modelValue"]))}}}),qo={key:0,class:"flow-viewer"},Qo={key:0,class:"flow-status-legend"},Go=A({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{},showLegend:{type:Boolean}},emits:["update:modelValue","nodeClick"],setup(e,{emit:t}){const o=e,{FlowDesign:c,tabs:s}=z(),a=ge();no(a,()=>{var u;(u=a.value)==null||u.on("node:click",y=>t("nodeClick",y))});const d=U({get(){let u=Jt();return typeof o.modelValue=="string"&&o.modelValue?u=JSON.parse(o.modelValue):typeof o.modelValue=="object"&&Object.keys(o.modelValue)&&(u=o.modelValue),u},set(u){t("update:modelValue",JSON.stringify(u))}}),l=U(()=>{const{column:u=[],group:y=[]}=JSON.parse(o.flowFormOption||"{}");return[...u,...y.map(h=>h.column??[]).flat()]}),{data:r}=Qe().useList(),p=U(()=>(s==null?void 0:s.map(u=>({...u,display:!0})))??[]),f=U(()=>{var u;return{formPropertyList:[...l.value,...p.value],buttonList:(u=r.value)==null?void 0:u.filter(y=>y.status===1),fieldsDic:l.value.map(y=>({label:y.label,value:`\${${y.prop}}`,desc:`\${${y.prop}}`})),flowButtonDisplayDic:ne(Ye),flowButtonApprovalDic:ne(qe)}}),n=I({}),m=I({});xe(m,u=>{var y,v,h,V,O,F,N,R,S;u&&((h=(v=(y=u.assignee)==null?void 0:y.children)==null?void 0:v.column)!=null&&h[1]&&(u.assignee.children.column[1].component=at),(S=(R=(N=(F=(O=(V=u.circulate)==null?void 0:V.children)==null?void 0:O.column)==null?void 0:F[1])==null?void 0:N.children)==null?void 0:R.column)!=null&&S[1]&&(u.circulate.children.column[1].children.column[1].component=at))},{debounce:1});const{data:i}=me().useParam("flow.task.status"),_=U(()=>{var u;return(u=o.flowHistory)==null?void 0:u.map(y=>{var h,V;const v=(V=(h=i.value)==null?void 0:h.find(O=>O.value===y.status))==null?void 0:V.style;return{id:y.taskNodeKey,style:v}})}),w=U(()=>{var u,y;return(y=(u=o.flowHistory)==null?void 0:u.filter(v=>v.taskNodeType==="userTask"))==null?void 0:y.map(v=>{var h;return{id:v.taskNodeKey,content:`<div>${v.assigneeName}</div>
        <div>${v.endTime??""}</div>
        <div>${((h=v.comment)==null?void 0:h.comment)??""}</div>`}})});return(u,y)=>u.view?(T(),E("div",qo,[u.showLegend!==!1?(T(),E("div",Qo,[(T(!0),E(W,null,J(k(i),v=>{var h;return T(),E("div",{key:v.label,class:"legend-item"},[Q("div",{class:"legend-color",style:jt({backgroundColor:(h=v.style)==null?void 0:h.fill})},null,4),Q("span",null,j(v.label),1)])}),128))])):B("",!0),g(k(c),{lf:a.value,"onUpdate:lf":y[0]||(y[0]=v=>a.value=v),"model-value":d.value,styles:_.value,tooltips:w.value,type:"viewer"},null,8,["lf","model-value","styles","tooltips"])])):(T(),$(k(c),{key:1,modelValue:d.value,"onUpdate:modelValue":y[1]||(y[1]=v=>d.value=v),formData:n.value,"onUpdate:formData":y[2]||(y[2]=v=>n.value=v),formDefaults:m.value,"onUpdate:formDefaults":y[3]||(y[3]=v=>m.value=v),"form-options":k(Xt),"data-options":f.value,"form-width":"30%"},null,8,["modelValue","formData","formDefaults","form-options","data-options"]))}});const be=Te(Go,[["__scopeId","data-v-9aa4931a"]]),Jo=A({__name:"node-select",props:{modelValue:{}},setup(e){const t=e,{modelValue:o}=pe(t),{flowDetail:c}=ce(),s=I(!1);function a({data:d}){d.type==="userTask"&&(s.value=!1,o.value=d.id)}return(d,l)=>{const r=D("el-button"),p=D("el-popover");return T(),$(p,{visible:s.value,"onUpdate:visible":l[0]||(l[0]=f=>s.value=f),placement:"bottom-start",width:"800px",trigger:"click"},{reference:b(()=>[g(r,null,{default:b(()=>[P(" ç‚¹å‡»é€‰æ‹©èŠ‚ç‚¹ ")]),_:1})]),default:b(()=>{var f,n;return[g(be,{"model-value":(n=(f=k(c))==null?void 0:f.process)==null?void 0:n.flowData,view:"",style:{height:"600px"},onNodeClick:a},null,8,["model-value"])]}),_:1},8,["visible"])}}}),Xo=A({__name:"approval-form",emits:["confirm"],setup(e,{emit:t}){const{getApprovalNode:o}=Le(),{useParam:c}=me(),{formData:s,approvalFormData:a,activeBtn:d,approvalVisible:l,formVariables:r,flowDetail:p}=ce(),f=I([]),n=I([]),m=I([]),i=I([]),_=I(!1),w=I(!1),u=I(),y=I(),v={menuBtn:!1,labelWidth:100,column:[{label:"æŒ‡å®šèŠ‚ç‚¹",prop:"jumpTaskNodeKey",span:24,rules:[{required:!0,message:"è¯·é€‰æ‹©æŒ‡å®šèŠ‚ç‚¹"}]},{label:"å®¡æ‰¹äºº",prop:"assignee",span:24,rules:[{required:!0,validator:h}]},{label:"ä¼ é˜…äºº",prop:"circulate",span:24},{label:"æ„è§",prop:"comment",span:24,rules:[{required:!0,message:"è¯·å¡«å†™æ„è§"}]}]};function h(C,x,L){var Y,M,ye;const K=((Y=f.value[0])==null?void 0:Y.type)==="parallelGateway",H=(ye=(M=f.value[0])==null?void 0:M.children)==null?void 0:ye.every(re=>to([re],Ne=>n.value.some(Ie=>Ie.id===Ne.id)));if(n.value.length){if(K&&!H)return L("è¯·åœ¨æ¯ä¸ªèŠ‚ç‚¹é€‰æ‹©å®¡æ‰¹äºº")}else return L("è¯·é€‰æ‹©å®¡æ‰¹äºº");return!0}const{data:V}=c("flow.default.comment"),{data:O}=c("flow.approval.autocheck");G(async()=>{var x;if(!l.value||!u.value||!y.value)return;F();const{taskId:C}=((x=p.value)==null?void 0:x.task)||{};ve(()=>{u.value.resetFields(),a.value.comment=s.value.comment||(C?"":V.value),y.value.jumpTaskNodeKey.display=N("specifyNode"),y.value.assignee.display=N("assignee"),y.value.circulate.display=N("circulate"),y.value.comment.display=N("comment")})}),G(async()=>{var L,K;if(!l.value||!N("assignee")||N("specifyNode")&&!a.value.jumpTaskNodeKey)return;F();const{flowKey:C}=((L=p.value)==null?void 0:L.process)||{},{taskId:x}=((K=p.value)==null?void 0:K.task)||{};try{w.value=!0;const H=await o({flowKey:C,taskId:x,variables:r.value,buttonType:d.value.buttonKey,jumpTaskNodeKey:a.value.jumpTaskNodeKey});f.value=H.data.approvalNodeList,m.value=H.data.circulateNodeList}finally{w.value=!1}});function F(){f.value=[],n.value=[],m.value=[],i.value=[]}function N(C){var x,L;return(L=(x=d.value)==null?void 0:x.approval)==null?void 0:L.includes(C)}async function R(){await ze(u),_.value=!0;const{data:C,outgoing:x}=S(n.value),{data:L}=S(i.value);a.value.assignee=C,a.value.outgoing=[...x],a.value.circulate=L,console.log("ğŸš€ ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",s),t("confirm")}function S(C){const x={},L={},K=new Set;return C.forEach(H=>{const{taskNodeKey:Y,incoming:M}=H;x[Y]||(x[Y]=new Set),H.userId&&x[Y].add(H.userId),L[Y]=[...x[Y]].join(","),M&&K.add(M)}),{set:x,data:L,outgoing:K}}return(C,x)=>{const L=D("el-skeleton"),K=D("avue-form"),H=D("el-button"),Y=D("el-dialog");return T(),$(Y,{modelValue:k(l),"onUpdate:modelValue":x[7]||(x[7]=M=>ee(l)?l.value=M:null),class:"approlval-form",title:k(d).name,width:"900px","append-to-body":""},{footer:b(()=>[g(H,{onClick:x[6]||(x[6]=M=>l.value=!1)},{default:b(()=>[P(" å– æ¶ˆ ")]),_:1}),g(H,{type:"primary",onClick:R},{default:b(()=>[P(" ç¡® å®š ")]),_:1})]),default:b(()=>[g(K,{ref_key:"formRef",ref:u,modelValue:k(a),"onUpdate:modelValue":x[4]||(x[4]=M=>ee(a)?a.value=M:null),defaults:y.value,"onUpdate:defaults":x[5]||(x[5]=M=>y.value=M),option:v},{jumpTaskNodeKey:b(()=>[g(Jo,{modelValue:k(a).jumpTaskNodeKey,"onUpdate:modelValue":x[0]||(x[0]=M=>k(a).jumpTaskNodeKey=M)},null,8,["modelValue"])]),assignee:b(()=>[w.value?(T(),$(L,{key:0})):(T(),$(lt,{key:"AssigneeTree",modelValue:n.value,"onUpdate:modelValue":x[1]||(x[1]=M=>n.value=M),data:f.value,"auto-check":k(O)==="true"},null,8,["modelValue","data","auto-check"]))]),circulate:b(()=>[w.value?(T(),$(L,{key:0})):(T(),$(lt,{key:"CirculateTree",modelValue:i.value,"onUpdate:modelValue":x[2]||(x[2]=M=>i.value=M),data:m.value},null,8,["modelValue","data"]))]),comment:b(()=>[g(Wo,{modelValue:k(a).comment,"onUpdate:modelValue":x[3]||(x[3]=M=>k(a).comment=M)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["modelValue","title"])}}}),Zo={class:"flow-form__title"},We=A({__name:"index",props:Bo(),emits:jo(),setup(e,{emit:t}){const o=e,c=Ho(o,t),{flowDetail:s,tabList:a,activeTab:d,activeBtn:l,formLoading:r,approvalVisible:p,submitLoading:f}=c,n=I();async function m(w){var u,y;l.value=w,await((u=n.value)==null?void 0:u.validate()),await((y=o.beforeClick)==null?void 0:y.call(o,w)),(w==null?void 0:w.approval)!=="false"?p.value=!0:_()}const i=Ko(c);async function _(){var w,u;try{const{buttonKey:y}=l.value;f.value=!0,await((w=o.beforeSubmit)==null?void 0:w.call(o,l.value));const v=(u=i[y])==null?void 0:u.call(i);v instanceof Promise?(await v,Z.success("æ“ä½œæˆåŠŸ"),p.value=!1,t("complete",l.value)):Z.error("æ“ä½œå¤±è´¥")}finally{f.value=!1}}return(w,u)=>{const y=D("el-skeleton"),v=D("el-main"),h=D("el-header"),V=D("el-tab-pane"),O=D("el-tabs"),F=D("el-container");return k(r)?(T(),$(v,{key:0},{default:b(()=>[g(y)]),_:1})):(T(),$(F,{key:1,class:"flow-form"},{default:b(()=>[g(h,{class:"flow-form__header",height:"auto"},{default:b(()=>{var N;return[Q("div",Zo,j(o.title??((N=k(s).flowInstance)==null?void 0:N.title)),1),w.detail?B("",!0):(T(),$(zo,{key:0,onClick:m})),Ht(w.$slots,"button")]}),_:3}),g(v,{class:"flow-form__main"},{default:b(()=>[g(O,{modelValue:k(d),"onUpdate:modelValue":u[0]||(u[0]=N=>ee(d)?d.value=N:null)},{default:b(()=>[(T(!0),E(W,null,J(k(a),N=>(T(),$(V,{key:N.prop,label:N.label,name:N.prop,lazy:""},{default:b(()=>[N.prop==="formTab"?(T(),$(ot(w.$slots.default??N.component),{key:0,ref_for:!0,ref:R=>n.value=R},null,512)):(T(),$(ot(N.component),{key:1}))]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1}),g(Xo,{onConfirm:_})]),_:3}))}}});function kt(e,t){switch(t.type){case"window":return el(e,t);case"dialog":case"drawer":return tl(e,t);default:return{open:o=>{},close:()=>{}}}}function el(e,t){const{window:[o="",c="flow-form",s="left=0,top=0,width=1600,height=900"]=[]}=t,a=I(null),d=U(()=>`${o}?${Ut(Et(e,At(uo,io)))}`);return{open:p=>{var f;a.value=window.open(d.value,c,s),(f=a.value)==null||f.addEventListener("message",n=>{const{event:m}=n.data,i={...k(e),...k(p)}[m];typeof i=="function"&&i(n.data)})},close:()=>{var p;return(p=a.value)==null?void 0:p.close()},openedWindow:a}}function tl(e,t){const{appContext:o}=it();let c;const s=d=>{c=document.createElement("div"),c.className="flow-form-wrapper";const l=ol(t.formPath),r=Ue(l,{...k(e),...k(d)}),p=Ue(t.type==="dialog"?co:po,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:a,...t.overlay},r);p.appContext=o,Wt(p,c),document.body.appendChild(c)},a=()=>{c&&document.body.removeChild(c)};return{open:s,close:a}}function ol(e){return e?zt(()=>Yt(()=>import(e),[])):We}const ll=A({setup(){const{flowDetail:e,formData:t,detail:o}=ce(),c=Mo(e.value),{proxy:s}=it(),a=I({});G(()=>{const{formOption:r}=e.value.process??{};a.value=mt.bind(s)(r||'{"menuBtn":false}'),a.value.detail=!!o.value});const d=I();function l(){return ze(d)}return{form:t,option:a,defaults:c,formRef:d,validate:l}},render(){return Ue(D("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),al=A({__name:"upload-table",setup(e){const{flowDetail:t,fileIds:o}=ce(),{upload:{action:c,headers:s,preview:a,download:d,props:l}={}}=z(),r=typeof s=="function"?s():s,p=U(()=>{var v,h;return((h=(v=t.value)==null?void 0:v.task)==null?void 0:h.flowInstanceId)??ut()}),f={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"æ–‡ä»¶å",prop:"fileName"},{label:"æ–‡ä»¶ç±»å‹",prop:"fileType"},{label:"æ–‡ä»¶å¤§å°",prop:"fileSize"},{label:"ç‰ˆæœ¬",prop:"version"},{label:"ä¸Šä¼ æ—¶é—´",prop:"createTime"}]},{bindVal:n,getDataList:m,handleDel:i,handleSave:_,afterGetList:w,crudStateRefs:{tableData:u}}=X({crudOption:{...ml(),saveSuccessMsg:"ä¸Šä¼ æˆåŠŸ"},tableOption:f,queryForm:{isLatest:1,flowInstanceId:p.value}});w(()=>{o.value=u.value.map(v=>v.id).join(",")}),m();async function y(v,h){var C,x;const{fileName:V,fileType:O,fileSize:F,fileUrl:N,res:R}=l,S={fileName:we({res:v},`${R}.${V}`),fileType:we({res:v},`${R}.${O}`),fileSize:we({res:v},`${R}.${F}`),fileUrl:we({res:v},`${R}.${N}`),taskId:(x=(C=t.value)==null?void 0:C.task)==null?void 0:x.taskId,flowInstanceId:p.value,rootMark:(h==null?void 0:h.rootMark)||"",version:typeof(h==null?void 0:h.version)=="number"?h.version+1:1};await _(S,m,()=>{})}return(v,h)=>{const V=D("el-button"),O=D("el-upload"),F=D("avue-crud");return T(),$(F,oe(le(k(n))),{"menu-left":b(()=>[g(O,{action:k(c),headers:k(r),"show-file-list":!1,onSuccess:h[0]||(h[0]=N=>y(N))},{default:b(()=>[g(V,{type:"primary",icon:"el-icon-upload"},{default:b(()=>[P(" ç‚¹å‡»ä¸Šä¼  ")]),_:1})]),_:1},8,["action","headers"])]),menu:b(({row:N,index:R})=>[g(V,{type:"primary",text:"",icon:"el-icon-view",onClick:S=>{var C;return(C=k(a))==null?void 0:C(N,k(u))}},{default:b(()=>[P(" é¢„è§ˆ ")]),_:2},1032,["onClick"]),g(V,{type:"primary",text:"",icon:"el-icon-download",onClick:S=>{var C;return(C=k(d))==null?void 0:C(N,k(u))}},{default:b(()=>[P(" ä¸‹è½½ ")]),_:2},1032,["onClick"]),g(O,{action:k(c),headers:k(r),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:S=>y(S,N)},{default:b(()=>[g(V,{type:"primary",text:"",icon:"el-icon-upload"},{default:b(()=>[P(" æ›´æ–°ç‰ˆæœ¬ ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),g(V,{type:"primary",text:"",icon:"el-icon-delete",onClick:S=>k(i)(N,R)},{default:b(()=>[P(" åˆ é™¤ ")]),_:2},1032,["onClick"])]),_:1},16)}}}),nl={class:"flow-track"},sl={key:0},rl={key:1},ul=A({__name:"flow-track",setup(e){const{flowDetail:t}=ce(),o=I("table"),c=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],s=U(()=>{var r,p,f;return((f=(p=(r=t.value)==null?void 0:r.flowHistory)==null?void 0:p.filter(n=>n.taskNodeType==="userTask"))==null?void 0:f.map(n=>({...n,duration:Kt(n.duration)})))??[]}),a={addBtn:!1,menu:!1,border:!0,column:[{label:"èŠ‚ç‚¹åç§°",prop:"taskNodeName"},{label:"å¤„ç†äºº",prop:"assigneeName"},{label:"æ¥æ”¶æ—¶é—´",prop:"startTime"},{label:"å¤„ç†æ—¶é—´",prop:"endTime"},{label:"åŠç†æ—¶é•¿",prop:"duration"},{label:"æ“ä½œç±»å‹",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"åŠç†æ„è§",prop:"comment",bind:"comment.comment"}]},{data:d}=me().useParam("flow.handle.type");function l(r){var p;return(p=d.value)==null?void 0:p.find(f=>f.value===r)}return(r,p)=>{var y,v,h;const f=D("el-radio-button"),n=D("el-radio-group"),m=D("avue-crud"),i=D("el-card"),_=D("el-timeline-item"),w=D("el-timeline"),u=D("el-empty");return T(),E(W,null,[g(n,{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=V=>o.value=V)},{default:b(()=>[(T(),E(W,null,J(c,V=>g(f,{key:V.label,label:V.label},{default:b(()=>[g(k(se),{icon:V.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),Q("div",nl,[o.value==="table"?(T(),$(m,{key:0,data:s.value,option:a},null,8,["data"])):B("",!0),o.value==="graph"?(T(),$(be,{key:1,"model-value":(v=(y=k(t))==null?void 0:y.process)==null?void 0:v.flowData,"flow-history":(h=k(t))==null?void 0:h.flowHistory,view:"","show-legend":""},null,8,["model-value","flow-history"])):B("",!0),o.value==="timeline"?(T(),E(W,{key:2},[s.value.length?(T(),$(w,{key:0},{default:b(()=>[(T(!0),E(W,null,J([...s.value].reverse(),V=>(T(),$(_,{key:V.id,timestamp:V.endTime,placement:"top"},{default:b(()=>[g(i,null,{default:b(()=>{var O,F,N;return[Q("div",null,j(V.assigneeName)+" å¼€å§‹å¤„ç† ["+j(V.taskNodeName)+"] ç¯èŠ‚ ",1),V.duration?(T(),E("div",sl," åŠç†æ—¶é•¿ï¼š"+j(V.duration),1)):B("",!0),V.type&&((O=V.comment)!=null&&O.comment)?(T(),E("div",rl,j((F=l(V.type))==null?void 0:F.label)+"æ„è§ï¼š"+j((N=V.comment)==null?void 0:N.comment),1)):B("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(T(),$(u,{key:1}))],64)):B("",!0)])],64)}}});const il=Te(ul,[["__scopeId","data-v-ee4b339a"]]),nt=Symbol("flowPagesConfig"),cl={FlowDesign:Zt,FormDesign:oo,FlowForm:We,tabs:[{label:"å®¡æ‰¹è¡¨å•",prop:"formTab",component:ll},{label:"é™„ä»¶èµ„æ–™",prop:"fileTab",component:al},{label:"æµç¨‹è·Ÿè¸ª",prop:"trackTab",component:il}],request:()=>{},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}};var Ct=(e=>(e[e.å¦=0]="å¦",e[e.æ˜¯=1]="æ˜¯",e))(Ct||{});const Ae=ne(Ct);function z(e,t){return e&&t?(e.provide(nt,Mt(cl,t)),t):Me(nt)}function dl(){const{request:e}=z(),t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},o=r=>e.get(t.list,{params:{type:r,ascs:"sort"}});return{url:t,getList:o,useList:r=>ie(()=>o(r.value).then(p=>p.data.records),{refreshDeps:[r]}),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),batchUpdate:r=>e.post(t.batchUpdate,r)}}var Vt=(e=>(e.é»˜è®¤="default",e.ä¸»è¦="primary",e.æˆåŠŸ="success",e.è­¦å‘Š="warning",e.å±é™©="danger",e.ä¿¡æ¯="info",e.æ–‡å­—="text",e))(Vt||{}),Ye=(e=>(e.æ˜¾ç¤º="true",e.éšè—="false",e.å‘èµ·äºº="startUser",e.å¤„ç†äºº="assignee",e.å·²åŠ="done",e.å¾…åŠ="todo",e.æœªå‘èµ·="notstarted",e.å·²å‘èµ·="started",e.æœªåŠç»“="unfinished",e.å·²åŠç»“="finished",e))(Ye||{}),qe=(e=>(e.ä¸æ˜¾ç¤º="false",e.æŒ‡å®šèŠ‚ç‚¹="specifyNode",e.å®¡æ‰¹äºº="assignee",e.ä¼ é˜…äºº="circulate",e.æ„è§="comment",e))(qe||{}),Dt=(e=>(e[e.ç¦ç”¨=0]="ç¦ç”¨",e[e.æ­£å¸¸=1]="æ­£å¸¸",e))(Dt||{});function Qe(){const{request:e}=z(),t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1,ascs:"sort"}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function pl(){const{request:e}=z(),t={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"};return{getList:l=>e.get(t.list,{params:l}),getTree:l=>e.get(t.tree,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function Tt(){const{request:e}=z(),t={list:"/sapier-flow/flow-circulate/userTaskList",opslist:"/sapier-flow/flow-circulate-ops/list",update:"/sapier-flow/flow-circulate-ops/update",remove:"/sapier-flow/flow-circulate-ops/remove"};return{url:t,getCirculateList:d=>e.get(t.list,{params:d}),getCirculateOpsList:d=>e.get(t.list,{params:d}),updateCirculate:d=>e.post(t.update,d),removeCirculate:d=>e.post(t.remove,{},{params:{ids:d}})}}function Ge(){const{request:e}=z(),t={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"};return{url:t,getList:l=>e.get(t.list,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),deploy:l=>e.post(t.deploy,l),getDetail:l=>e.get(t.detail,{params:l})}}var xt=(e=>(e[e.å¦=0]="å¦",e[e.æ˜¯=1]="æ˜¯",e))(xt||{});function Je(){const{request:e}=z(),t={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",detail:"/sapier-flow/flow-deploy/detail"};return{url:t,getList:a=>e.get(t.list,{params:a}),getDetail:a=>e.get(t.detail,{params:a}),update:a=>e.post(t.update,a)}}function ml(){const{request:e}=z(),t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:a=>e.get(t.list,{params:a}),create:a=>e.post(t.save,a),remove:a=>e.post(t.remove,{},{params:{ids:a}})}}function fl(){const{request:e}=z(),t={list:"/sapier-flow/flow-ops/list"};return{url:t,getTaskOpsList:c=>e.get(t.list,{params:c})}}function me(){const{request:e}=z(),t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},o=p=>e.get(t.list,{params:p}),c=()=>e.get(t.all),s=p=>e.get(t.key,{params:{paramKey:p}});return{url:t,getList:o,getAllParam:c,getParam:s,useParam:p=>ie(()=>s(p).then(f=>f.data)),create:p=>e.post(t.save,p),update:p=>e.post(t.update,p),remove:p=>e.post(t.remove,{},{params:{ids:p}})}}function Lt(){const{request:e}=z(),t={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function vl(){const{request:e}=z(),t={tree:"/sapier-flow/flow-user/tree"},o=s=>e.get(t.tree,{params:{filter:s}});return{url:t,getUserTree:o,useUserTree:()=>ie(()=>o().then(s=>s.data))}}function Nt(){const{request:e}=z(),t={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}var It=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(It||{});function Ke(){const{request:e}=z(),t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy"},o=r=>e.get(t.list,{params:r});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1}).then(r=>r.data.records)),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),deploy:r=>e.post(t.deploy,r)}}const _l={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"æŒ‰é’®åç§°",prop:"name",search:!0},{label:"æŒ‰é’®æ ‡è¯†",prop:"buttonKey",search:!0},{label:"æŒ‰é’®å›¾æ ‡",prop:"icon",component:"icon-select"},{label:"æŒ‰é’®ç±»å‹",prop:"buttonType",type:"select",dicData:ne(Vt)},{label:"é»˜è®¤æ˜¾ç¤ºæ¡ä»¶",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ne(Ye),tip:"é€‰æ‹©å¤šä¸ªæ—¶,æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³æ‰æ˜¾ç¤º",labelTip:`æ˜¾ç¤º: å§‹ç»ˆæ˜¾ç¤º;<br/>éšè—: å§‹ç»ˆéšè—;<br/>
      å‘èµ·äºº: ç”¨æˆ·ä¸ºå‘èµ·äººæ—¶æ˜¾ç¤º;<br/>å¤„ç†äºº: ç”¨æˆ·ä¸ºå¤„ç†äººæ—¶æ˜¾ç¤º;<br/>
      å·²åŠ: ä»»åŠ¡çŠ¶æ€ä¸ºå·²åŠæ—¶æ˜¾ç¤º;<br/>å¾…åŠ: ä»»åŠ¡çŠ¶æ€ä¸ºå¾…åŠæ—¶æ˜¾ç¤º;<br/>
      æœªå‘èµ·: æµç¨‹æœªå‘èµ·æ—¶æ˜¾ç¤º;<br/>å·²å‘èµ·: æµç¨‹å·²å‘èµ·æ—¶æ˜¾ç¤º;<br/>
      æœªåŠç»“: æµç¨‹æœªåŠç»“æ—¶æ˜¾ç¤º;<br/>å·²åŠç»“: æµç¨‹å·²åŠç»“æ—¶æ˜¾ç¤º;`},{label:"é»˜è®¤å®¡æ‰¹çª—å£æ˜¾ç¤º",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ne(qe),labelTip:`ä¸æ˜¾ç¤º: ä¸æ˜¾ç¤ºå®¡æ‰¹çª—å£;<br/>æŒ‡å®šèŠ‚ç‚¹: æ˜¾ç¤ºæŒ‡å®šèŠ‚ç‚¹é€‰æ‹©æ¡†(å¸¸ç”¨äºç»¿è‰²é€šé“ç­‰);<br/>
      å®¡æ‰¹äºº: æ˜¾ç¤ºå®¡æ‰¹äººé€‰æ‹©æ¡†;<br/>ä¼ é˜…äºº: æ˜¾ç¤ºä¼ é˜…äººé€‰æ‹©æ¡†;<br/>æ„è§: æ˜¾ç¤ºæ„è§è¾“å…¥æ¡†;`},{label:"æ’åº",prop:"sort",type:"number",value:0},{label:"çŠ¶æ€",prop:"status",type:"switch",value:1,dicData:ne(Dt)},{label:"æŒ‰é’®é¢„è§ˆ",prop:"buttonPreview",width:150}]},bl=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:c}=X({tableOption:_l,crudOption:Qe(),sortOption:{ascs:"sort"}});return c(),(s,a)=>{const d=D("el-button"),l=D("avue-crud");return T(),$(l,oe(le(k(t))),{icon:b(({row:r})=>[g(k(se),{icon:r.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:b(({row:r})=>[g(d,{type:r.buttonType},{default:b(()=>[g(k(se),{icon:r.icon},null,8,["icon"]),P(" "+j(r.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":b(()=>[g(d,{type:k(o).buttonType},{default:b(()=>[g(k(se),{icon:k(o).icon},null,8,["icon"]),P(" "+j(k(o).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Xe={menuBtn:!1,span:24,column:[{label:"æµç¨‹åç§°",prop:"flowName",rules:[{required:!0,message:"è¯·è¾“å…¥æµç¨‹åç§°"}]},{label:"æµç¨‹æ ‡è¯†",prop:"flowKey",rules:[{required:!0,message:"è¯·è¾“å…¥æµç¨‹æ ‡è¯†"}]},{label:"æµç¨‹åˆ†ç±»",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"æµç¨‹å›¾æ ‡",prop:"flowIcon",component:"icon-select"},{label:"æµç¨‹æè¿°",prop:"remarks"},{label:"è‡ªå®šä¹‰è¡¨å•",prop:"formPath"},{label:"å…³è”è¡¨",prop:"formDataTable",type:"select",dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}}]},yl={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:300,column:[...Xe.column.map((e,t)=>({...e,search:t<2})),{label:"æµç¨‹ä¸»ç‰ˆæœ¬",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},Ot=A({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(e,{emit:t}){const o=e,{getList:c,deploy:s}=Ge(),{bindVal:a,crudStateRefs:{searchForm:d},getDataList:l}=X({tableOption:yl,crudOption:{getList:c},searchForm:{categoryId:o.categoryId}});G(()=>{d.value.categoryId=o.categoryId??"",l()});const r=I(!1);async function p(f){await Ve.confirm("å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œæ˜¯å¦ç¡®è®¤ï¼Ÿ","æç¤º",{type:"success"}),r.value=!0,s({flowModuleId:f.flowModuleId}).then(()=>{Z.success("å‘å¸ƒæˆåŠŸ"),l()}).finally(()=>{r.value=!1})}return(f,n)=>{const m=D("el-button"),i=D("avue-crud");return T(),$(i,oe(le(k(a))),{"menu-left":b(()=>[g(m,{type:"primary",icon:"el-icon-plus",onClick:n[0]||(n[0]=_=>t("add"))},{default:b(()=>[P(" æ–°å¢ ")]),_:1})]),menu:b(({row:_})=>[g(m,{loading:r.value,type:"text",icon:"el-icon-view",onClick:w=>t("view",_)},{default:b(()=>[P(" æŸ¥çœ‹ ")]),_:2},1032,["loading","onClick"]),g(m,{loading:r.value,type:"text",icon:"el-icon-edit",onClick:w=>t("edit",_)},{default:b(()=>[P(" ç¼–è¾‘ ")]),_:2},1032,["loading","onClick"]),g(m,{loading:r.value,type:"text",icon:"el-icon-upload",onClick:w=>p(_)},{default:b(()=>[P(" å‘å¸ƒ ")]),_:2},1032,["loading","onClick"]),g(m,{loading:r.value,type:"text",icon:"el-icon-switch",onClick:w=>t("version",_)},{default:b(()=>[P(" ç‰ˆæœ¬ç®¡ç† ")]),_:2},1032,["loading","onClick"])]),flowIcon:b(({row:_})=>[g(k(se),{icon:_.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),wl={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:250,column:[...Xe.column,{label:"æµç¨‹ç‰ˆæœ¬",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"æ˜¯å¦ä¸»ç‰ˆæœ¬",prop:"mainVersion",type:"select",dicData:[{label:"å¦",value:0},{label:"æ˜¯",value:1}]}]},$t=A({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(e,{emit:t}){const o=e,{getList:c,update:s}=Je(),{bindVal:a,crudStateRefs:{searchForm:d},getDataList:l}=X({tableOption:wl,crudOption:{getList:c,dataPath:"res.data"}});G(()=>{o.flowModuleId&&(d.value.flowModuleId=o.flowModuleId,l())});const r=I(!1);async function p(f){await Ve.confirm(`ç¡®å®šå°† ${f.flowName}(${f.flowKey}:v${f.version}) è®¾ä¸ºä¸»ç‰ˆæœ¬?`,"æç¤º",{type:"warning"}),r.value=!0,s({flowDeployId:f.flowDeployId,flowModuleId:f.flowModuleId,mainVersion:1}).then(()=>{Z.success("è®¾ç½®æˆåŠŸ"),l()}).finally(()=>{r.value=!1})}return(f,n)=>{const m=D("el-button"),i=D("avue-crud");return T(),$(i,oe(le(k(a))),{"menu-left":b(()=>[g(m,{loading:r.value,type:"primary",icon:"el-icon-arrow-left",onClick:n[0]||(n[0]=_=>t("back"))},{default:b(()=>[P(" è¿”å› ")]),_:1},8,["loading"])]),menu:b(({row:_})=>[g(m,{loading:r.value,type:"text",icon:"el-icon-view",onClick:w=>t("view",_)},{default:b(()=>[P(" æŸ¥çœ‹ ")]),_:2},1032,["loading","onClick"]),g(m,{loading:r.value,type:"text",icon:"el-icon-edit",onClick:w=>t("edit",_)},{default:b(()=>[P(" ç¼–è¾‘ ")]),_:2},1032,["loading","onClick"]),g(m,{loading:r.value,disabled:_.mainVersion===k(xt).æ˜¯,type:"text",icon:"el-icon-switch",onClick:w=>p(_)},{default:b(()=>[P(" è®¾ä¸ºä¸»ç‰ˆæœ¬ ")]),_:2},1032,["loading","disabled","onClick"])]),flowIcon:b(({row:_})=>[g(k(se),{icon:_.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),st={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"åˆ†ç±»åç§°",prop:"name",rules:[{required:!0,message:"è¯·è¾“å…¥åˆ†ç±»åç§°"}]},{label:"æè¿°",prop:"remark"}]}},gl=A({__name:"index",emits:["node-click"],setup(e,{emit:t}){const{crudStateRefs:{formData:o,tableData:c},getDataList:s,handleSave:a,handleUpdate:d,handleDel:l}=X({crudOption:{rowKey:"id",...pl(),dataPath:"res.data"},tableOption:st,pageOption:{pageSize:20}});s();function r(n,m,i,_){a(m,i,_)}function p(n,m,i,_){d(m,NaN,i,_)}async function f(n,m){await l(n.data,NaN),m()}return(n,m)=>{const i=D("avue-tree");return T(),$(i,{modelValue:k(o),"onUpdate:modelValue":m[0]||(m[0]=_=>ee(o)?o.value=_:null),option:k(st),data:k(c),onNodeClick:m[1]||(m[1]=_=>t("node-click",_)),onSave:r,onUpdate:p,onDel:f},null,8,["modelValue","option","data"])}}}),Ze=A({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(e,{emit:t}){var r;const o=e,{FormDesign:c}=z(),s=U({get(){return o.modelValue?mt(o.modelValue):{menuBtn:!1,span:24}},set(p){t("update:modelValue",lo(p,{useJson5:!1}))}}),a=U(()=>o.fields?JSON.parse(o.fields):[]),d=U(()=>{const p={type:"select",dicData:a.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...p,props:{label:"name",value:"name",desc:"comment"}},{...p,props:{label:"comment",value:"comment",desc:"name"}}]}),l={form:{settings:Array.from({length:((r=ao.settings)==null?void 0:r.length)??0}).fill({}).concat({label:"æ ·å¼ç±»",prop:"class"})}};return(p,f)=>{const n=D("avue-form");return p.view?(T(),$(n,{key:0,class:qt(s.value.class),"model-value":{},option:s.value},null,8,["class","option"])):(T(),$(k(c),{key:1,modelValue:s.value,"onUpdate:modelValue":f[0]||(f[0]=m=>s.value=m),"base-option":d.value,resources:l},null,8,["modelValue","base-option"]))}}}),hl=Q("span",null,"æµç¨‹è®¾è®¡",-1),kl={key:0},Cl={key:1},Vl={style:{height:"calc(100vh - 144px)"}},Dl=A({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(e,{emit:t}){const c=pe(e),{visible:s,modelValue:a}=c,{create:d,deploy:l,getDetail:r,update:p}=Ge(),{getDetail:f,update:n}=Je(),m=["æµç¨‹ä¿¡æ¯","è¡¨å•è®¾è®¡","æ¨¡å‹è®¾è®¡","å®Œæˆ"],i=I(!1);de(s,async S=>{if(!S)return;const{flowModuleId:C}=a.value,{flowDeployId:x}=a.value;try{i.value=!0;let L={};x?L=await f({flowDeployId:x}):C&&(L=await r({flowModuleId:C})),a.value=L.data}finally{i.value=!1}},{immediate:!0});const{data:_}=Nt().useList(),{data:w}=Lt().useList(),{data:u}=Ke().useList(),y=U(()=>{var S,C;return(C=(S=u.value)==null?void 0:S.find(x=>x.tableName===a.value.formDataTable))==null?void 0:C.tableFields}),v=I(0),h=U(()=>{var S,C;return v.value===1?((S=_.value)==null?void 0:S.map(x=>({label:x.formName,value:x.formOption})))??[]:v.value===2?((C=w.value)==null?void 0:C.map(x=>({label:x.flowName,value:x.flowData})))??[]:[]});function V(S){v.value===1?a.value.formOption=S.value:v.value===2&&(a.value.flowData=S.value)}const O=I();async function F(S){v.value===0&&await ze(O),i.value=!0;const{flowModuleId:C}=a.value,{flowDeployId:x}=a.value;try{x?await n(a.value):C?await p(a.value):await d(a.value).then(L=>{a.value.flowModuleId=L.data.flowModuleId}),Z.success("ä¿å­˜æˆåŠŸ")}finally{i.value=!1}typeof S=="number"?v.value=S:v.value++}async function N(){await Ve.confirm("å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œæ˜¯å¦ç¡®è®¤ï¼Ÿ","æç¤º"),i.value=!0,l({flowModuleId:a.value.flowModuleId}).then(()=>{Z.success("å‘å¸ƒæˆåŠŸ")}).finally(()=>{i.value=!1})}function R(){s.value=!1,v.value=0,a.value={},t("close")}return(S,C)=>{const x=D("el-link"),L=D("el-dropdown-item"),K=D("el-dropdown-menu"),H=D("el-dropdown"),Y=D("el-col"),M=D("el-step"),ye=D("el-steps"),re=D("el-button"),Ne=D("el-row"),Ie=D("avue-form"),St=D("el-result"),Rt=D("el-dialog"),Ft=ct("loading");return T(),$(Rt,{modelValue:k(s),"onUpdate:modelValue":C[5]||(C[5]=q=>ee(s)?s.value=q:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:R},{header:b(()=>[g(Ne,{justify:"center"},{default:b(()=>[g(Y,{span:5},{default:b(()=>{var q,fe,Oe,et;return[Q("div",null,[hl,(q=k(a))!=null&&q.flowName?(T(),E("span",kl," - "+j((fe=k(a))==null?void 0:fe.flowName),1)):B("",!0),(Oe=k(a))!=null&&Oe.version?(T(),E("span",Cl," - V"+j((et=k(a))==null?void 0:et.version),1)):B("",!0)]),h.value.length?(T(),$(H,{key:0},{dropdown:b(()=>[g(K,null,{default:b(()=>[(T(!0),E(W,null,J(h.value,$e=>(T(),$(L,{key:$e.label,onClick:Gl=>V($e)},{default:b(()=>[P(j($e.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:b(()=>[g(x,{icon:"el-icon-arrow-down",underline:!1},{default:b(()=>[P(" é€‰æ‹©æ¨¡æ¿ ")]),_:1})]),_:1})):B("",!0)]}),_:1}),g(Y,{span:14},{default:b(()=>[g(ye,{active:v.value,simple:"","process-status":"finish","finish-status":"success"},{default:b(()=>[(T(),E(W,null,J(m,(q,fe)=>g(M,{key:fe,title:q,onClick:Oe=>F(fe)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),g(Y,{span:5,style:{"text-align":"right"}},{default:b(()=>[g(re,{disabled:v.value===0,loading:i.value,type:"primary",onClick:C[0]||(C[0]=q=>v.value--)},{default:b(()=>[P(" ä¸Šä¸€æ­¥ ")]),_:1},8,["disabled","loading"]),g(re,{disabled:v.value===m.length-1,type:"primary",loading:i.value,onClick:C[1]||(C[1]=q=>F())},{default:b(()=>[P(" ä¸‹ä¸€æ­¥ ")]),_:1},8,["disabled","loading"]),g(re,{onClick:R},{default:b(()=>[P(" å…³é—­ ")]),_:1})]),_:1})]),_:1})]),default:b(()=>[dt((T(),E("div",Vl,[v.value===0?(T(),$(Ie,{key:0,ref_key:"formRef",ref:O,modelValue:k(a),"onUpdate:modelValue":C[2]||(C[2]=q=>ee(a)?a.value=q:null),option:k(Xe),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):B("",!0),v.value===1?(T(),$(Ze,{key:1,modelValue:k(a).formOption,"onUpdate:modelValue":C[3]||(C[3]=q=>k(a).formOption=q),fields:y.value},null,8,["modelValue","fields"])):B("",!0),v.value===2?(T(),$(be,{key:2,modelValue:k(a).flowData,"onUpdate:modelValue":C[4]||(C[4]=q=>k(a).flowData=q),"flow-form-option":k(a).formOption},null,8,["modelValue","flow-form-option"])):B("",!0),v.value===3?(T(),$(St,{key:3,icon:"success",title:"æµç¨‹è®¾è®¡å®Œæˆ"},{extra:b(()=>[k(a).flowDeployId?B("",!0):(T(),$(re,{key:0,type:"primary",onClick:N},{default:b(()=>[P(" å‘å¸ƒ ")]),_:1})),g(re,{onClick:R},{default:b(()=>[P(" å…³é—­ ")]),_:1})]),_:1})):B("",!0)])),[[Ft,i.value]])]),_:1},8,["modelValue"])}}}),Tl=Q("span",null,"æµç¨‹æŸ¥çœ‹",-1),xl={key:0},Ll={key:1},Nl=A({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(e){const o=pe(e),{visible:c,modelValue:s}=o,{getDetail:a}=Ge(),{getDetail:d}=Je(),l=I("form"),r=I(!1);de(c,async f=>{if(!f)return;const{flowModuleId:n}=s.value,{flowDeployId:m}=s.value;try{r.value=!0;let i={};m?i=await d({flowDeployId:m}):n&&(i=await a({flowModuleId:n})),s.value={...i.data}}finally{r.value=!1}},{immediate:!0});function p(){s.value={},l.value="form"}return(f,n)=>{const m=D("el-tab-pane"),i=D("el-tabs"),_=D("el-dialog"),w=ct("loading");return T(),$(_,{modelValue:k(c),"onUpdate:modelValue":n[3]||(n[3]=u=>ee(c)?c.value=u:null),width:"60%",top:"0",onClose:p},{header:b(()=>{var u,y,v,h;return[Tl,(u=k(s))!=null&&u.flowName?(T(),E("span",xl," - "+j((y=k(s))==null?void 0:y.flowName),1)):B("",!0),(v=k(s))!=null&&v.version?(T(),E("span",Ll," - V"+j((h=k(s))==null?void 0:h.version),1)):B("",!0)]}),default:b(()=>[dt((T(),$(i,{modelValue:l.value,"onUpdate:modelValue":n[2]||(n[2]=u=>l.value=u)},{default:b(()=>[g(m,{label:"æŸ¥çœ‹è¡¨å•",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:b(()=>[l.value==="form"&&k(s).formOption?(T(),$(Ze,{key:0,modelValue:k(s).formOption,"onUpdate:modelValue":n[0]||(n[0]=u=>k(s).formOption=u),view:""},null,8,["modelValue"])):B("",!0)]),_:1}),g(m,{label:"æŸ¥çœ‹æµç¨‹",name:"flow",style:{height:"600px"}},{default:b(()=>[l.value==="flow"?(T(),$(be,{key:0,modelValue:k(s).flowData,"onUpdate:modelValue":n[1]||(n[1]=u=>k(s).flowData=u),view:""},null,8,["modelValue"])):B("",!0)]),_:1})]),_:1},8,["modelValue"])),[[w,r.value]])]),_:1},8,["modelValue"])}}}),Il=A({__name:"index",setup(e){const t=I("definition"),o=I({}),c=I(""),s=I("");function a(_){c.value===_.id?c.value="":c.value=_.id}const d=I(!1),l=I(!1);function r(){o.value={},d.value=!0}function p(_){o.value=_,d.value=!0}function f(_){o.value=_,l.value=!0}function n(_){s.value=_.flowModuleId||"",t.value="deploy"}function m(){s.value="",t.value="definition"}async function i(){const _=t.value;await ve(),t.value="",await ve(),t.value=`${_}`}return(_,w)=>{const u=D("el-col"),y=D("el-row");return T(),$(y,{gutter:20},{default:b(()=>[g(u,{span:4},{default:b(()=>[g(gl,{onNodeClick:a})]),_:1}),g(u,{span:20},{default:b(()=>[t.value==="definition"?(T(),$(Ot,{key:0,"category-id":c.value,onAdd:r,onEdit:p,onView:f,onVersion:n},null,8,["category-id"])):B("",!0),t.value==="deploy"?(T(),$($t,{key:1,"flow-module-id":s.value,onEdit:p,onView:f,onBack:m},null,8,["flow-module-id"])):B("",!0),g(Dl,{modelValue:o.value,"onUpdate:modelValue":w[0]||(w[0]=v=>o.value=v),visible:d.value,"onUpdate:visible":w[1]||(w[1]=v=>d.value=v),onClose:i},null,8,["modelValue","visible"]),g(Nl,{modelValue:o.value,"onUpdate:modelValue":w[2]||(w[2]=v=>o.value=v),visible:l.value,"onUpdate:visible":w[3]||(w[3]=v=>l.value=v)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),Ol=[{label:"æµç¨‹åç§°",prop:"flowName"},{label:"æµç¨‹æ ‡è¯†",prop:"flowKey"},{label:"æµç¨‹åˆ†ç±»",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"æ ‡é¢˜",prop:"processTitle",search:!0},{label:"æµæ°´å·",prop:"serialNumber"},{label:"å½“å‰èŠ‚ç‚¹",prop:"taskNodeName"},{label:"å®¡æ‰¹äºº",prop:"assigneeName"},{label:"ç”³è¯·äºº",prop:"applyUserName"},{label:"æ¥æ”¶æ—¶é—´",prop:"startTime"},{label:"ä»»åŠ¡çŠ¶æ€",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}].map(e=>({...e,display:!1})),$l=[{label:"å®¡æ‰¹äºº",prop:"assignee"},{label:"èŠ‚ç‚¹åç§°",prop:"taskNodeName"},{label:"æ¥æ”¶æ—¶é—´",prop:"startTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"ç»“æŸæ—¶é—´",prop:"endTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"è€—æ—¶",prop:"duration"},{label:"ä¼ é˜…æ„è§",prop:"comment"}].map(e=>({...e,hide:!0})),Sl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!0,addBtn:!1,column:[...Ol,...$l]},Rl=A({__name:"index",setup(e){const t=so("debugMode",!1),{getTaskOpsList:o}=fl(),{getCirculateOpsList:c,updateCirculate:s,removeCirculate:a}=Tt(),{bindVal:d,getDataList:l,crudStateRefs:{searchForm:r,crudOption:p}}=X({tableOption:Sl,crudOption:{getList:o},searchForm:{status:2},sortOption:{descs:"start_time"}});xe(r,l,{debounce:300,immediate:!0,deep:!0});const f=I("task"),n=[{label:"ä»»åŠ¡",name:"task",getList:o},{label:"ä¼ é˜…",name:"circulate",getList:c,update:s,remove:a}];function m({paneName:u}){const y=n.find(v=>v.name===u);p.value.getList=y.getList,p.value.update=y.update,p.value.remove=y.remove,l()}const{open:i,close:_}=kt({onComplete:()=>(_(),l())},{type:"drawer"});function w(u){i({flowKey:u.flowKey,taskId:u.taskId,instanceId:u.flowInstanceId,debug:t.value,circulateId:u.id})}return(u,y)=>{const v=D("el-tab-pane"),h=D("el-tabs"),V=D("el-switch"),O=D("el-button"),F=D("el-link"),N=D("avue-crud");return T(),E(W,null,[g(h,{modelValue:f.value,"onUpdate:modelValue":y[0]||(y[0]=R=>f.value=R),onTabClick:m},{default:b(()=>[(T(),E(W,null,J(n,R=>g(v,{key:R.name,label:R.label,name:R.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),g(N,Qt(k(d),{permission:{menu:f.value==="circulate"}}),{"menu-right":b(()=>[g(O,{type:"text"},{default:b(()=>[g(V,{modelValue:k(t),"onUpdate:modelValue":y[1]||(y[1]=R=>ee(t)?t.value=R:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:b(({row:R})=>[g(F,{type:"primary",underline:!1,onClick:S=>w(R)},{default:b(()=>[P(j(R.processTitle||"æ— æ ‡é¢˜"),1)]),_:2},1032,["onClick"])]),_:1},16,["permission"])],64)}}}),Fl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,column:[{label:"é…ç½®åç§°",prop:"paramName",search:!0},{label:"é…ç½®Key",prop:"paramKey",search:!0},{label:"å¤‡æ³¨",prop:"remark"},{label:"ç³»ç»Ÿå†…ç½®",prop:"paramType",type:"switch",dicData:Ae},{label:"é…ç½®å€¼",prop:"paramValue",type:"textarea",maxRows:20,span:24,overHidden:!0}]},Pl=A({__name:"index",setup(e){const{bindVal:t,getDataList:o}=X({tableOption:Fl,crudOption:me()});return o(),(c,s)=>{const a=D("avue-crud");return T(),$(a,oe(le(k(t))),null,16)}}}),Ul={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"æµç¨‹åç§°",prop:"flowName"},{label:"æµç¨‹æ ‡è¯†",prop:"flowKey"},{label:"æµç¨‹åˆ†ç±»",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"æ ‡é¢˜",prop:"processTitle",search:!0},{label:"æµæ°´å·",prop:"serialNumber"},{label:"å½“å‰èŠ‚ç‚¹",prop:"taskNodeName"},{label:"å®¡æ‰¹äºº",prop:"assigneeName"},{label:"ç”³è¯·äºº",prop:"applyUserName"},{label:"æ¥æ”¶æ—¶é—´",prop:"startTime"}]},El={class:"flow-list"},Al=["onClick"],Kl={class:"flow-name"},Ml=A({__name:"index",setup(e){const t=I([]),{getPublishList:o,getTaskList:c}=Le(),{getCirculateList:s}=Tt();o().then(u=>{t.value=u.data});const a=[{label:"å¾…åŠ",value:2},{label:"å·²åŠ",value:1}],{bindVal:d,getDataList:l,crudStateRefs:{searchForm:r,crudOption:p}}=X({tableOption:Ul,crudOption:{getList:c},searchForm:{status:2}});xe(r,l,{debounce:300,immediate:!0,deep:!0});const f=I("task"),n=[{label:"ä»»åŠ¡",name:"task",getList:c},{label:"ä¼ é˜…",name:"circulate",getList:s}];function m({paneName:u}){const y=n.find(v=>v.name===u);p.value.getList=y.getList,l()}const{open:i,close:_}=kt({onComplete:()=>(_(),l())},{type:"drawer"});function w(u){i({flowKey:u.flowKey,taskId:u.taskId,instanceId:u.flowInstanceId,circulateId:u.id,detail:u.taskId?u.status===gt.å·²åŠ:!1})}return(u,y)=>{const v=D("el-button"),h=D("el-collapse-item"),V=D("el-collapse"),O=D("el-card"),F=D("el-divider"),N=D("el-tab-pane"),R=D("el-tabs"),S=D("avue-radio"),C=D("el-link"),x=D("avue-crud");return T(),E(W,null,[g(O,{"body-style":{padding:"0 20px"}},{default:b(()=>[g(V,{"model-value":"1"},{default:b(()=>[g(h,{name:"1"},{title:b(()=>[g(v,{text:"",icon:"el-icon-promotion"},{default:b(()=>[P(" å‘èµ·å®¡æ‰¹ ")]),_:1})]),default:b(()=>[Q("div",El,[(T(!0),E(W,null,J(t.value,L=>(T(),E("div",{key:L.flowKey,class:"flow-item",onClick:K=>w(L)},[g(k(se),{class:"flow-icon",icon:L.flowIcon,width:"60"},null,8,["icon"]),Q("div",Kl,j(L.flowName),1)],8,Al))),128))])]),_:1})]),_:1})]),_:1}),g(F,{direction:"horizontal","content-position":"left"}),g(R,{modelValue:f.value,"onUpdate:modelValue":y[0]||(y[0]=L=>f.value=L),onTabClick:m},{default:b(()=>[(T(),E(W,null,J(n,L=>g(N,{key:L.name,label:L.label,name:L.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),g(x,oe(le(k(d))),{"menu-left":b(()=>[g(S,{modelValue:k(r).status,"onUpdate:modelValue":y[1]||(y[1]=L=>k(r).status=L),button:"",dic:a},null,8,["modelValue"])]),processTitle:b(({row:L})=>[g(C,{type:"primary",underline:!1,onClick:K=>w(L)},{default:b(()=>[P(j(L.processTitle||"æ— æ ‡é¢˜"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}});const Bl=Te(Ml,[["__scopeId","data-v-e1f72e36"]]),jl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"æµç¨‹æ ‡è¯†",prop:"flowKey",search:!0},{label:"æµç¨‹åç§°",prop:"flowName",search:!0},{label:"æµç¨‹æ¨¡å‹æ•°æ®",prop:"flowData",display:!1},{label:"æµç¨‹å¤‡æ³¨",prop:"remarks"},{label:"æ’åº",prop:"sort"}]},Hl=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:c,handleUpdate:s}=X({tableOption:jl,crudOption:Lt()});c();const a=I(!1);async function d(r){o.value=r,a.value=!0}async function l(){await s(o.value,NaN,()=>a.value=!1,()=>{})}return(r,p)=>{const f=D("el-button"),n=D("avue-crud"),m=D("el-dialog");return T(),E(W,null,[g(n,oe(le(k(t))),{flowData:b(({row:i})=>[g(f,{type:"primary",text:"",icon:"el-icon-crop",onClick:_=>d(i)},{default:b(()=>[P(" è®¾è®¡ ")]),_:2},1032,["onClick"])]),_:1},16),g(m,{modelValue:a.value,"onUpdate:modelValue":p[2]||(p[2]=i=>a.value=i),title:`æ¨¡å‹è®¾è®¡-${k(o).flowName}`,fullscreen:"","destroy-on-close":""},{footer:b(()=>[g(f,{type:"primary",onClick:l},{default:b(()=>[P(" ä¿å­˜ ")]),_:1}),g(f,{onClick:p[1]||(p[1]=i=>a.value=!1)},{default:b(()=>[P(" å–æ¶ˆ ")]),_:1})]),default:b(()=>[g(be,{modelValue:k(o).flowData,"onUpdate:modelValue":p[0]||(p[0]=i=>k(o).flowData=i),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),zl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"è¡¨å•æ ‡è¯†",prop:"formKey",search:!0},{label:"è¡¨å•åç§°",prop:"formName",search:!0},{label:"è¡¨å•é…ç½®",prop:"formOption",display:!1},{label:"è¡¨å•å¤‡æ³¨",prop:"remarks"},{label:"æ’åº",prop:"sort",type:"number"}]},Wl=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:c,handleUpdate:s}=X({tableOption:zl,crudOption:Nt()});c();const a=I(!1);async function d(r){o.value={...r},a.value=!0}async function l(){await s(o.value,NaN,()=>a.value=!1,()=>{})}return(r,p)=>{const f=D("el-button"),n=D("avue-crud"),m=D("el-dialog");return T(),E(W,null,[g(n,oe(le(k(t))),{formOption:b(({row:i})=>[g(f,{type:"primary",text:"",icon:"el-icon-crop",onClick:_=>d(i)},{default:b(()=>[P(" è®¾è®¡ ")]),_:2},1032,["onClick"])]),_:1},16),g(m,{modelValue:a.value,"onUpdate:modelValue":p[2]||(p[2]=i=>a.value=i),title:`è¡¨å•è®¾è®¡-${k(o).formName}`,fullscreen:"","destroy-on-close":""},{footer:b(()=>[g(f,{type:"primary",onClick:l},{default:b(()=>[P(" ä¿å­˜ ")]),_:1}),g(f,{onClick:p[1]||(p[1]=i=>a.value=!1)},{default:b(()=>[P(" å–æ¶ˆ ")]),_:1})]),default:b(()=>[g(Ze,{modelValue:k(o).formOption,"onUpdate:modelValue":p[0]||(p[0]=i=>k(o).formOption=i),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),rt=[{label:"å­—æ®µåç§°",prop:"name"},{label:"å­—æ®µå¤‡æ³¨",prop:"comment"},{label:"å­—æ®µç±»å‹",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:ne(It)},{label:"å­—æ®µé•¿åº¦",prop:"size",type:"number"},{label:"å°æ•°ä½",prop:"point",type:"number"},{label:"é»˜è®¤å€¼",prop:"default"},{label:"æ˜¯å¦ä¸»é”®",prop:"primary",type:"switch",dicData:Ae,value:0},{label:"æ˜¯å¦å…è®¸ä¸ºç©º",prop:"permitNull",type:"switch",dicData:Ae,value:1}],Yl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,dialogFullscreen:!0,column:[{label:"è¡¨å",prop:"tableName",search:!0},{label:"è¡¨æ³¨é‡Š",prop:"tableComment",search:!0},{label:"è¡¨å¼•æ“",prop:"tableEngine"},{label:"è¡¨ä¸»é”®ç­–ç•¥",prop:"tablePrimary"},{label:"æ•°æ®åº“å­—æ®µ",prop:"editFields",hide:!0,type:"dynamic",children:{column:rt}},{label:"é»˜è®¤å­—æ®µ",prop:"defaultFields",hide:!0,type:"dynamic",children:{addBtn:!1,delBtn:!1,column:rt}}]},ql=Q("br",null,null,-1),Ql=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o,defaults:c},getDataList:s,afterOpen:a,beforeSubmit:d}=X({crudOption:Ke(),tableOption:Yl});s();const{data:l}=me().useParam("table.default.fields");a(m=>{if(o.value.defaultFields=l.value??[],m==="edit"){const i=JSON.parse(o.value.tableFields);o.value.editFields=ft(i,l.value??[],"name")}}),d(m=>{const i=[...m.defaultFields,...m.editFields];m.tableFields=JSON.stringify(i)});const r=I(!1);G(()=>{var m;(m=c.value)!=null&&m.defaultFields&&(c.value.defaultFields.display=r.value)});const{deploy:p}=Ke(),f=I(!1);async function n(m){await Ve.confirm("éƒ¨ç½²å°†è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“è¡¨ï¼Œæ˜¯å¦ç¡®è®¤ï¼Ÿ","æç¤º",{type:"success"}),f.value=!0,p({id:m.id}).then(()=>{Z.success("éƒ¨ç½²æˆåŠŸ"),s()}).finally(()=>{f.value=!1})}return(m,i)=>{const _=D("el-button"),w=D("el-switch"),u=D("el-tooltip"),y=D("avue-crud");return T(),$(y,oe(le(k(t))),{menu:b(({row:v})=>[g(_,{type:"text",icon:"el-icon-upload",onClick:h=>n(v)},{default:b(()=>[P(" éƒ¨ç½² ")]),_:2},1032,["onClick"])]),"editFields-label":b(()=>[Q("div",null,[P(" æ•°æ®åº“å­—æ®µ "),ql,g(u,{content:"æ˜¾ç¤ºé»˜è®¤å­—æ®µ"},{default:b(()=>[g(w,{modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=v=>r.value=v)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),ln={install(e,t){e.component("FlowButton",bl).component("FlowDefinition",Ot).component("FlowDeploy",$t).component("FlowForm",We).component("FlowManage",Il).component("FlowOps",Rl).component("FlowParam",Pl).component("FlowTemplate",Hl).component("FormTemplate",Wl).component("TableTemplate",Ql).component("FlowWorkbench",Bl),z(e,t)}};export{cl as CONFIG_DEFAULT,nt as CONFIG_PROVIDE_KEY,bl as FlowButton,Ot as FlowDefinition,$t as FlowDeploy,We as FlowForm,Il as FlowManage,Rl as FlowOps,Pl as FlowParam,Hl as FlowTemplate,Bl as FlowWorkbench,Wl as FormTemplate,Ql as TableTemplate,Ct as Whether,ln as default,ol as resolveFlowFormComponent,z as useConfigProvider,kt as useFlowForm,tl as useFlowFormOverlay,el as useFlowFormWindow,Ae as whetherDic};
