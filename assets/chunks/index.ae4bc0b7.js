import{a as ut,s as Et,e as ne,b as At,u as Z}from"./index.15c943cf.js";import{I as se}from"./iconify.5d378855.js";import{d as Kt}from"./index.5e3eb256.js";import{X as Me,B as De,r as N,s as he,d as U,e as J,w as pe,i as ee,u as k,n as _e,Y as Mt,h as A,H as C,j as T,k as E,R as X,F as W,D as $,E as b,J as g,p as P,q as j,a3 as tt,C as q,_ as Te,G as B,K as Bt,l as jt,O as lt,b as it,L as Ht,a9 as Ue,aA as zt,M as Wt,a7 as le,a8 as oe,m as Yt,aM as ct,a5 as dt,I as qt}from"./framework.268af5be.js";import{_ as Qt,d as Gt,a as Jt}from"./index.3004631c.js";import"./index.83770497.js";import{t as pt,P as ft,f as Xt,M as mt,L as Zt,u as el}from"./vuedraggable.umd.5bd0051d.js";import{u as fe,w as xe,d as tl,e as ll}from"./theme.a5c17c5b.js";import{p as ol}from"./index.vue_vue_type_script_setup_true_lang.ed2201cd.js";import{E as Q,m as al,a as de}from"./index.e39bc4dd.js";import{d as vt}from"./differenceBy.2c7dc01c.js";import{aa as nl,F as sl,D as ge}from"./index.f85f9727.js";import{o as rl}from"./omitBy.9af654cc.js";import{a as ul}from"./snakeCase.5ddcd990.js";import{J as il,K as cl}from"../app.12d20234.js";import"./omit.67d7f778.js";import"./vue.runtime.esm-bundler.8984e576.js";const dl={},pl=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),fl=()=>dl,ae=e=>e,Ee=e=>Array.isArray(e),Be=e=>e!==null&&typeof e=="object",je=e=>e instanceof Function,be=e=>e==null,He=typeof window>"u",_t=()=>{var e;return He||be((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},ml=()=>{var e,t;return(e=!He&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},Se=()=>new Promise(()=>{}),te=e=>ee(e)?e.value:e,vl=e=>Be(e)?Object.assign(Ee(e)?[]:{},e):e,ke=new Map,_l=e=>be(e)?void 0:ke.get(e),bl=(e,t,l)=>{const p=ke.get(e);p!=null&&p.timer&&clearTimeout(p.timer);const n=setTimeout(()=>ke.delete(e),t);ke.set(e,{...l,timer:n})};function bt(e,t,l){let p,n,a,c,o,r,f=0,_=!1,s=!1,d=!0;const u=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,Be(l)&&(_=!!l.leading,s="maxWait"in l,a=s?Math.max(+l.maxWait||0,t):a,d="trailing"in l?!!l.trailing:d);function y(V){const x=p,L=n;return p=n=void 0,f=V,c=e.apply(L,x),c}function w(V,x){return u?(window.cancelAnimationFrame(o),window.requestAnimationFrame(V)):setTimeout(V,x)}function i(V){if(u)return window.cancelAnimationFrame(V);clearTimeout(V)}function v(V){return f=V,o=w(D,t),_?y(V):c}function m(V){const x=V-r,L=V-f,K=t-x;return s?Math.min(K,a-L):K}function h(V){const x=V-r,L=V-f;return r===void 0||x>=t||x<0||s&&L>=a}function D(){const V=Date.now();if(h(V))return O(V);o=w(D,m(V))}function O(V){return o=void 0,d&&p?y(V):(p=n=void 0,c)}function F(){o!==void 0&&i(o),f=0,p=r=n=o=void 0}function I(){return o===void 0?c:O(Date.now())}function R(){return o!==void 0}function S(){const V=Date.now(),x=h(V);for(var L=arguments.length,K=new Array(L),H=0;H<L;H++)K[H]=arguments[H];if(p=K,n=this,r=V,x){if(o===void 0)return v(r);if(s)return o=w(D,t),y(r)}return o===void 0&&(o=w(D,t)),c}return S.cancel=F,S.flush=I,S.pending=R,S}function wl(e,t,l){let p=!0,n=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Be(l)&&(p="leading"in l?!!l.leading:p,n="trailing"in l?!!l.trailing:n),bt(e,t,{leading:p,trailing:n,maxWait:t})}var yl=ae((e,t)=>{let{debounceInterval:l,debounceOptions:p,manual:n}=t;const a=N(!1),c=N(),o=U(()=>p),r=U(()=>te(l)),f=N(e.context.runAsync);return n||(a.value=!0),J(_=>{be(r.value)||(c.value=bt(s=>s(),r.value,o.value),e.context.runAsync=function(){for(var s=arguments.length,d=new Array(s),u=0;u<s;u++)d[u]=arguments[u];return new Promise((y,w)=>{a.value?(a.value=!1,f.value(...d).then(y).catch(w)):c.value(()=>{f.value(...d).then(y).catch(w)})})},_(()=>{var s;(s=c.value)===null||s===void 0||s.cancel(),e.context.runAsync=f.value}))}),{onCancel(){var _;(_=c.value)===null||_===void 0||_.cancel()}}}),gl=ae((e,t)=>{let{errorRetryCount:l=0,errorRetryInterval:p=0}=t;const n=N(),a=N(0),c=U(()=>te(l)),o=U(()=>te(p));let r=!1;const f=()=>{a.value=0},_=U(()=>{if(o.value)return o.value;const u=1e3,y=1,w=9,i=Math.floor(Math.random()*2**Math.min(a.value,w)+y);return u*i}),s=()=>{let u;const y=c.value===-1,w=a.value<c.value;return(y||w)&&(y||(a.value+=1),u=setTimeout(()=>{r=!0,e.context.refresh()},_.value)),()=>u&&clearTimeout(u)},d=()=>{n.value&&n.value()};return{onBefore(){r||f(),r=!1,d()},onSuccess(){f()},onError(){n.value=s()},onCancel(){f(),d()}}}),hl=ae((e,t)=>{let{ready:l=N(!0),manual:p,defaultParams:n=[]}=t;return pe(l,a=>{!p&&a&&e.context.run(...n)},{flush:"sync"}),{onBefore(){if(!(je(l)?l():l.value))return e.loading.value=!1,{isBreak:!0}}}}),kl=ae((e,t)=>{let{refreshDeps:l,refreshDepsAction:p,manual:n}=t;if(l===void 0||Ee(l)&&l.length===0)return{};const a=Ee(l)?l:[l];return pe(a,()=>{p?p():!n&&e.context.refresh()}),{}}),Cl=ae((e,t)=>{let{throttleInterval:l,throttleOptions:p}=t;const n=N(),a=U(()=>te(l)),c=U(()=>p),o=N(e.context.runAsync);return J(r=>{if(be(l))return{};n.value=wl(f=>f(),a.value,c.value),e.context.runAsync=function(){for(var f=arguments.length,_=new Array(f),s=0;s<f;s++)_[s]=arguments[s];return new Promise((d,u)=>{n.value(()=>{o.value(..._).then(d).catch(u)})})},r(()=>{var f;(f=n.value)===null||f===void 0||f.cancel(),e.context.runAsync=o.value})}),{onCancel(){var r;(r=n.value)===null||r===void 0||r.cancel()}}});const Vl=(e,t)=>l=>{Object.keys(l).forEach(p=>{e[p].value=l[p]}),t.forEach(p=>p(e))},Dl=(e,t)=>()=>{let l=t;for(let p=e.length;p-- >0;)l=e[p](l);return l()},Tl=(e,t,l)=>{var p,n;const{initialData:a,onSuccess:c,onError:o,onBefore:r,onAfter:f}=t,_=N((p=l==null?void 0:l.loading)!==null&&p!==void 0?p:!1),s=he((n=l==null?void 0:l.data)!==null&&n!==void 0?n:a),d=he(l==null?void 0:l.error),u=N(l==null?void 0:l.params),y=N([]),w=he("pending"),i={},v=Vl({status:w,loading:_,data:s,error:d,params:u},[]),m=function(D){for(var O=arguments.length,F=new Array(O>1?O-1:0),I=1;I<O;I++)F[I-1]=arguments[I];if(D==="onQuery"){const R=y.value.map(S=>S.onQuery).filter(Boolean);return{servicePromise:Dl(R,F[0])()}}else{const R=y.value.map(S=>{var V;return(V=S[D])===null||V===void 0?void 0:V.call(S,...F)});return Object.assign({},...R)}},h=N(0);return i.runAsync=async function(){for(var D=arguments.length,O=new Array(D),F=0;F<D;F++)O[F]=arguments[F];v({loading:!0,params:O,status:"pending"}),h.value+=1;const I=h.value,{isBreak:R,breakResult:S=Se()}=m("onBefore",O);if(R)return v({status:"settled"}),S;r==null||r(O);try{const V=()=>new Promise(K=>K(e(...u.value)));let{servicePromise:x}=m("onQuery",V);x||(x=V());const L=await x;return I!==h.value?Se():(v({data:L,loading:!1,error:void 0,status:"settled"}),m("onSuccess",L,O),c==null||c(L,O),I===h.value&&m("onAfter",O,L,void 0),f==null||f(O),L)}catch(V){if(I!==h.value)return Se();throw v({loading:!1,error:V,status:"settled"}),m("onError",V,O),o==null||o(V,O),I===h.value&&m("onAfter",O,void 0,V),f==null||f(O),V}},i.run=function(){i.runAsync(...arguments).catch(D=>{o||console.error(D)})},i.cancel=()=>{h.value+=1,v({loading:!1}),m("onCancel")},i.refresh=()=>{i.run(...u.value||[])},i.refreshAsync=()=>i.runAsync(...u.value||[]),i.mutate=D=>{const O=je(D)?D(s.value):D,F=vl(O);v({data:F}),m("onMutate",F)},{status:w,loading:_,data:s,error:d,params:u,plugins:y,context:i}};function xl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const p=Me(pl,{}),n={...fl(),...p,...t},{manual:a=!1,defaultParams:c=[]}=n,o=Tl(e,n);if(o.plugins.value=l.map(r=>r(o,n)),!a){const r=o.params.value||c;o.context.run(...r)}return De(()=>{o.context.cancel()}),{loading:o.loading,data:o.data,error:o.error,params:o.params,cancel:o.context.cancel,refresh:o.context.refresh,refreshAsync:o.context.refreshAsync,mutate:o.context.mutate,run:o.context.run,runAsync:o.context.runAsync}}const Ce=new Map,Ll=(e,t)=>{Ce.set(e,t),t.then(l=>(Ce.delete(e),l)).catch(()=>{Ce.delete(e)})},Nl=e=>Ce.get(e),ue=new Map,Il=(e,t)=>{ue.has(e)&&ue.get(e).forEach(l=>l(t))},Ol=(e,t)=>(ue.has(e)?ue.get(e).push(t):ue.set(e,[t]),()=>{const l=ue.get(e).indexOf(t);ue.get(e).splice(l,1)});var $l=ae((e,t)=>{let{cacheKey:l,cacheTime:p=6e5,staleTime:n=0,getCache:a,setCache:c}=t;if(!l)return{};const o=je(l)?l:()=>l,r=N(()=>{});let f;const _=v=>a?a(v):_l(v),s=(v,m,h)=>{c?c(v,h):bl(v,m,h),Il(v,h.data)},d=v=>n===-1||v+n>new Date().getTime(),u=(v,m)=>Object.prototype.hasOwnProperty.call(v,m),y=v=>{const m=o(v);return Ol(m,h=>{e.data.value=h})},w=o(),i=_(w);return i&&u(i,"data")&&(e.data.value=i.data,e.params.value=i.params),w&&(r.value=y()),De(()=>{r.value()}),{onBefore(v){const m=o(v),h=_(m);if(!h||!u(h,"data"))return{};if(d(h.time))return e.data.value=h.data,e.loading.value=!1,{isBreak:!0,breakResult:h.data};e.data.value=h.data},onQuery(v){const m=e.params.value,h=o(m);let D=Nl(h);return D&&D!==f?()=>D:(D=v(),f=D,Ll(h,D),()=>D)},onSuccess(v,m){const h=o(m);h&&(r.value(),s(h,p,{data:v,params:m,time:new Date().getTime()}),r.value=y(m))},onMutate(v){const m=o(e.params.value);m&&(r.value(),s(m,p,{data:v,params:e.params.value,time:new Date().getTime()}),r.value=y(e.params.value))}}});function Sl(e){let t,l;class p extends Promise{constructor(a){super(a),this.cancel=()=>{l(),clearTimeout(t)}}}return new p(n=>{l=n,t=setTimeout(l,e)})}function Fe(){return new Date().getTime()}var Fl=ae((e,t)=>{let{loadingDelay:l=0,loadingKeep:p=0}=t;const n=N(()=>{}),a=U(()=>te(l)),c=U(()=>te(p));let o=0,r={};const f=()=>{let _;return a.value&&(_=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},a.value)),()=>_&&clearTimeout(_)};return{onBefore(){e.loading.value=!a.value,n.value(),n.value=f(),o=Fe()},onQuery(_){if(!c.value)return()=>_();r=Sl(c.value+a.value);const s=async()=>{try{const u=await _();return Fe()-o<=a.value&&r.cancel(),Promise.resolve(u)}catch(u){return Fe()-o<=a.value&&r.cancel(),Promise.reject(u)}},d=Promise.allSettled([s(),r]).then(u=>{const y=u[0];return y.status==="fulfilled"?y.value:Promise.reject(y.reason)});return()=>d},onCancel(){n.value()},onAfter(){n.value()}}}),Re;const wt=new Set,yt=new Set,gt=new Set,Ve=(e,t)=>{let l;switch(e){case"FOCUS_LISTENER":l=wt;break;case"RECONNECT_LISTENER":l=gt;break;case"VISIBLE_LISTENER":l=yt;break}if(!l.has(t))return l.add(t),()=>{l.delete(t)}},Pe=e=>{e.forEach(t=>{t()})};!He&&(Re=window)!==null&&Re!==void 0&&Re.addEventListener&&(window.addEventListener("visibilitychange",()=>{_t()&&Pe(yt)},!1),window.addEventListener("focus",()=>Pe(wt),!1),window.addEventListener("online",()=>Pe(gt),!1));var Rl=ae((e,t)=>{let{pollingInterval:l,pollingWhenHidden:p=!1,pollingWhenOffline:n=!1,errorRetryCount:a=0}=t;const c=N(),o=N(!1),r=U(()=>te(l)),f=U(()=>te(a)),_=[],s=w=>{w&&_.push(w)},d=()=>(p||_t())&&(n||ml()),u=w=>{if(e.error.value&&f.value!==0)return;let i;if(!be(r.value)&&r.value>=0)if(d())i=setTimeout(w,r.value);else{o.value=!0;return}return()=>i&&clearTimeout(i)},y=()=>{o.value&&d()&&(e.context.refresh(),o.value=!1)};return pe(r,()=>{c.value&&(c.value(),c.value=u(()=>e.context.refresh()))}),p||s(Ve("VISIBLE_LISTENER",y)),n||s(Ve("RECONNECT_LISTENER",y)),De(()=>{_.forEach(w=>w())}),{onBefore(){var w;(w=c.value)===null||w===void 0||w.call(c)},onCancel(){var w;(w=c.value)===null||w===void 0||w.call(c)},onAfter(){c.value=u(()=>e.context.refresh())}}});const Pl=(e,t)=>{let l=!1;return function(){l||(l=!0,e(...arguments),setTimeout(()=>{l=!1},t))}};var Ul=ae((e,t)=>{let{refreshOnWindowFocus:l=!1,refocusTimespan:p=5e3}=t;const n=U(()=>te(l)),a=U(()=>te(p)),c=[],o=f=>{f&&c.push(f)},r=()=>{c.forEach(f=>f())};return J(()=>{if(r(),n.value){const f=Pl(e.context.refresh,a.value);o(Ve("VISIBLE_LISTENER",f)),o(Ve("FOCUS_LISTENER",f))}}),De(()=>{r()}),{}});function ie(e,t){return xl(e,t,[Fl,gl,yl,Rl,Cl,Ul,kl,hl,$l])}var ht=(e=>(e[e.å·²åŠ=1]="å·²åŠ",e[e.å¾…åŠ=2]="å¾…åŠ",e[e.å¤±è´¥=3]="å¤±è´¥",e[e.æ’¤é”€=4]="æ’¤é”€",e[e.ç»ˆæ­¢=5]="ç»ˆæ­¢",e))(ht||{});function Le(){const{request:e}=z(),t={publishList:"/sapier-flow/flow-run/queryPublishFlowList",taskList:"/sapier-flow/flow-run/userTaskList",detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",reject:"/sapier-flow/flow-run/rollbackTask",green:"/sapier-flow/flow-run/greenTask",circulate:"/sapier-flow/flow-circulate/commitTask"};return{url:t,getPublishList:()=>e.get(t.publishList),getTaskList:i=>e.get(t.taskList,{params:i}),getFlowDetail:i=>e.get(t.detail,{params:i}),getApprovalNode:i=>e.post(t.approvalNode,i),startTask:i=>e.post(t.start,i),commitTask:i=>e.post(t.commit,i),saveDraft:i=>e.post(t.draft,i),revokeTask:i=>e.post(t.revoke,i),terminateTask:i=>e.post(t.terminate,i),withdrawTask:i=>e.post(t.withdraw,i),transferTask:i=>e.post(t.transfer,i),rejectTask:i=>e.post(t.reject,i),greenChannel:i=>e.post(t.green,i),circulateTask:i=>e.post(t.circulate,i)}}function El(e){const{commitTask:t,revokeTask:l,saveDraft:p,startTask:n,terminateTask:a,transferTask:c,withdrawTask:o,rejectTask:r,greenChannel:f,circulateTask:_}=Le(),s=U(()=>{const{flowDetail:u,formVariables:y,approvalFormData:w,debug:i,fileIds:v}=e,{flowDeployId:m}=u.value.process??{},{taskId:h,flowInstanceId:D}=u.value.task??{};return{flowDeployId:m,taskId:h,flowInstanceId:D,variables:y.value,debug:i.value,fileIds:v.value,...w.value}}),d=()=>s.value.taskId&&s.value.flowInstanceId;return{flow_draft(){if(d())return p(s.value)},flow_pass(){return d()?t(s.value):n(s.value)},flow_revoke(){if(d())return l(s.value)},flow_withdraw(){if(d())return o(s.value)},flow_terminate(){if(d())return a(s.value)},flow_transfer(){if(d())return c(s.value)},flow_reject(){if(d())return r(s.value)},flow_green(){if(d())return f(s.value)},flow_circulate(){if(d()){const{approvalFormData:u,circulateId:y}=e;return _({id:y==null?void 0:y.value,comment:u==null?void 0:u.value.comment})}}}}function Al(e){const t=N({});return J(async()=>{var p;const{formProperty:l}=((p=k(e))==null?void 0:p.properties)||{};l!=null&&l.length&&(await _e(),Object.keys(t.value).forEach(n=>{var o,r,f,_;const a=((o=t.value[n])==null?void 0:o.label)||"",c=l==null?void 0:l.find(s=>s.prop===n);if(t.value[n].display=c==null?void 0:c.display,t.value[n].disabled=c==null?void 0:c.disabled,t.value[n].detail=c==null?void 0:c.detail,t.value[n].readonly=c==null?void 0:c.readonly,t.value[n].rules=t.value[n].rules??[],c!=null&&c.required&&((r=t.value[n].rules)!=null&&r.some(s=>s.required)))return null;c!=null&&c.required?(f=t.value[n].rules)==null||f.push({required:!0,message:`${a}ä¸ºå¿…å¡«é¡¹`}):t.value[n].rules=(_=t.value[n].rules)==null?void 0:_.filter(s=>!s.required)}))}),t}function Kl(){return{modelValue:{type:Object,default:()=>({})},title:{type:String},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"formTab"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean},circulateId:{type:String}}}function Ml(){return{complete:e=>e}}const kt=Symbol("flowFormState");function Bl(e,t){const l=fe(e,void 0,{passive:!0,deep:!0}),{flowDetail:p,modelValue:n,formLoading:a}=l,{getFlowDetail:c}=Le(),{tabs:o}=z(),r=U(()=>(o==null?void 0:o.filter(u=>{var w,i,v;const y=(v=(i=(w=p.value)==null?void 0:w.properties)==null?void 0:i.formProperty)==null?void 0:v.find(m=>m.prop===u.prop);return(y==null?void 0:y.display)!==!1}))??[]);J(()=>{const{flowKey:u,taskId:y,instanceId:w}=e;!u&&!y&&!w||(a.value=!0,c({flowKey:u,taskId:y,flowInstanceId:w}).then(i=>{p.value=i.data,n.value=i.data.formData||{}}).finally(()=>{a.value=!1}))});const f=N(!1),_=U(()=>Object.entries(n.value||{}).filter(([u])=>!u.startsWith("$")).map(([u,y])=>({key:u,value:y}))),s=N(),d={...l,formData:n,formVariables:_,approvalVisible:f,tabList:r,fileIds:s,emit:t};return Mt(kt,d),d}function ce(){return Me(kt)}const jl=A({__name:"button-list",emits:["click"],setup(e,{emit:t}){const{flowDetail:l,circulateId:p}=ce(),{data:n}=Qe().useList(),{userInfo:a}=z();function c(r,f){return r.map(_=>{const s=f.find(u=>u.buttonKey===_.buttonKey);return{..._,...ol(s,["display","approval"])}})}const o=U(()=>{var m,h,D,O,F,I;if(p!=null&&p.value){const R=(m=n.value)==null?void 0:m.find(S=>S.buttonKey==="flow_circulate");return R?[R]:[]}const r=typeof a=="function"?a():a,{assignee:f,status:_}=((h=l.value)==null?void 0:h.task)||{},{createUser:s,flowInstanceId:d,status:u}=((D=l.value)==null?void 0:D.flowInstance)||{},y={true:!0,false:!1,startUser:s==(r==null?void 0:r.userId),assignee:f==(r==null?void 0:r.userId),todo:_==2,done:_==1,notstarted:!d,started:!!d,finished:u===1,unfinished:u===2},w=((O=n.value)==null?void 0:O.filter(R=>R.buttonKey!=="flow_circulate"))??[],{button:i}=((F=l.value)==null?void 0:F.properties)||{};return((I=c(w,i??[]))==null?void 0:I.filter(R=>{var S,V;return(V=(S=R.display)==null?void 0:S.split(","))==null?void 0:V.every(x=>y[x])}))??[]});return(r,f)=>{const _=C("el-button");return T(!0),E(W,null,X(o.value,s=>(T(),$(_,{key:s.buttonKey,type:s.buttonType,onClick:d=>t("click",s)},{default:b(()=>[g(k(se),{icon:s.icon},null,8,["icon"]),P(" "+j(s.name),1)]),_:2},1032,["type","onClick"]))),128)}}});function ze(e){return new Promise((t,l)=>{k(e).validate((n,a,c)=>{n?(a(),t(c)):l(c)})})}const Hl=A({__name:"common-comments",props:{modelValue:{}},setup(e){const t=e,{modelValue:l}=fe(t),{batchUpdate:p,create:n,remove:a,useList:c}=io(),o=N(!1),{activeBtn:r}=ce(),f=U(()=>{var h;return(h=r.value)==null?void 0:h.buttonKey}),{data:_,refresh:s}=c(f),d=U(()=>{var D,O,F;const h=l.value;if(h&&!((D=_.value)!=null&&D.some(I=>I.content===h))){const I=(((F=(O=_.value)==null?void 0:O[0])==null?void 0:F.sort)||1)-1;return[{content:h,sort:I},..._.value||[]]}return _.value});async function u(h){var D;await n({...h,type:(D=r.value)==null?void 0:D.buttonKey}),Q.success("æ·»åŠ æˆåŠŸ"),s()}async function y(h){await a(h.id),Q.success("åˆ é™¤æˆåŠŸ"),s()}async function w(h,D){let O=D.parent.data;O=O.map((F,I)=>({id:F.id,sort:I+1})),await p(O),Q.success("ä¿®æ”¹æ’åºæˆåŠŸ"),s(),o.value=!1}function i(){o.value=!0}const v=N();async function m(h){var D;l.value=h.content??"",await _e(),(D=v.value)==null||D.blur()}return(h,D)=>{const O=C("el-input"),F=C("el-text"),I=C("el-col"),R=C("el-button"),S=C("el-row"),V=C("el-tree"),x=C("el-popover");return T(),$(x,{visible:o.value,placement:"bottom",title:"å¸¸ç”¨æ„è§",width:600},{reference:b(()=>[g(O,{ref_key:"inputRef",ref:v,modelValue:k(l),"onUpdate:modelValue":D[0]||(D[0]=L=>ee(l)?l.value=L:null),type:"textarea",placeholder:"è¯·è¾“å…¥æ„è§",rows:"5",onFocus:D[1]||(D[1]=L=>o.value=!0),onBlur:D[2]||(D[2]=L=>o.value=!1)},null,8,["modelValue"])]),default:b(()=>[g(V,{data:d.value,"node-key":"content",draggable:"","allow-drop":(L,K,H)=>H!=="inner",props:{label:"content"},onNodeClick:m,onNodeDrop:w,onNodeDragStart:i},{default:b(({data:L})=>[g(S,{style:{width:"600px"}},{default:b(()=>[g(I,{span:22},{default:b(()=>[g(F,{truncated:"",title:L.content},{default:b(()=>[P(j(L.content),1)]),_:2},1032,["title"])]),_:2},1024),g(I,{span:2},{default:b(()=>[L.id?(T(),$(R,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:tt(K=>y(L),["stop"])},null,8,["onClick"])):(T(),$(R,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:tt(K=>u(L),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),zl=A({__name:"approval-tree",props:{modelValue:{},data:{},autoCheck:{type:Boolean}},setup(e){const t=e,{modelValue:l}=fe(t),p=N(),n={class(s){return`node-${s.type}`}},a=U(()=>pt(t.data??[],(s,d,u)=>{const y=ut();return s.taskNodeKey=(u==null?void 0:u.taskNodeKey)??s.taskNodeKey,s.incoming=(u==null?void 0:u.incoming)??s.incoming,s.multiple=(u==null?void 0:u.multiple)??s.multiple,{...s,id:y,label:s.title,disabled:s.type!=="user"}})),c={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"};xe(()=>[a.value,p.value],async()=>{if(!p.value||!a.value.length)return;if(t.autoCheck){const d=o(a.value);d&&_([d])}ft(a.value,d=>{var u;return!!((u=d.children)!=null&&u.length)}).map(async d=>{var y;await Et(100);const u=(y=p.value)==null?void 0:y.getNode(d);u==null||u.expand()})},{immediate:!0,debounce:100});function o(s){var d;if(s.length===1)return(d=s[0].children)!=null&&d.length?o(s[0].children):s[0]}async function r(s,{checkedNodes:d}){var w;let u=d.filter(i=>i.type==="user");const y=u.some(i=>i.id===s.id);if(a.value.every(i=>!i.multiple)&&y)u=[s];else if(!s.multiple&&y){const m=((w=p.value)==null?void 0:w.getNode(s)).parent.data.children.filter(h=>h.id!==s.id);u=vt(u,m,"id")}_(u)}function f(s){const d=l.value.filter(u=>u.id!==s.id);_(d)}function _(s){var d;l.value=s,(d=p.value)==null||d.setCheckedNodes(s)}return(s,d)=>{const u=C("el-tag"),y=C("Icon"),w=C("el-tree");return T(),E(W,null,[(T(!0),E(W,null,X(k(l),i=>(T(),$(u,{key:i.id,type:"info",closable:"",onClose:v=>f(i)},{default:b(()=>[P(j(i.title),1)]),_:2},1032,["onClose"]))),128)),g(w,{ref_key:"treeRef",ref:p,class:"approval-tree",data:a.value,props:n,"node-key":"id","check-on-click-node":"","show-checkbox":"",onCheck:r},{default:b(({data:i})=>[q("div",null,[g(y,{icon:c[i.type]||c.element,style:{display:"inline-block"}},null,8,["icon"]),q("span",null,j(i.title),1)])]),_:1},8,["data"])],64)}}});const ot=Te(zl,[["__scopeId","data-v-f1318efd"]]),at=A({__name:"assignee-setter",props:{modelValue:{},tableData:{}},emits:["update:modelValue"],setup(e,{emit:t}){const l=e,p=U({get(){return typeof l.modelValue=="string"?l.modelValue?l.modelValue.split(","):[]:l.modelValue},set(s){var d;t("update:modelValue",s.join(",")),(d=l.tableData)!=null&&d.row&&(l.tableData.row.idVal=ft(o.value,u=>s==null?void 0:s.includes(u.id)).map(u=>u[`${c.value}Id`]).join(","))}}),n=U({get(){return Array.isArray(l.modelValue)?l.modelValue.join(","):l.modelValue},set(s){t("update:modelValue",s)}}),a=N(!1),c=U(()=>{var s,d;return(d=(s=l.tableData)==null?void 0:s.row)==null?void 0:d.type}),o=N([]),r=N([]),{getUserTree:f}=mo(),{getParam:_}=me();return pe(c,s=>{["dept","post","user"].includes(s)?(a.value=!0,f(s==="user"?"":s).then(d=>{o.value=pt(d.data,u=>({...u,label:u.title,value:u.id,disabled:s==="user"?u.type!=="user":!1}))}).finally(()=>a.value=!1)):c.value==="dynamic"&&(a.value=!0,_("flow.trends.user").then(d=>{r.value=d.data}).finally(()=>a.value=!1))},{immediate:!0}),(s,d)=>{const u=C("el-tree-select"),y=C("el-input");return["dept","post","user"].includes(c.value)?(T(),$(u,{key:0,modelValue:p.value,"onUpdate:modelValue":d[0]||(d[0]=w=>p.value=w),data:o.value,loading:a.value,"expand-on-click-node":!1,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"",clearable:"",style:{width:"100%"}},null,8,["modelValue","data","loading"])):c.value==="dynamic"?(T(),$(u,{key:1,modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=w=>n.value=w),data:r.value,loading:a.value,clearable:"",style:{width:"100%"}},null,8,["modelValue","data","loading"])):c.value==="userTask"?(T(),$(k(Qt),{key:2,modelValue:n.value,"onUpdate:modelValue":d[2]||(d[2]=w=>n.value=w),"filter-type":"userTask"},null,8,["modelValue"])):(T(),$(y,{key:3,modelValue:n.value,"onUpdate:modelValue":d[3]||(d[3]=w=>n.value=w)},null,8,["modelValue"]))}}}),Wl={key:0,class:"flow-viewer"},Yl={key:0,class:"flow-status-legend"},ql=A({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{},showLegend:{type:Boolean}},emits:["update:modelValue","nodeClick"],setup(e,{emit:t}){const l=e,{FlowDesign:p,tabs:n}=z(),a=he();tl(a,()=>{var i;(i=a.value)==null||i.on("node:click",v=>t("nodeClick",v))});const c=U({get(){let i=Gt();return typeof l.modelValue=="string"&&l.modelValue?i=JSON.parse(l.modelValue):typeof l.modelValue=="object"&&Object.keys(l.modelValue)&&(i=l.modelValue),i},set(i){t("update:modelValue",JSON.stringify(i))}}),o=U(()=>{const{column:i=[],group:v=[]}=JSON.parse(l.flowFormOption||"{}");return[...i,...v.map(h=>h.column??[]).flat()]}),{data:r}=Qe().useList(),f=U(()=>(n==null?void 0:n.map(i=>({...i,display:!0})))??[]),_=U(()=>{var i;return{formPropertyList:[...o.value,...f.value],buttonList:(i=r.value)==null?void 0:i.filter(v=>v.status===1),fieldsDic:o.value.map(v=>({label:v.label,value:`\${${v.prop}}`,desc:`\${${v.prop}}`})),flowButtonDisplayDic:ne(Ye),flowButtonApprovalDic:ne(qe)}}),s=N({}),d=N({});xe(d,i=>{var v,m,h,D,O,F;i&&((h=(m=(v=i.assignee)==null?void 0:v.children)==null?void 0:m.column)!=null&&h[1]&&(i.assignee.children.column[1].component=at),(F=(O=(D=i.circulate)==null?void 0:D.children)==null?void 0:O.column)!=null&&F[1]&&(i.circulate.children.column[1].component=at))},{debounce:1});const{data:u}=me().useParam("flow.task.status"),y=U(()=>{var i;return(i=l.flowHistory)==null?void 0:i.map(v=>{var h,D;const m=(D=(h=u.value)==null?void 0:h.find(O=>O.value===v.status))==null?void 0:D.style;return{id:v.taskNodeKey,style:m}})}),w=U(()=>{var i,v;return(v=(i=l.flowHistory)==null?void 0:i.filter(m=>m.taskNodeType==="userTask"))==null?void 0:v.map(m=>{var h;return{id:m.taskNodeKey,content:`<div>${m.assigneeName}</div>
        <div>${m.endTime??""}</div>
        <div>${((h=m.comment)==null?void 0:h.handleComment)??""}</div>`}})});return(i,v)=>i.view?(T(),E("div",Wl,[i.showLegend!==!1?(T(),E("div",Yl,[(T(!0),E(W,null,X(k(u),m=>{var h;return T(),E("div",{key:m.label,class:"legend-item"},[q("div",{class:"legend-color",style:Bt({backgroundColor:(h=m.style)==null?void 0:h.fill})},null,4),q("span",null,j(m.label),1)])}),128))])):B("",!0),g(k(p),{lf:a.value,"onUpdate:lf":v[0]||(v[0]=m=>a.value=m),"model-value":c.value,styles:y.value,tooltips:w.value,type:"viewer"},null,8,["lf","model-value","styles","tooltips"])])):(T(),$(k(p),{key:1,modelValue:c.value,"onUpdate:modelValue":v[1]||(v[1]=m=>c.value=m),formData:s.value,"onUpdate:formData":v[2]||(v[2]=m=>s.value=m),formDefaults:d.value,"onUpdate:formDefaults":v[3]||(v[3]=m=>d.value=m),"form-options":k(Jt),"data-options":_.value,"form-width":"30%"},null,8,["modelValue","formData","formDefaults","form-options","data-options"]))}});const we=Te(ql,[["__scopeId","data-v-0b8d2722"]]),Ql=A({__name:"node-select",props:{modelValue:{}},setup(e){const t=e,{modelValue:l}=fe(t),{flowDetail:p}=ce(),n=N(!1);function a({data:c}){c.type==="userTask"&&(n.value=!1,l.value=c.id)}return(c,o)=>{const r=C("el-button"),f=C("el-popover");return T(),$(f,{visible:n.value,"onUpdate:visible":o[0]||(o[0]=_=>n.value=_),placement:"bottom-start",width:"800px",trigger:"click"},{reference:b(()=>[g(r,null,{default:b(()=>[P(" ç‚¹å‡»é€‰æ‹©èŠ‚ç‚¹ ")]),_:1})]),default:b(()=>{var _,s;return[g(we,{"model-value":(s=(_=k(p))==null?void 0:_.process)==null?void 0:s.flowData,view:"",style:{height:"600px"},onNodeClick:a},null,8,["model-value"])]}),_:1},8,["visible"])}}}),Gl=A({__name:"approval-form",emits:["confirm"],setup(e,{emit:t}){const{getApprovalNode:l}=Le(),{useParam:p}=me(),{formData:n,approvalFormData:a,activeBtn:c,approvalVisible:o,formVariables:r,flowDetail:f}=ce(),_=N([]),s=N([]),d=N([]),u=N([]),y=N(!1),w=N(!1),i=N(),v=N(),m={menuBtn:!1,labelWidth:100,column:[{label:"æŒ‡å®šèŠ‚ç‚¹",prop:"jumpTaskNodeKey",span:24,rules:[{required:!0,message:"è¯·é€‰æ‹©æŒ‡å®šèŠ‚ç‚¹"}]},{label:"å®¡æ‰¹äºº",prop:"assignee",span:24,rules:[{required:!0,validator:h}]},{label:"ä¼ é˜…äºº",prop:"circulate",span:24},{label:"æ„è§",prop:"comment",span:24,rules:[{required:!0,message:"è¯·å¡«å†™æ„è§"}]}]};function h(V,x,L){var G,M,ye;const K=((G=_.value[0])==null?void 0:G.type)==="parallelGateway",H=(ye=(M=_.value[0])==null?void 0:M.children)==null?void 0:ye.every(Ne=>Xt([Ne],re=>s.value.some(Ie=>Ie.id===re.id)));if(s.value.length){if(K&&!H)return L("è¯·åœ¨æ¯ä¸ªèŠ‚ç‚¹é€‰æ‹©å®¡æ‰¹äºº")}else return L("è¯·é€‰æ‹©å®¡æ‰¹äºº");return!0}const{data:D}=p("flow.default.comment"),{data:O}=p("flow.approval.autocheck");J(async()=>{var x;if(!o.value||!i.value||!v.value)return;F();const{taskId:V}=((x=f.value)==null?void 0:x.task)||{};_e(()=>{i.value.resetFields(),a.value.comment=n.value.comment||(V?"":D.value),v.value.jumpTaskNodeKey.display=I("specifyNode"),v.value.assignee.display=I("assignee"),v.value.circulate.display=I("circulate"),v.value.comment.display=I("comment")})}),J(async()=>{var L,K;if(!o.value||!I("assignee")||I("specifyNode")&&!a.value.jumpTaskNodeKey)return;F();const{flowKey:V}=((L=f.value)==null?void 0:L.process)||{},{taskId:x}=((K=f.value)==null?void 0:K.task)||{};try{w.value=!0;const H=await l({flowKey:V,taskId:x,variables:r.value,buttonType:c.value.buttonKey,jumpTaskNodeKey:a.value.jumpTaskNodeKey});_.value=H.data.approvalNodeList,d.value=H.data.circulateNodeList}finally{w.value=!1}});function F(){_.value=[],s.value=[],d.value=[],u.value=[]}function I(V){var x,L;return(L=(x=c.value)==null?void 0:x.approval)==null?void 0:L.includes(V)}async function R(){await ze(i),y.value=!0;const{data:V,outgoing:x}=S(s.value),{data:L}=S(u.value);a.value.assignee=V,a.value.outgoing=[...x],a.value.circulate=L,console.log("ğŸš€ ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",n),t("confirm")}function S(V){const x={},L={},K=new Set;return V.forEach(H=>{const{taskNodeKey:G,incoming:M}=H;x[G]||(x[G]=new Set),H.userId&&x[G].add(H.userId),L[G]=[...x[G]].join(","),M&&K.add(M)}),{set:x,data:L,outgoing:K}}return(V,x)=>{const L=C("el-skeleton"),K=C("avue-form"),H=C("el-button"),G=C("el-dialog");return T(),$(G,{modelValue:k(o),"onUpdate:modelValue":x[7]||(x[7]=M=>ee(o)?o.value=M:null),class:"approlval-form",title:k(c).name,width:"900px","append-to-body":""},{footer:b(()=>[g(H,{onClick:x[6]||(x[6]=M=>o.value=!1)},{default:b(()=>[P(" å– æ¶ˆ ")]),_:1}),g(H,{type:"primary",onClick:R},{default:b(()=>[P(" ç¡® å®š ")]),_:1})]),default:b(()=>[g(K,{ref_key:"formRef",ref:i,modelValue:k(a),"onUpdate:modelValue":x[4]||(x[4]=M=>ee(a)?a.value=M:null),defaults:v.value,"onUpdate:defaults":x[5]||(x[5]=M=>v.value=M),option:m},{jumpTaskNodeKey:b(()=>[g(Ql,{modelValue:k(a).jumpTaskNodeKey,"onUpdate:modelValue":x[0]||(x[0]=M=>k(a).jumpTaskNodeKey=M)},null,8,["modelValue"])]),assignee:b(()=>[w.value?(T(),$(L,{key:0})):(T(),$(ot,{key:"AssigneeTree",modelValue:s.value,"onUpdate:modelValue":x[1]||(x[1]=M=>s.value=M),data:_.value,"auto-check":k(O)==="true"},null,8,["modelValue","data","auto-check"]))]),circulate:b(()=>[w.value?(T(),$(L,{key:0})):(T(),$(ot,{key:"CirculateTree",modelValue:u.value,"onUpdate:modelValue":x[2]||(x[2]=M=>u.value=M),data:d.value},null,8,["modelValue","data"]))]),comment:b(()=>[g(Hl,{modelValue:k(a).comment,"onUpdate:modelValue":x[3]||(x[3]=M=>k(a).comment=M)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["modelValue","title"])}}}),Jl={class:"flow-form__title"},We=A({__name:"index",props:Kl(),emits:Ml(),setup(e,{emit:t}){const l=e,p=Bl(l,t),{flowDetail:n,tabList:a,activeTab:c,activeBtn:o,formLoading:r,approvalVisible:f,submitLoading:_}=p,s=N();async function d(w){var i,v;o.value=w,await((i=s.value)==null?void 0:i.validate()),await((v=l.beforeClick)==null?void 0:v.call(l,w)),(w==null?void 0:w.approval)!=="false"?f.value=!0:y()}const u=El(p);async function y(){var w,i;try{const{buttonKey:v}=o.value;_.value=!0,await((w=l.beforeSubmit)==null?void 0:w.call(l,o.value));const m=(i=u[v])==null?void 0:i.call(u);m instanceof Promise?(await m,Q.success("æ“ä½œæˆåŠŸ"),f.value=!1,t("complete",o.value)):Q.error("æ“ä½œå¤±è´¥")}finally{_.value=!1}}return(w,i)=>{const v=C("el-skeleton"),m=C("el-main"),h=C("el-header"),D=C("el-tab-pane"),O=C("el-tabs"),F=C("el-container");return k(r)?(T(),$(m,{key:0},{default:b(()=>[g(v)]),_:1})):(T(),$(F,{key:1,class:"flow-form"},{default:b(()=>[g(h,{class:"flow-form__header",height:"auto"},{default:b(()=>{var I;return[q("div",Jl,j(l.title??((I=k(n).flowInstance)==null?void 0:I.title)),1),w.detail?B("",!0):(T(),$(jl,{key:0,onClick:d})),jt(w.$slots,"button")]}),_:3}),g(m,{class:"flow-form__main"},{default:b(()=>[g(O,{modelValue:k(c),"onUpdate:modelValue":i[0]||(i[0]=I=>ee(c)?c.value=I:null)},{default:b(()=>[(T(!0),E(W,null,X(k(a),I=>(T(),$(D,{key:I.prop,label:I.label,name:I.prop,lazy:""},{default:b(()=>[I.prop==="formTab"?(T(),$(lt(w.$slots.default??I.component),{key:0,ref_for:!0,ref:R=>s.value=R},null,512)):(T(),$(lt(I.component),{key:1}))]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1}),g(Gl,{onConfirm:y})]),_:3}))}}});function Ct(e,t){switch(t.type){case"window":return Xl(e,t);case"dialog":case"drawer":return Zl(e,t);default:return{open:l=>{},close:()=>{}}}}function Xl(e,t){const{window:[l="",p="flow-form",n="left=0,top=0,width=1600,height=900"]=[]}=t,a=N(null),c=U(()=>`${l}?${At(rl(e,ul(nl,sl)))}`);return{open:f=>{var _;a.value=window.open(c.value,p,n),(_=a.value)==null||_.addEventListener("message",s=>{const{event:d}=s.data,u={...k(e),...k(f)}[d];typeof u=="function"&&u(s.data)})},close:()=>{var f;return(f=a.value)==null?void 0:f.close()},openedWindow:a}}function Zl(e,t){const{appContext:l}=it();let p,n;const a=o=>{p=document.createElement("div"),p.className="flow-form-wrapper";const r=eo(t.formPath),f=Ue(r,{...k(e),...k(o)});n=Ue(t.type==="dialog"?il:cl,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:c,...t.overlay},f),n.appContext=l,zt(n,p),document.body.appendChild(p)},c=()=>{var o,r;(r=(o=n==null?void 0:n.component)==null?void 0:o.props)!=null&&r.modelValue&&(n.component.props.modelValue=!1),p&&document.body.removeChild(p),p=null};return{open:a,close:c}}function eo(e){return e?Ht(()=>Wt(()=>import(e),[])):We}const to=A({setup(){const{flowDetail:e,formData:t,detail:l}=ce(),p=Al(e.value),{proxy:n}=it(),a=N({});J(()=>{const{formOption:r}=e.value.process??{};a.value=mt.bind(n)(r||'{"menuBtn":false}'),a.value.detail=!!l.value});const c=N();function o(){return ze(c)}return{form:t,option:a,defaults:p,formRef:c,validate:o}},render(){return Ue(C("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),lo=A({__name:"upload-table",setup(e){const{flowDetail:t,fileIds:l}=ce(),{upload:{action:p,headers:n,preview:a,download:c,props:o}={}}=z(),r=typeof n=="function"?n():n,f=U(()=>{var m,h;return((h=(m=t.value)==null?void 0:m.task)==null?void 0:h.flowInstanceId)??ut()}),_={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"æ–‡ä»¶å",prop:"fileName"},{label:"æ–‡ä»¶ç±»å‹",prop:"fileType"},{label:"æ–‡ä»¶å¤§å°",prop:"fileSize"},{label:"ç‰ˆæœ¬",prop:"version"},{label:"ä¸Šä¼ æ—¶é—´",prop:"createTime"}]},{bindVal:s,getDataList:d,handleDel:u,handleSave:y,afterGetList:w,crudStateRefs:{tableData:i}}=Z({crudOption:{...po(),saveSuccessMsg:"ä¸Šä¼ æˆåŠŸ"},tableOption:_,queryForm:{isLatest:1,flowInstanceId:f.value}});w(()=>{l.value=i.value.map(m=>m.id).join(",")}),d();async function v(m,h){var V,x;const{fileName:D,fileType:O,fileSize:F,fileUrl:I,res:R}=o,S={fileName:ge({res:m},`${R}.${D}`),fileType:ge({res:m},`${R}.${O}`),fileSize:ge({res:m},`${R}.${F}`),fileUrl:ge({res:m},`${R}.${I}`),taskId:(x=(V=t.value)==null?void 0:V.task)==null?void 0:x.taskId,flowInstanceId:f.value,rootMark:(h==null?void 0:h.rootMark)||"",version:typeof(h==null?void 0:h.version)=="number"?h.version+1:1};await y(S,d,()=>{})}return(m,h)=>{const D=C("el-button"),O=C("el-upload"),F=C("avue-crud");return T(),$(F,le(oe(k(s))),{"menu-left":b(()=>[g(O,{action:k(p),headers:k(r),"show-file-list":!1,onSuccess:h[0]||(h[0]=I=>v(I))},{default:b(()=>[g(D,{type:"primary",icon:"el-icon-upload"},{default:b(()=>[P(" ç‚¹å‡»ä¸Šä¼  ")]),_:1})]),_:1},8,["action","headers"])]),menu:b(({row:I,index:R})=>[g(D,{type:"primary",text:"",icon:"el-icon-view",onClick:S=>{var V;return(V=k(a))==null?void 0:V(I,k(i))}},{default:b(()=>[P(" é¢„è§ˆ ")]),_:2},1032,["onClick"]),g(D,{type:"primary",text:"",icon:"el-icon-download",onClick:S=>{var V;return(V=k(c))==null?void 0:V(I,k(i))}},{default:b(()=>[P(" ä¸‹è½½ ")]),_:2},1032,["onClick"]),g(O,{action:k(p),headers:k(r),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:S=>v(S,I)},{default:b(()=>[g(D,{type:"primary",text:"",icon:"el-icon-upload"},{default:b(()=>[P(" æ›´æ–°ç‰ˆæœ¬ ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),g(D,{type:"primary",text:"",icon:"el-icon-delete",onClick:S=>k(u)(I,R)},{default:b(()=>[P(" åˆ é™¤ ")]),_:2},1032,["onClick"])]),_:1},16)}}}),oo={class:"flow-track"},ao={key:0},no={key:1},so=A({__name:"flow-track",setup(e){const{flowDetail:t}=ce(),l=N("table"),p=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],n=U(()=>{var r,f,_;return((_=(f=(r=t.value)==null?void 0:r.flowHistory)==null?void 0:f.filter(s=>s.taskNodeType==="userTask"))==null?void 0:_.map(s=>({...s,duration:Kt(s.duration)})))??[]}),a={addBtn:!1,menu:!1,border:!0,column:[{label:"èŠ‚ç‚¹åç§°",prop:"taskNodeName"},{label:"å¤„ç†äºº",prop:"assigneeName"},{label:"æ¥æ”¶æ—¶é—´",prop:"startTime"},{label:"å¤„ç†æ—¶é—´",prop:"endTime"},{label:"åŠç†æ—¶é•¿",prop:"duration"},{label:"æ“ä½œç±»å‹",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"åŠç†æ„è§",prop:"comment",bind:"comment.handleComment"}]},{data:c}=me().useParam("flow.handle.type");function o(r){var f;return(f=c.value)==null?void 0:f.find(_=>_.value===r)}return(r,f)=>{var v,m,h;const _=C("el-radio-button"),s=C("el-radio-group"),d=C("avue-crud"),u=C("el-card"),y=C("el-timeline-item"),w=C("el-timeline"),i=C("el-empty");return T(),E(W,null,[g(s,{modelValue:l.value,"onUpdate:modelValue":f[0]||(f[0]=D=>l.value=D)},{default:b(()=>[(T(),E(W,null,X(p,D=>g(_,{key:D.label,label:D.label},{default:b(()=>[g(k(se),{icon:D.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),q("div",oo,[l.value==="table"?(T(),$(d,{key:0,data:n.value,option:a},null,8,["data"])):B("",!0),l.value==="graph"?(T(),$(we,{key:1,"model-value":(m=(v=k(t))==null?void 0:v.process)==null?void 0:m.flowData,"flow-history":(h=k(t))==null?void 0:h.flowHistory,view:"","show-legend":""},null,8,["model-value","flow-history"])):B("",!0),l.value==="timeline"?(T(),E(W,{key:2},[n.value.length?(T(),$(w,{key:0},{default:b(()=>[(T(!0),E(W,null,X([...n.value].reverse(),D=>(T(),$(y,{key:D.id,timestamp:D.endTime,placement:"top"},{default:b(()=>[g(u,null,{default:b(()=>{var O,F,I;return[q("div",null,j(D.assigneeName)+" å¼€å§‹å¤„ç† ["+j(D.taskNodeName)+"] ç¯èŠ‚ ",1),D.duration?(T(),E("div",ao," åŠç†æ—¶é•¿ï¼š"+j(D.duration),1)):B("",!0),D.type&&((O=D.comment)!=null&&O.handleComment)?(T(),E("div",no,j((F=o(D.type))==null?void 0:F.label)+"æ„è§ï¼š"+j((I=D.comment)==null?void 0:I.handleComment),1)):B("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(T(),$(i,{key:1}))],64)):B("",!0)])],64)}}});const ro=Te(so,[["__scopeId","data-v-0411478e"]]),nt=Symbol("flowPagesConfig"),uo={FlowDesign:{},FormDesign:{},FlowForm:We,tabs:[{label:"å®¡æ‰¹è¡¨å•",prop:"formTab",component:to},{label:"é™„ä»¶èµ„æ–™",prop:"fileTab",component:lo},{label:"æµç¨‹è·Ÿè¸ª",prop:"trackTab",component:ro}],request:()=>{},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}};var Vt=(e=>(e[e.å¦=0]="å¦",e[e.æ˜¯=1]="æ˜¯",e))(Vt||{});const Ae=ne(Vt);function z(e,t){return e&&t?(e.provide(nt,al(uo,t)),t):Me(nt)}function io(){const{request:e}=z(),t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},l=r=>e.get(t.list,{params:{type:r,ascs:"sort"}});return{url:t,getList:l,useList:r=>ie(()=>l(r.value).then(f=>f.data.records),{refreshDeps:[r]}),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),batchUpdate:r=>e.post(t.batchUpdate,r)}}var Dt=(e=>(e.é»˜è®¤="default",e.ä¸»è¦="primary",e.æˆåŠŸ="success",e.è­¦å‘Š="warning",e.å±é™©="danger",e.ä¿¡æ¯="info",e.æ–‡å­—="text",e))(Dt||{}),Ye=(e=>(e.æ˜¾ç¤º="true",e.éšè—="false",e.å‘èµ·äºº="startUser",e.å¤„ç†äºº="assignee",e.å·²åŠ="done",e.å¾…åŠ="todo",e.æœªå‘èµ·="notstarted",e.å·²å‘èµ·="started",e.æœªåŠç»“="unfinished",e.å·²åŠç»“="finished",e))(Ye||{}),qe=(e=>(e.ä¸æ˜¾ç¤º="false",e.æŒ‡å®šèŠ‚ç‚¹="specifyNode",e.å®¡æ‰¹äºº="assignee",e.ä¼ é˜…äºº="circulate",e.æ„è§="comment",e))(qe||{}),Tt=(e=>(e[e.ç¦ç”¨=0]="ç¦ç”¨",e[e.æ­£å¸¸=1]="æ­£å¸¸",e))(Tt||{});function Qe(){const{request:e}=z(),t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},l=o=>e.get(t.list,{params:o});return{url:t,getList:l,useList:()=>ie(()=>l({size:-1,ascs:"sort"}).then(o=>o.data.records)),create:o=>e.post(t.save,o),update:o=>e.post(t.update,o),remove:o=>e.post(t.remove,{},{params:{ids:o}})}}function co(){const{request:e}=z(),t={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"};return{getList:o=>e.get(t.list,{params:o}),getTree:o=>e.get(t.tree,{params:o}),create:o=>e.post(t.save,o),update:o=>e.post(t.update,o),remove:o=>e.post(t.remove,{},{params:{ids:o}})}}function xt(){const{request:e}=z(),t={list:"/sapier-flow/flow-circulate/userTaskList",opslist:"/sapier-flow/flow-circulate-ops/list",update:"/sapier-flow/flow-circulate-ops/update",remove:"/sapier-flow/flow-circulate-ops/remove"};return{url:t,getCirculateList:c=>e.get(t.list,{params:c}),getCirculateOpsList:c=>e.get(t.list,{params:c}),updateCirculate:c=>e.post(t.update,c),removeCirculate:c=>e.post(t.remove,{},{params:{ids:c}})}}function Ge(){const{request:e}=z(),t={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"};return{url:t,getList:r=>e.get(t.list,{params:r}),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),deploy:r=>e.post(t.deploy,r),getDetail:r=>e.get(t.detail,{params:r})}}var Lt=(e=>(e[e.å¦=0]="å¦",e[e.æ˜¯=1]="æ˜¯",e))(Lt||{});function Je(){const{request:e}=z(),t={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"};return{url:t,getList:c=>e.get(t.list,{params:c}),getDetail:c=>e.get(t.detail,{params:c}),update:c=>e.post(t.update,c),remove:c=>e.post(t.remove,{},{params:{ids:c}})}}function po(){const{request:e}=z(),t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:a=>e.get(t.list,{params:a}),create:a=>e.post(t.save,a),remove:a=>e.post(t.remove,{},{params:{ids:a}})}}function fo(){const{request:e}=z(),t={list:"/sapier-flow/flow-ops/list"};return{url:t,getTaskOpsList:p=>e.get(t.list,{params:p})}}function me(){const{request:e}=z(),t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},l=f=>e.get(t.list,{params:f}),p=()=>e.get(t.all),n=f=>e.get(t.key,{params:{paramKey:f}});return{url:t,getList:l,getAllParam:p,getParam:n,useParam:f=>ie(()=>n(f).then(_=>_.data)),create:f=>e.post(t.save,f),update:f=>e.post(t.update,f),remove:f=>e.post(t.remove,{},{params:{ids:f}})}}function Nt(){const{request:e}=z(),t={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},l=o=>e.get(t.list,{params:o});return{url:t,getList:l,useList:()=>ie(()=>l({size:-1}).then(o=>o.data.records)),create:o=>e.post(t.save,o),update:o=>e.post(t.update,o),remove:o=>e.post(t.remove,{},{params:{ids:o}})}}function mo(){const{request:e}=z(),t={tree:"/sapier-flow/flow-user/tree"},l=n=>e.get(t.tree,{params:{filter:n}});return{url:t,getUserTree:l,useUserTree:()=>ie(()=>l().then(n=>n.data))}}function It(){const{request:e}=z(),t={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},l=o=>e.get(t.list,{params:o});return{url:t,getList:l,useList:()=>ie(()=>l({size:-1}).then(o=>o.data.records)),create:o=>e.post(t.save,o),update:o=>e.post(t.update,o),remove:o=>e.post(t.remove,{},{params:{ids:o}})}}var Ot=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Ot||{});function Ke(){const{request:e}=z(),t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy"},l=r=>e.get(t.list,{params:r});return{url:t,getList:l,useList:()=>ie(()=>l({size:-1}).then(r=>r.data.records)),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),deploy:r=>e.post(t.deploy,r)}}const vo={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"æŒ‰é’®åç§°",prop:"name",search:!0},{label:"æŒ‰é’®æ ‡è¯†",prop:"buttonKey",search:!0},{label:"æŒ‰é’®å›¾æ ‡",prop:"icon",component:"icon-select"},{label:"æŒ‰é’®ç±»å‹",prop:"buttonType",type:"select",dicData:ne(Dt)},{label:"é»˜è®¤æ˜¾ç¤ºæ¡ä»¶",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ne(Ye),tip:"é€‰æ‹©å¤šä¸ªæ—¶,æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³æ‰æ˜¾ç¤º",labelTip:`æ˜¾ç¤º: å§‹ç»ˆæ˜¾ç¤º;<br/>éšè—: å§‹ç»ˆéšè—;<br/>
      å‘èµ·äºº: ç”¨æˆ·ä¸ºå‘èµ·äººæ—¶æ˜¾ç¤º;<br/>å¤„ç†äºº: ç”¨æˆ·ä¸ºå¤„ç†äººæ—¶æ˜¾ç¤º;<br/>
      å·²åŠ: ä»»åŠ¡çŠ¶æ€ä¸ºå·²åŠæ—¶æ˜¾ç¤º;<br/>å¾…åŠ: ä»»åŠ¡çŠ¶æ€ä¸ºå¾…åŠæ—¶æ˜¾ç¤º;<br/>
      æœªå‘èµ·: æµç¨‹æœªå‘èµ·æ—¶æ˜¾ç¤º;<br/>å·²å‘èµ·: æµç¨‹å·²å‘èµ·æ—¶æ˜¾ç¤º;<br/>
      æœªåŠç»“: æµç¨‹æœªåŠç»“æ—¶æ˜¾ç¤º;<br/>å·²åŠç»“: æµç¨‹å·²åŠç»“æ—¶æ˜¾ç¤º;`},{label:"é»˜è®¤å®¡æ‰¹çª—å£æ˜¾ç¤º",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ne(qe),labelTip:`ä¸æ˜¾ç¤º: ä¸æ˜¾ç¤ºå®¡æ‰¹çª—å£;<br/>æŒ‡å®šèŠ‚ç‚¹: æ˜¾ç¤ºæŒ‡å®šèŠ‚ç‚¹é€‰æ‹©æ¡†(å¸¸ç”¨äºç»¿è‰²é€šé“ç­‰);<br/>
      å®¡æ‰¹äºº: æ˜¾ç¤ºå®¡æ‰¹äººé€‰æ‹©æ¡†;<br/>ä¼ é˜…äºº: æ˜¾ç¤ºä¼ é˜…äººé€‰æ‹©æ¡†;<br/>æ„è§: æ˜¾ç¤ºæ„è§è¾“å…¥æ¡†;`},{label:"æ’åº",prop:"sort",type:"number",value:0},{label:"çŠ¶æ€",prop:"status",type:"switch",value:1,dicData:ne(Tt)},{label:"æŒ‰é’®é¢„è§ˆ",prop:"buttonPreview",width:150}]},_o=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:l},getDataList:p}=Z({tableOption:vo,crudOption:Qe(),sortOption:{ascs:"sort"}});return p(),(n,a)=>{const c=C("el-button"),o=C("avue-crud");return T(),$(o,le(oe(k(t))),{icon:b(({row:r})=>[g(k(se),{icon:r.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:b(({row:r})=>[g(c,{type:r.buttonType},{default:b(()=>[g(k(se),{icon:r.icon},null,8,["icon"]),P(" "+j(r.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":b(()=>[g(c,{type:k(l).buttonType},{default:b(()=>[g(k(se),{icon:k(l).icon},null,8,["icon"]),P(" "+j(k(l).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Xe={menuBtn:!1,span:24,column:[{label:"æµç¨‹åç§°",prop:"flowName",rules:[{required:!0,message:"è¯·è¾“å…¥æµç¨‹åç§°"}]},{label:"æµç¨‹æ ‡è¯†",prop:"flowKey",rules:[{required:!0,message:"è¯·è¾“å…¥æµç¨‹æ ‡è¯†"}]},{label:"æµç¨‹åˆ†ç±»",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"æµç¨‹å›¾æ ‡",prop:"flowIcon",component:"icon-select"},{label:"æµç¨‹æè¿°",prop:"remarks"},{label:"è‡ªå®šä¹‰è¡¨å•",prop:"formPath"},{label:"å…³è”è¡¨",prop:"formDataTable",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}},{label:"è¡¨å•è®¾è®¡",prop:"formOption",display:!1,hide:!0},{label:"æ¨¡å‹è®¾è®¡",prop:"flowData",display:!1,hide:!0}]},bo={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"æ“ä½œ",column:[...Xe.column.map((e,t)=>({...e,search:t<2})),{label:"æµç¨‹ä¸»ç‰ˆæœ¬",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},$t=A({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(e,{emit:t}){const l=e,{getList:p,deploy:n,remove:a}=Ge(),{bindVal:c,crudStateRefs:{searchForm:o},getDataList:r}=Z({tableOption:bo,crudOption:{getList:p,remove:a},searchForm:{categoryId:l.categoryId}});J(()=>{o.value.categoryId=l.categoryId??"",r()});const f=N(!1);async function _(d){await de.confirm("å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œæ˜¯å¦ç¡®è®¤ï¼Ÿ","æç¤º",{type:"success"}),f.value=!0,n({flowModuleId:d.flowModuleId}).then(()=>{Q.success("å‘å¸ƒæˆåŠŸ"),r()}).finally(()=>{f.value=!1})}async function s(d){if(console.log("ğŸš€ ~ file: index.vue:49 ~ handleDel ~ row:",d),d.mainVersion)return Q.warning("è¯·å…ˆåˆ é™¤å·²å‘å¸ƒçš„æµç¨‹");await de.confirm("ç¡®è®¤åˆ é™¤ï¼Ÿ","æç¤º",{type:"warning"}),await a(d.flowModuleId),Q.success("åˆ é™¤æˆåŠŸ"),r()}return(d,u)=>{const y=C("el-button"),w=C("el-dropdown-item"),i=C("avue-crud");return T(),$(i,le(oe(k(c))),{"menu-left":b(()=>[g(y,{type:"primary",icon:"el-icon-plus",onClick:u[0]||(u[0]=v=>t("add"))},{default:b(()=>[P(" æ–°å¢ ")]),_:1})]),"menu-btn":b(({row:v})=>[g(w,{icon:"el-icon-view",onClick:m=>t("view",v)},{default:b(()=>[P(" æŸ¥çœ‹ ")]),_:2},1032,["onClick"]),g(w,{icon:"el-icon-edit",onClick:m=>t("edit",v)},{default:b(()=>[P(" ç¼–è¾‘ ")]),_:2},1032,["onClick"]),g(w,{icon:"el-icon-delete",onClick:m=>s(v)},{default:b(()=>[P(" åˆ é™¤ ")]),_:2},1032,["onClick"]),g(w,{icon:"el-icon-upload",onClick:m=>_(v)},{default:b(()=>[P(" å‘å¸ƒ ")]),_:2},1032,["onClick"]),g(w,{icon:"el-icon-switch",onClick:m=>t("version",v)},{default:b(()=>[P(" ç‰ˆæœ¬ç®¡ç† ")]),_:2},1032,["onClick"])]),flowIcon:b(({row:v})=>[g(k(se),{icon:v.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),wo={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"æ“ä½œ",column:[...Xe.column,{label:"æµç¨‹ç‰ˆæœ¬",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"æ˜¯å¦ä¸»ç‰ˆæœ¬",prop:"mainVersion",type:"select",dicData:[{label:"å¦",value:0},{label:"æ˜¯",value:1}]}]},St=A({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(e,{emit:t}){const l=e,{getList:p,update:n,remove:a}=Je(),{bindVal:c,crudStateRefs:{searchForm:o},getDataList:r}=Z({tableOption:wo,crudOption:{getList:p,dataPath:"res.data"}});J(()=>{l.flowModuleId&&(o.value.flowModuleId=l.flowModuleId,r())});const f=N(!1);async function _(d){await de.confirm(`ç¡®å®šå°† ${d.flowName}(${d.flowKey}:v${d.version}) è®¾ä¸ºä¸»ç‰ˆæœ¬?`,"æç¤º",{type:"warning"}),f.value=!0,n({flowDeployId:d.flowDeployId,flowModuleId:d.flowModuleId,mainVersion:1}).then(()=>{Q.success("è®¾ç½®æˆåŠŸ"),r()}).finally(()=>{f.value=!1})}async function s(d){const{value:u}=await de.prompt("è¯·è¾“å…¥ç¡®è®¤åˆ é™¤çš„æµç¨‹æ ‡è¯†","æç¤º",{type:"warning"});u===d.flowKey&&(await a(d.flowDeployId),Q.success("åˆ é™¤æˆåŠŸ"),r())}return(d,u)=>{const y=C("el-button"),w=C("el-dropdown-item"),i=C("avue-crud");return T(),$(i,le(oe(k(c))),{"menu-left":b(()=>[g(y,{loading:f.value,type:"primary",icon:"el-icon-arrow-left",onClick:u[0]||(u[0]=v=>t("back"))},{default:b(()=>[P(" è¿”å› ")]),_:1},8,["loading"])]),"menu-btn":b(({row:v})=>[g(w,{icon:"el-icon-view",onClick:m=>t("view",v)},{default:b(()=>[P(" æŸ¥çœ‹ ")]),_:2},1032,["onClick"]),g(w,{icon:"el-icon-edit",onClick:m=>t("edit",v)},{default:b(()=>[P(" ç¼–è¾‘ ")]),_:2},1032,["onClick"]),g(w,{icon:"el-icon-delete",onClick:m=>s(v)},{default:b(()=>[P(" åˆ é™¤ ")]),_:2},1032,["onClick"]),g(w,{icon:"el-icon-switch",disabled:v.mainVersion===k(Lt).æ˜¯,onClick:m=>_(v)},{default:b(()=>[P(" è®¾ä¸ºä¸»ç‰ˆæœ¬ ")]),_:2},1032,["disabled","onClick"])]),flowIcon:b(({row:v})=>[g(k(se),{icon:v.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),st={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"åˆ†ç±»åç§°",prop:"name",rules:[{required:!0,message:"è¯·è¾“å…¥åˆ†ç±»åç§°"}]},{label:"æè¿°",prop:"remark"}]}},yo=A({__name:"index",emits:["node-click"],setup(e,{emit:t}){const{crudStateRefs:{formData:l,tableData:p},getDataList:n,handleSave:a,handleUpdate:c,handleDel:o}=Z({crudOption:{rowKey:"id",...co(),dataPath:"res.data"},tableOption:st,pageOption:{pageSize:20}});n();function r(s,d,u,y){a(d,u,y)}function f(s,d,u,y){c(d,NaN,u,y)}async function _(s,d){await o(s.data,NaN),d()}return(s,d)=>{const u=C("avue-tree");return T(),$(u,{modelValue:k(l),"onUpdate:modelValue":d[0]||(d[0]=y=>ee(l)?l.value=y:null),option:k(st),data:k(p),onNodeClick:d[1]||(d[1]=y=>t("node-click",y)),onSave:r,onUpdate:f,onDel:_},null,8,["modelValue","option","data"])}}}),Ze=A({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(e,{emit:t}){var r;const l=e,{FormDesign:p}=z(),n=U({get(){return l.modelValue?mt(l.modelValue):{menuBtn:!1,span:24}},set(f){t("update:modelValue",Zt(f,{useJson5:!1}))}}),a=U(()=>l.fields?JSON.parse(l.fields):[]),c=U(()=>{const f={type:"select",dicData:a.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...f,props:{label:"name",value:"name",desc:"comment"}},{...f,props:{label:"comment",value:"comment",desc:"name"}}]}),o={form:{settings:Array.from({length:((r=el.settings)==null?void 0:r.length)??0}).fill({}).concat({label:"æ ·å¼ç±»",prop:"class"})}};return(f,_)=>{const s=C("avue-form");return f.view?(T(),$(s,{key:0,class:Yt(n.value.class),"model-value":{},option:n.value},null,8,["class","option"])):(T(),$(k(p),{key:1,modelValue:n.value,"onUpdate:modelValue":_[0]||(_[0]=d=>n.value=d),"base-option":c.value,resources:o},null,8,["modelValue","base-option"]))}}}),go=q("span",null,"æµç¨‹è®¾è®¡",-1),ho={key:0},ko={key:1},Co={style:{height:"calc(100vh - 144px)"}},Vo=A({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(e,{emit:t}){const p=fe(e),{visible:n,modelValue:a}=p,{create:c,deploy:o,getDetail:r,update:f}=Ge(),{getDetail:_,update:s}=Je(),d=["æµç¨‹ä¿¡æ¯","è¡¨å•è®¾è®¡","æ¨¡å‹è®¾è®¡","å®Œæˆ"],u=N(!1);pe(n,async S=>{if(!S)return;const{flowModuleId:V}=a.value,{flowDeployId:x}=a.value;try{u.value=!0;let L={};x?L=await _({flowDeployId:x}):V&&(L=await r({flowModuleId:V})),a.value=L.data}finally{u.value=!1}},{immediate:!0});const{data:y}=It().useList(),{data:w}=Nt().useList(),{data:i}=Ke().useList(),v=U(()=>{var S,V;return(V=(S=i.value)==null?void 0:S.find(x=>x.tableName===a.value.formDataTable))==null?void 0:V.tableFields}),m=N(0),h=U(()=>{var S,V;return m.value===1?((S=y.value)==null?void 0:S.map(x=>({label:x.formName,value:x.formOption})))??[]:m.value===2?((V=w.value)==null?void 0:V.map(x=>({label:x.flowName,value:x.flowData})))??[]:[]});function D(S){m.value===1?a.value.formOption=S.value:m.value===2&&(a.value.flowData=S.value)}const O=N();async function F(S){m.value===0&&await ze(O),u.value=!0;const{flowModuleId:V}=a.value,{flowDeployId:x}=a.value;try{x?await s(a.value):V?await f(a.value):await c(a.value).then(L=>{a.value.flowModuleId=L.data.flowModuleId}),Q.success("ä¿å­˜æˆåŠŸ")}finally{u.value=!1}typeof S=="number"?m.value=S:m.value++}async function I(){await de.confirm("å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œæ˜¯å¦ç¡®è®¤ï¼Ÿ","æç¤º"),u.value=!0,o({flowModuleId:a.value.flowModuleId}).then(()=>{Q.success("å‘å¸ƒæˆåŠŸ")}).finally(()=>{u.value=!1})}function R(){n.value=!1,m.value=0,a.value={},t("close")}return(S,V)=>{const x=C("el-link"),L=C("el-dropdown-item"),K=C("el-scrollbar"),H=C("el-dropdown-menu"),G=C("el-dropdown"),M=C("el-col"),ye=C("el-step"),Ne=C("el-steps"),re=C("el-button"),Ie=C("el-row"),Ft=C("avue-form"),Rt=C("el-result"),Pt=C("el-dialog"),Ut=ct("loading");return T(),$(Pt,{modelValue:k(n),"onUpdate:modelValue":V[5]||(V[5]=Y=>ee(n)?n.value=Y:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:R},{header:b(()=>[g(Ie,{justify:"center"},{default:b(()=>[g(M,{span:5},{default:b(()=>{var Y,ve,Oe,et;return[q("div",null,[go,(Y=k(a))!=null&&Y.flowName?(T(),E("span",ho," - "+j((ve=k(a))==null?void 0:ve.flowName),1)):B("",!0),(Oe=k(a))!=null&&Oe.version?(T(),E("span",ko," - V"+j((et=k(a))==null?void 0:et.version),1)):B("",!0)]),h.value.length?(T(),$(G,{key:0},{dropdown:b(()=>[g(H,null,{default:b(()=>[g(K,{"max-height":"400px"},{default:b(()=>[(T(!0),E(W,null,X(h.value,$e=>(T(),$(L,{key:$e.label,onClick:Qo=>D($e)},{default:b(()=>[P(j($e.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),default:b(()=>[g(x,{icon:"el-icon-arrow-down",underline:!1},{default:b(()=>[P(" é€‰æ‹©æ¨¡æ¿ ")]),_:1})]),_:1})):B("",!0)]}),_:1}),g(M,{span:14},{default:b(()=>[g(Ne,{active:m.value,simple:"","process-status":"finish","finish-status":"success"},{default:b(()=>[(T(),E(W,null,X(d,(Y,ve)=>g(ye,{key:ve,title:Y,onClick:Oe=>F(ve)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),g(M,{span:5,style:{"text-align":"right"}},{default:b(()=>[g(re,{disabled:m.value===0,loading:u.value,type:"primary",onClick:V[0]||(V[0]=Y=>m.value--)},{default:b(()=>[P(" ä¸Šä¸€æ­¥ ")]),_:1},8,["disabled","loading"]),g(re,{disabled:m.value===d.length-1,type:"primary",loading:u.value,onClick:V[1]||(V[1]=Y=>F())},{default:b(()=>[P(" ä¸‹ä¸€æ­¥ ")]),_:1},8,["disabled","loading"]),g(re,{onClick:R},{default:b(()=>[P(" å…³é—­ ")]),_:1})]),_:1})]),_:1})]),default:b(()=>[dt((T(),E("div",Co,[m.value===0?(T(),$(Ft,{key:0,ref_key:"formRef",ref:O,modelValue:k(a),"onUpdate:modelValue":V[2]||(V[2]=Y=>ee(a)?a.value=Y:null),option:k(Xe),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):B("",!0),m.value===1?(T(),$(Ze,{key:1,modelValue:k(a).formOption,"onUpdate:modelValue":V[3]||(V[3]=Y=>k(a).formOption=Y),fields:v.value},null,8,["modelValue","fields"])):B("",!0),m.value===2?(T(),$(we,{key:2,modelValue:k(a).flowData,"onUpdate:modelValue":V[4]||(V[4]=Y=>k(a).flowData=Y),"flow-form-option":k(a).formOption},null,8,["modelValue","flow-form-option"])):B("",!0),m.value===3?(T(),$(Rt,{key:3,icon:"success",title:"æµç¨‹è®¾è®¡å®Œæˆ"},{extra:b(()=>[k(a).flowDeployId?B("",!0):(T(),$(re,{key:0,type:"primary",onClick:I},{default:b(()=>[P(" å‘å¸ƒ ")]),_:1})),g(re,{onClick:R},{default:b(()=>[P(" å…³é—­ ")]),_:1})]),_:1})):B("",!0)])),[[Ut,u.value]])]),_:1},8,["modelValue"])}}}),Do=q("span",null,"æµç¨‹æŸ¥çœ‹",-1),To={key:0},xo={key:1},Lo=A({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(e){const l=fe(e),{visible:p,modelValue:n}=l,{getDetail:a}=Ge(),{getDetail:c}=Je(),o=N("form"),r=N(!1);pe(p,async _=>{if(!_)return;const{flowModuleId:s}=n.value,{flowDeployId:d}=n.value;try{r.value=!0;let u={};d?u=await c({flowDeployId:d}):s&&(u=await a({flowModuleId:s})),n.value={...u.data}}finally{r.value=!1}},{immediate:!0});function f(){n.value={},o.value="form"}return(_,s)=>{const d=C("el-tab-pane"),u=C("el-tabs"),y=C("el-dialog"),w=ct("loading");return T(),$(y,{modelValue:k(p),"onUpdate:modelValue":s[3]||(s[3]=i=>ee(p)?p.value=i:null),width:"60%",top:"0",onClose:f},{header:b(()=>{var i,v,m,h;return[Do,(i=k(n))!=null&&i.flowName?(T(),E("span",To," - "+j((v=k(n))==null?void 0:v.flowName),1)):B("",!0),(m=k(n))!=null&&m.version?(T(),E("span",xo," - V"+j((h=k(n))==null?void 0:h.version),1)):B("",!0)]}),default:b(()=>[dt((T(),$(u,{modelValue:o.value,"onUpdate:modelValue":s[2]||(s[2]=i=>o.value=i)},{default:b(()=>[g(d,{label:"æŸ¥çœ‹è¡¨å•",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:b(()=>[o.value==="form"&&k(n).formOption?(T(),$(Ze,{key:0,modelValue:k(n).formOption,"onUpdate:modelValue":s[0]||(s[0]=i=>k(n).formOption=i),view:""},null,8,["modelValue"])):B("",!0)]),_:1}),g(d,{label:"æŸ¥çœ‹æµç¨‹",name:"flow",style:{height:"600px"}},{default:b(()=>[o.value==="flow"?(T(),$(we,{key:0,modelValue:k(n).flowData,"onUpdate:modelValue":s[1]||(s[1]=i=>k(n).flowData=i),view:""},null,8,["modelValue"])):B("",!0)]),_:1})]),_:1},8,["modelValue"])),[[w,r.value]])]),_:1},8,["modelValue"])}}}),No=A({__name:"index",setup(e){const t=N("definition"),l=N({}),p=N(""),n=N("");function a(y){p.value===y.id?p.value="":p.value=y.id}const c=N(!1),o=N(!1);function r(){l.value={},c.value=!0}function f(y){l.value=y,c.value=!0}function _(y){l.value=y,o.value=!0}function s(y){n.value=y.flowModuleId||"",t.value="deploy"}function d(){n.value="",t.value="definition"}async function u(){const y=t.value;await _e(),t.value="",await _e(),t.value=`${y}`}return(y,w)=>{const i=C("el-col"),v=C("el-row");return T(),$(v,{gutter:20},{default:b(()=>[g(i,{span:4},{default:b(()=>[g(yo,{onNodeClick:a})]),_:1}),g(i,{span:20},{default:b(()=>[t.value==="definition"?(T(),$($t,{key:0,"category-id":p.value,onAdd:r,onEdit:f,onView:_,onVersion:s},null,8,["category-id"])):B("",!0),t.value==="deploy"?(T(),$(St,{key:1,"flow-module-id":n.value,onEdit:f,onView:_,onBack:d},null,8,["flow-module-id"])):B("",!0),g(Vo,{modelValue:l.value,"onUpdate:modelValue":w[0]||(w[0]=m=>l.value=m),visible:c.value,"onUpdate:visible":w[1]||(w[1]=m=>c.value=m),onClose:u},null,8,["modelValue","visible"]),g(Lo,{modelValue:l.value,"onUpdate:modelValue":w[2]||(w[2]=m=>l.value=m),visible:o.value,"onUpdate:visible":w[3]||(w[3]=m=>o.value=m)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),Io=[{label:"æµç¨‹åç§°",prop:"flowName"},{label:"æµç¨‹æ ‡è¯†",prop:"flowKey"},{label:"æµç¨‹åˆ†ç±»",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"æ ‡é¢˜",prop:"processTitle",search:!0},{label:"æµæ°´å·",prop:"serialNumber"},{label:"å½“å‰èŠ‚ç‚¹",prop:"taskNodeName"},{label:"å®¡æ‰¹äºº",prop:"assigneeName"},{label:"ç”³è¯·äºº",prop:"applyUserName"},{label:"æ¥æ”¶æ—¶é—´",prop:"startTime"},{label:"ä»»åŠ¡çŠ¶æ€",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}].map(e=>({...e,display:!1})),Oo=[{label:"å®¡æ‰¹äºº",prop:"assignee"},{label:"èŠ‚ç‚¹åç§°",prop:"taskNodeName"},{label:"æ¥æ”¶æ—¶é—´",prop:"startTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"ç»“æŸæ—¶é—´",prop:"endTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"è€—æ—¶",prop:"duration"},{label:"ä¼ é˜…æ„è§",prop:"comment"}].map(e=>({...e,hide:!0})),$o={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!0,addBtn:!1,column:[...Io,...Oo]},So=A({__name:"index",setup(e){const t=ll("debugMode",!1),{getTaskOpsList:l}=fo(),{getCirculateOpsList:p,updateCirculate:n,removeCirculate:a}=xt(),{bindVal:c,getDataList:o,crudStateRefs:{searchForm:r,crudOption:f}}=Z({tableOption:$o,crudOption:{getList:l},searchForm:{status:2},sortOption:{descs:"start_time"}});xe(r,o,{debounce:300,immediate:!0,deep:!0});const _=N("task"),s=[{label:"ä»»åŠ¡",name:"task",getList:l},{label:"ä¼ é˜…",name:"circulate",getList:p,update:n,remove:a}];function d({paneName:i}){const v=s.find(m=>m.name===i);f.value.getList=v.getList,f.value.update=v.update,f.value.remove=v.remove,o()}const{open:u,close:y}=Ct({onComplete:()=>(y(),o())},{type:"drawer"});function w(i){u({flowKey:i.flowKey,taskId:i.taskId,instanceId:i.flowInstanceId,debug:t.value,circulateId:i.id})}return(i,v)=>{const m=C("el-tab-pane"),h=C("el-tabs"),D=C("el-switch"),O=C("el-button"),F=C("el-link"),I=C("avue-crud");return T(),E(W,null,[g(h,{modelValue:_.value,"onUpdate:modelValue":v[0]||(v[0]=R=>_.value=R),onTabClick:d},{default:b(()=>[(T(),E(W,null,X(s,R=>g(m,{key:R.name,label:R.label,name:R.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),g(I,qt(k(c),{permission:{menu:_.value==="circulate"}}),{"menu-right":b(()=>[g(O,{type:"text"},{default:b(()=>[g(D,{modelValue:k(t),"onUpdate:modelValue":v[1]||(v[1]=R=>ee(t)?t.value=R:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:b(({row:R})=>[g(F,{type:"primary",underline:!1,onClick:S=>w(R)},{default:b(()=>[P(j(R.processTitle||"æ— æ ‡é¢˜"),1)]),_:2},1032,["onClick"])]),_:1},16,["permission"])],64)}}}),Fo={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,column:[{label:"é…ç½®åç§°",prop:"paramName",search:!0},{label:"é…ç½®Key",prop:"paramKey",search:!0},{label:"å¤‡æ³¨",prop:"remark"},{label:"ç³»ç»Ÿå†…ç½®",prop:"paramType",type:"switch",dicData:Ae},{label:"é…ç½®å€¼",prop:"paramValue",type:"textarea",maxRows:20,span:24,overHidden:!0}]},Ro=A({__name:"index",setup(e){const{bindVal:t,getDataList:l}=Z({tableOption:Fo,crudOption:me()});return l(),(p,n)=>{const a=C("avue-crud");return T(),$(a,le(oe(k(t))),null,16)}}}),Po={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"æµç¨‹åç§°",prop:"flowName"},{label:"æµç¨‹æ ‡è¯†",prop:"flowKey"},{label:"æµç¨‹åˆ†ç±»",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"æ ‡é¢˜",prop:"processTitle",search:!0},{label:"æµæ°´å·",prop:"serialNumber"},{label:"å½“å‰èŠ‚ç‚¹",prop:"taskNodeName"},{label:"å®¡æ‰¹äºº",prop:"assigneeName"},{label:"ç”³è¯·äºº",prop:"applyUserName"},{label:"æ¥æ”¶æ—¶é—´",prop:"startTime"}]},Uo={class:"flow-list"},Eo=["onClick"],Ao={class:"flow-name"},Ko=A({__name:"index",setup(e){const t=N([]),{getPublishList:l,getTaskList:p}=Le(),{getCirculateList:n}=xt();l().then(i=>{t.value=i.data});const a=[{label:"å¾…åŠ",value:2},{label:"å·²åŠ",value:1}],{bindVal:c,getDataList:o,crudStateRefs:{searchForm:r,crudOption:f}}=Z({tableOption:Po,crudOption:{getList:p},searchForm:{status:2}});xe(r,o,{debounce:300,immediate:!0,deep:!0});const _=N("task"),s=[{label:"ä»»åŠ¡",name:"task",getList:p},{label:"ä¼ é˜…",name:"circulate",getList:n}];function d({paneName:i}){const v=s.find(m=>m.name===i);f.value.getList=v.getList,o()}const{open:u,close:y}=Ct({onComplete:()=>(y(),o())},{type:"drawer"});function w(i){u({flowKey:i.flowKey,taskId:i.taskId,instanceId:i.flowInstanceId,circulateId:i.id,detail:i.taskId?i.status===ht.å·²åŠ:!1})}return(i,v)=>{const m=C("el-button"),h=C("el-collapse-item"),D=C("el-collapse"),O=C("el-card"),F=C("el-divider"),I=C("el-tab-pane"),R=C("el-tabs"),S=C("avue-radio"),V=C("el-link"),x=C("avue-crud");return T(),E(W,null,[g(O,{"body-style":{padding:"0 20px"}},{default:b(()=>[g(D,{"model-value":"1"},{default:b(()=>[g(h,{name:"1"},{title:b(()=>[g(m,{text:"",icon:"el-icon-promotion"},{default:b(()=>[P(" å‘èµ·å®¡æ‰¹ ")]),_:1})]),default:b(()=>[q("div",Uo,[(T(!0),E(W,null,X(t.value,L=>(T(),E("div",{key:L.flowKey,class:"flow-item",onClick:K=>w(L)},[g(k(se),{class:"flow-icon",icon:L.flowIcon,width:"60"},null,8,["icon"]),q("div",Ao,j(L.flowName),1)],8,Eo))),128))])]),_:1})]),_:1})]),_:1}),g(F,{direction:"horizontal","content-position":"left"}),g(R,{modelValue:_.value,"onUpdate:modelValue":v[0]||(v[0]=L=>_.value=L),onTabClick:d},{default:b(()=>[(T(),E(W,null,X(s,L=>g(I,{key:L.name,label:L.label,name:L.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),g(x,le(oe(k(c))),{"menu-left":b(()=>[g(S,{modelValue:k(r).status,"onUpdate:modelValue":v[1]||(v[1]=L=>k(r).status=L),button:"",dic:a},null,8,["modelValue"])]),processTitle:b(({row:L})=>[g(V,{type:"primary",underline:!1,onClick:K=>w(L)},{default:b(()=>[P(j(L.processTitle||"æ— æ ‡é¢˜"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}});const Mo=Te(Ko,[["__scopeId","data-v-e1f72e36"]]),Bo={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"æµç¨‹æ ‡è¯†",prop:"flowKey",search:!0},{label:"æµç¨‹åç§°",prop:"flowName",search:!0},{label:"æµç¨‹æ¨¡å‹æ•°æ®",prop:"flowData",display:!1},{label:"æµç¨‹å¤‡æ³¨",prop:"remarks"},{label:"æ’åº",prop:"sort"}]},jo=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:l},getDataList:p,handleUpdate:n}=Z({tableOption:Bo,crudOption:Nt()});p();const a=N(!1);async function c(r){l.value=r,a.value=!0}async function o(){await n(l.value,NaN,()=>a.value=!1,()=>{})}return(r,f)=>{const _=C("el-button"),s=C("avue-crud"),d=C("el-dialog");return T(),E(W,null,[g(s,le(oe(k(t))),{flowData:b(({row:u})=>[g(_,{type:"primary",text:"",icon:"el-icon-crop",onClick:y=>c(u)},{default:b(()=>[P(" è®¾è®¡ ")]),_:2},1032,["onClick"])]),_:1},16),g(d,{modelValue:a.value,"onUpdate:modelValue":f[2]||(f[2]=u=>a.value=u),title:`æ¨¡å‹è®¾è®¡-${k(l).flowName}`,fullscreen:"","destroy-on-close":""},{footer:b(()=>[g(_,{type:"primary",onClick:o},{default:b(()=>[P(" ä¿å­˜ ")]),_:1}),g(_,{onClick:f[1]||(f[1]=u=>a.value=!1)},{default:b(()=>[P(" å–æ¶ˆ ")]),_:1})]),default:b(()=>[g(we,{modelValue:k(l).flowData,"onUpdate:modelValue":f[0]||(f[0]=u=>k(l).flowData=u),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Ho={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"è¡¨å•æ ‡è¯†",prop:"formKey",search:!0},{label:"è¡¨å•åç§°",prop:"formName",search:!0},{label:"è¡¨å•é…ç½®",prop:"formOption",display:!1},{label:"è¡¨å•å¤‡æ³¨",prop:"remarks"},{label:"æ’åº",prop:"sort",type:"number"}]},zo=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:l},getDataList:p,handleUpdate:n}=Z({tableOption:Ho,crudOption:It()});p();const a=N(!1);async function c(r){l.value={...r},a.value=!0}async function o(){await n(l.value,NaN,()=>a.value=!1,()=>{})}return(r,f)=>{const _=C("el-button"),s=C("avue-crud"),d=C("el-dialog");return T(),E(W,null,[g(s,le(oe(k(t))),{formOption:b(({row:u})=>[g(_,{type:"primary",text:"",icon:"el-icon-crop",onClick:y=>c(u)},{default:b(()=>[P(" è®¾è®¡ ")]),_:2},1032,["onClick"])]),_:1},16),g(d,{modelValue:a.value,"onUpdate:modelValue":f[2]||(f[2]=u=>a.value=u),title:`è¡¨å•è®¾è®¡-${k(l).formName}`,fullscreen:"","destroy-on-close":""},{footer:b(()=>[g(_,{type:"primary",onClick:o},{default:b(()=>[P(" ä¿å­˜ ")]),_:1}),g(_,{onClick:f[1]||(f[1]=u=>a.value=!1)},{default:b(()=>[P(" å–æ¶ˆ ")]),_:1})]),default:b(()=>[g(Ze,{modelValue:k(l).formOption,"onUpdate:modelValue":f[0]||(f[0]=u=>k(l).formOption=u),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),rt=[{label:"å­—æ®µåç§°",prop:"name"},{label:"å­—æ®µå¤‡æ³¨",prop:"comment"},{label:"å­—æ®µç±»å‹",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:ne(Ot)},{label:"å­—æ®µé•¿åº¦",prop:"size",type:"number"},{label:"å°æ•°ä½",prop:"point",type:"number"},{label:"é»˜è®¤å€¼",prop:"default"},{label:"æ˜¯å¦ä¸»é”®",prop:"primary",type:"switch",dicData:Ae,value:0},{label:"æ˜¯å¦å…è®¸ä¸ºç©º",prop:"permitNull",type:"switch",dicData:Ae,value:1}],Wo={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,dialogFullscreen:!0,column:[{label:"è¡¨å",prop:"tableName",search:!0},{label:"è¡¨æ³¨é‡Š",prop:"tableComment",search:!0},{label:"è¡¨å¼•æ“",prop:"tableEngine"},{label:"è¡¨ä¸»é”®ç­–ç•¥",prop:"tablePrimary"},{label:"æ•°æ®åº“å­—æ®µ",prop:"editFields",hide:!0,type:"dynamic",children:{column:rt}},{label:"é»˜è®¤å­—æ®µ",prop:"defaultFields",hide:!0,type:"dynamic",children:{addBtn:!1,delBtn:!1,column:rt}}]},Yo=q("br",null,null,-1),qo=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:l,defaults:p},getDataList:n,afterOpen:a,beforeSubmit:c}=Z({crudOption:Ke(),tableOption:Wo});n();const{data:o}=me().useParam("table.default.fields");a(d=>{if(l.value.defaultFields=o.value??[],d==="edit"){const u=JSON.parse(l.value.tableFields);l.value.editFields=vt(u,o.value??[],"name")}}),c(d=>{const u=[...d.defaultFields,...d.editFields];d.tableFields=JSON.stringify(u)});const r=N(!1);J(()=>{var d;(d=p.value)!=null&&d.defaultFields&&(p.value.defaultFields.display=r.value)});const{deploy:f}=Ke(),_=N(!1);async function s(d){await de.confirm("éƒ¨ç½²å°†è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“è¡¨ï¼Œæ˜¯å¦ç¡®è®¤ï¼Ÿ","æç¤º",{type:"success"}),_.value=!0,f({id:d.id}).then(()=>{Q.success("éƒ¨ç½²æˆåŠŸ"),n()}).finally(()=>{_.value=!1})}return(d,u)=>{const y=C("el-button"),w=C("el-switch"),i=C("el-tooltip"),v=C("avue-crud");return T(),$(v,le(oe(k(t))),{menu:b(({row:m})=>[g(y,{type:"text",icon:"el-icon-upload",onClick:h=>s(m)},{default:b(()=>[P(" éƒ¨ç½² ")]),_:2},1032,["onClick"])]),"editFields-label":b(()=>[q("div",null,[P(" æ•°æ®åº“å­—æ®µ "),Yo,g(i,{content:"æ˜¾ç¤ºé»˜è®¤å­—æ®µ"},{default:b(()=>[g(w,{modelValue:r.value,"onUpdate:modelValue":u[0]||(u[0]=m=>r.value=m)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),fa={install(e,t){e.component("FlowButton",_o).component("FlowDefinition",$t).component("FlowDeploy",St).component("FlowForm",We).component("FlowManage",No).component("FlowOps",So).component("FlowParam",Ro).component("FlowTemplate",jo).component("FormTemplate",zo).component("TableTemplate",qo).component("FlowWorkbench",Mo),z(e,t)}};export{uo as CONFIG_DEFAULT,nt as CONFIG_PROVIDE_KEY,_o as FlowButton,$t as FlowDefinition,St as FlowDeploy,We as FlowForm,No as FlowManage,So as FlowOps,Ro as FlowParam,jo as FlowTemplate,Mo as FlowWorkbench,zo as FormTemplate,qo as TableTemplate,Vt as Whether,fa as default,eo as resolveFlowFormComponent,z as useConfigProvider,Ct as useFlowForm,Zl as useFlowFormOverlay,Xl as useFlowFormWindow,Ae as whetherDic};
